================================================================================
Risk Manager V34 - Test Report
================================================================================
Test Run: All tests with coverage (with branch)
Timestamp: 2025-10-27 22:37:53
Status: FAILED
Exit Code: 1
================================================================================

[1m============================= test session starts ==============================[0m
platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /mnt/c/Users/jakers/Desktop/risk-manager-v34/.venv/bin/python
cachedir: .pytest_cache
rootdir: /mnt/c/Users/jakers/Desktop/risk-manager-v34
configfile: pyproject.toml
plugins: anyio-4.11.0, asyncio-1.2.0, cov-7.0.0, mock-3.15.1
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
[1mcollecting ... [0mcollected 740 items

tests/e2e/test_max_contracts_e2e.py::TestMaxContractsE2E::test_position_below_limit_no_enforcement [32mPASSED[0m[33m [  0%][0m
tests/e2e/test_max_contracts_e2e.py::TestMaxContractsE2E::test_position_exceeds_limit_triggers_enforcement [32mPASSED[0m[33m [  0%][0m
tests/e2e/test_max_contracts_e2e.py::TestMaxContractsE2E::test_complete_flow_sdk_to_enforcement [32mPASSED[0m[33m [  0%][0m
tests/e2e/test_max_contracts_e2e.py::TestMaxContractsE2E::test_multiple_position_updates [32mPASSED[0m[33m [  0%][0m
tests/e2e/test_max_contracts_e2e.py::TestMaxContractsE2E::test_multi_symbol_total_exceeds_limit [32mPASSED[0m[33m [  0%][0m
tests/e2e/test_max_contracts_e2e.py::TestMaxContractsE2E::test_enforcement_closes_positions_via_sdk [32mPASSED[0m[33m [  0%][0m
tests/e2e/test_max_contracts_e2e.py::TestMaxContractsE2E::test_system_continues_after_handler_error [32mPASSED[0m[33m [  0%][0m
tests/e2e/test_max_contracts_e2e.py::TestMaxContractsE2E::test_end_to_end_latency [32mPASSED[0m[33m [  1%][0m
tests/e2e/test_max_contracts_e2e.py::TestMaxContractsE2E::test_state_remains_consistent_across_events [32mPASSED[0m[33m [  1%][0m
tests/e2e/test_max_contracts_e2e.py::TestMaxContractsE2E::test_realistic_day_trading_scenario [32mPASSED[0m[33m [  1%][0m
tests/integration/test_cooldown_after_loss_integration.py::TestCooldownAfterLossIntegration::test_full_cooldown_flow_with_timer_expiry [32mPASSED[0m[33m [  1%][0m
tests/integration/test_cooldown_after_loss_integration.py::TestCooldownAfterLossIntegration::test_tiered_cooldown_selects_correct_duration [32mPASSED[0m[33m [  1%][0m
tests/integration/test_cooldown_after_loss_integration.py::TestCooldownAfterLossIntegration::test_tiered_cooldown_tier1 [32mPASSED[0m[33m [  1%][0m
tests/integration/test_cooldown_after_loss_integration.py::TestCooldownAfterLossIntegration::test_tiered_cooldown_tier3 [32mPASSED[0m[33m [  1%][0m
tests/integration/test_cooldown_after_loss_integration.py::TestCooldownAfterLossIntegration::test_timer_callback_clears_lockout [32mPASSED[0m[33m [  2%][0m
tests/integration/test_cooldown_after_loss_integration.py::TestCooldownAfterLossIntegration::test_winning_trade_no_cooldown_no_timer [32mPASSED[0m[33m [  2%][0m
tests/integration/test_cooldown_after_loss_integration.py::TestCooldownAfterLossIntegration::test_multi_account_independent_cooldowns [32mPASSED[0m[33m [  2%][0m
tests/integration/test_cooldown_after_loss_integration.py::TestCooldownAfterLossIntegration::test_lockout_persists_to_database [32mPASSED[0m[33m [  2%][0m
tests/integration/test_cooldown_after_loss_integration.py::TestCooldownAfterLossIntegration::test_lockout_loaded_from_database_on_restart [32mPASSED[0m[33m [  2%][0m
tests/integration/test_cooldown_after_loss_integration.py::TestCooldownAfterLossIntegration::test_rapid_loss_sequence_only_first_triggers_timer [32mPASSED[0m[33m [  2%][0m
tests/integration/test_cooldown_after_loss_integration.py::TestCooldownAfterLossIntegration::test_event_flow_from_trade_to_lockout [32mPASSED[0m[33m [  2%][0m
tests/integration/test_cooldown_after_loss_integration.py::TestCooldownAfterLossIntegration::test_timer_precision_within_tolerance [32mPASSED[0m[33m [  2%][0m
tests/integration/test_cooldown_after_loss_integration.py::TestCooldownAfterLossIntegration::test_database_cleanup_on_lockout_clear [31mFAILED[0m[31m [  3%][0m
tests/integration/test_cooldown_after_loss_integration.py::TestCooldownAfterLossIntegration::test_position_closed_event_triggers_cooldown [32mPASSED[0m[31m [  3%][0m
tests/integration/test_cooldown_after_loss_integration.py::TestCooldownAfterLossIntegration::test_half_turn_trades_no_cooldown_no_timer [32mPASSED[0m[31m [  3%][0m
tests/integration/test_daily_realized_loss_integration.py::TestDailyRealizedLossIntegration::test_full_loss_limit_flow_with_database [31mFAILED[0m[31m [  3%][0m
tests/integration/test_daily_realized_loss_integration.py::TestDailyRealizedLossIntegration::test_multi_account_independence [31mFAILED[0m[31m [  3%][0m
tests/integration/test_daily_realized_loss_integration.py::TestDailyRealizedLossIntegration::test_lockout_persistence_crash_recovery [31mFAILED[0m[31m [  3%][0m
tests/integration/test_daily_realized_loss_integration.py::TestDailyRealizedLossIntegration::test_reset_scheduler_integration [31mFAILED[0m[31m [  3%][0m
tests/integration/test_daily_realized_loss_integration.py::TestDailyRealizedLossIntegration::test_half_turn_trades_ignored [32mPASSED[0m[31m [  4%][0m
tests/integration/test_daily_realized_loss_integration.py::TestDailyRealizedLossIntegration::test_mixed_profit_loss_day [31mFAILED[0m[31m [  4%][0m
tests/integration/test_daily_realized_loss_integration.py::TestDailyRealizedLossIntegration::test_concurrent_access_thread_safety [31mFAILED[0m[31m [  4%][0m
tests/integration/test_daily_realized_loss_integration.py::TestDailyRealizedLossIntegration::test_database_schema_validation [31mFAILED[0m[31m [  4%][0m
tests/integration/test_daily_realized_loss_integration.py::TestDailyRealizedLossIntegration::test_boundary_exactly_at_limit [31mFAILED[0m[31m [  4%][0m
tests/integration/test_daily_realized_loss_integration.py::TestDailyRealizedLossIntegration::test_timer_auto_unlock [31mFAILED[0m[31m [  4%][0m
tests/integration/test_daily_realized_profit_integration.py::test_full_profit_target_flow_with_database [32mPASSED[0m[31m [  4%][0m
tests/integration/test_daily_realized_profit_integration.py::test_multi_account_independence [32mPASSED[0m[31m [  5%][0m
tests/integration/test_daily_realized_profit_integration.py::test_lockout_persistence_crash_recovery [32mPASSED[0m[31m [  5%][0m
tests/integration/test_daily_realized_profit_integration.py::test_reset_scheduler_integration [32mPASSED[0m[31m [  5%][0m
tests/integration/test_daily_realized_profit_integration.py::test_event_bus_async_flow [32mPASSED[0m[31m [  5%][0m
tests/integration/test_daily_realized_profit_integration.py::test_enforcement_action_integration [32mPASSED[0m[31m [  5%][0m
tests/integration/test_daily_realized_profit_integration.py::test_half_turn_trades_ignored [32mPASSED[0m[31m [  5%][0m
tests/integration/test_daily_realized_profit_integration.py::test_timer_auto_unlock [32mPASSED[0m[31m [  5%][0m
tests/integration/test_daily_realized_profit_integration.py::test_concurrent_access_thread_safety [32mPASSED[0m[31m [  5%][0m
tests/integration/test_daily_realized_profit_integration.py::test_database_schema_validation [32mPASSED[0m[31m [  6%][0m
tests/integration/test_daily_realized_profit_integration.py::test_mixed_profit_loss_day [32mPASSED[0m[31m [  6%][0m
tests/integration/test_daily_realized_profit_integration.py::test_lockout_prevents_further_evaluation [32mPASSED[0m[31m [  6%][0m
tests/integration/test_daily_realized_profit_integration.py::test_pnl_tracker_trade_count [32mPASSED[0m[31m [  6%][0m
tests/integration/test_daily_realized_profit_integration.py::test_reset_time_calculation [32mPASSED[0m[31m [  6%][0m
tests/integration/test_daily_realized_profit_integration.py::test_boundary_exactly_at_target [32mPASSED[0m[31m [  6%][0m
tests/integration/test_daily_unrealized_loss_integration.py::TestDailyUnrealizedLossIntegration::test_full_unrealized_loss_violation_flow [32mPASSED[0m[31m [  6%][0m
tests/integration/test_daily_unrealized_loss_integration.py::TestDailyUnrealizedLossIntegration::test_multi_position_independence [32mPASSED[0m[31m [  7%][0m
tests/integration/test_daily_unrealized_loss_integration.py::TestDailyUnrealizedLossIntegration::test_real_pnl_calculation_accuracy [32mPASSED[0m[31m [  7%][0m
tests/integration/test_daily_unrealized_loss_integration.py::TestDailyUnrealizedLossIntegration::test_market_price_updates_real_time_monitoring [32mPASSED[0m[31m [  7%][0m
tests/integration/test_daily_unrealized_loss_integration.py::TestDailyUnrealizedLossIntegration::test_different_tick_sizes_calculation [32mPASSED[0m[31m [  7%][0m
tests/integration/test_daily_unrealized_loss_integration.py::TestDailyUnrealizedLossIntegration::test_no_lockout_created_on_violation [32mPASSED[0m[31m [  7%][0m
tests/integration/test_daily_unrealized_loss_integration.py::TestDailyUnrealizedLossIntegration::test_event_bus_integration_complete_flow [32mPASSED[0m[31m [  7%][0m
tests/integration/test_daily_unrealized_loss_integration.py::TestDailyUnrealizedLossIntegration::test_position_closed_before_violation [32mPASSED[0m[31m [  7%][0m
tests/integration/test_daily_unrealized_loss_integration.py::TestDailyUnrealizedLossIntegration::test_long_and_short_positions_accuracy [32mPASSED[0m[31m [  7%][0m
tests/integration/test_daily_unrealized_loss_integration.py::TestDailyUnrealizedLossIntegration::test_enforcement_action_close_position_not_flatten_all [32mPASSED[0m[31m [  8%][0m
tests/integration/test_event_pipeline_integration.py::TestEventPipelineIntegration::test_event_bus_publishes_to_subscribers [32mPASSED[0m[31m [  8%][0m
tests/integration/test_event_pipeline_integration.py::TestEventPipelineIntegration::test_event_bus_multiple_subscribers [32mPASSED[0m[31m [  8%][0m
tests/integration/test_event_pipeline_integration.py::TestEventPipelineIntegration::test_engine_evaluates_rule_on_event [32mPASSED[0m[31m [  8%][0m
tests/integration/test_event_pipeline_integration.py::TestEventPipelineIntegration::test_engine_skips_rules_when_no_violation [32mPASSED[0m[31m [  8%][0m
tests/integration/test_event_pipeline_integration.py::TestEventPipelineIntegration::test_violation_triggers_flatten_enforcement [32mPASSED[0m[31m [  8%][0m
tests/integration/test_event_pipeline_integration.py::TestEventPipelineIntegration::test_violation_publishes_event [32mPASSED[0m[31m [  8%][0m
tests/integration/test_event_pipeline_integration.py::TestEventPipelineIntegration::test_end_to_end_position_violation_flow [32mPASSED[0m[31m [  9%][0m
tests/integration/test_event_pipeline_integration.py::TestEventPipelineIntegration::test_multiple_rules_evaluated_in_order [32mPASSED[0m[31m [  9%][0m
tests/integration/test_event_pipeline_integration.py::TestEventPipelineIntegration::test_event_bus_handles_handler_errors [32mPASSED[0m[31m [  9%][0m
tests/integration/test_event_pipeline_integration.py::TestEventPipelineIntegration::test_engine_tracks_position_state [32mPASSED[0m[31m [  9%][0m
tests/integration/test_event_pipeline_integration.py::TestEventPipelineIntegration::test_flatten_action_calls_flatten_all [32mPASSED[0m[31m [  9%][0m
tests/integration/test_event_pipeline_integration.py::TestEventPipelineIntegration::test_pause_action_triggers_pause_trading [32mPASSED[0m[31m [  9%][0m
tests/integration/test_event_pipeline_integration.py::TestEventPipelineIntegration::test_event_processing_is_fast [32mPASSED[0m[31m [  9%][0m
tests/integration/test_event_pipeline_integration.py::TestEventPipelineIntegration::test_multi_symbol_position_tracking [32mPASSED[0m[31m [ 10%][0m
tests/integration/test_max_contracts_per_instrument_integration.py::TestMaxContractsPerInstrumentIntegration::test_single_symbol_within_limit [31mFAILED[0m[31m [ 10%][0m
tests/integration/test_max_contracts_per_instrument_integration.py::TestMaxContractsPerInstrumentIntegration::test_single_symbol_exceeds_limit [31mFAILED[0m[31m [ 10%][0m
tests/integration/test_max_contracts_per_instrument_integration.py::TestMaxContractsPerInstrumentIntegration::test_multiple_symbols_independent_limits [31mFAILED[0m[31m [ 10%][0m
tests/integration/test_max_contracts_per_instrument_integration.py::TestMaxContractsPerInstrumentIntegration::test_one_symbol_violates_others_ok [31mFAILED[0m[31m [ 10%][0m
tests/integration/test_max_contracts_per_instrument_integration.py::TestMaxContractsPerInstrumentIntegration::test_symbol_without_configured_limit [31mFAILED[0m[31m [ 10%][0m
tests/integration/test_max_contracts_per_instrument_integration.py::TestMaxContractsPerInstrumentIntegration::test_short_positions_absolute_value [31mERROR[0m[31m [ 10%][0m
tests/integration/test_max_contracts_per_instrument_integration.py::TestMaxContractsPerInstrumentIntegration::test_exactly_at_limit_no_violation [31mERROR[0m[31m [ 10%][0m
tests/integration/test_max_contracts_per_instrument_integration.py::TestMaxContractsPerInstrumentIntegration::test_event_bus_integration [31mERROR[0m[31m [ 11%][0m
tests/integration/test_max_contracts_per_instrument_integration.py::TestMaxContractsPerInstrumentIntegration::test_no_lockout_on_violation [31mERROR[0m[31m [ 11%][0m
tests/integration/test_max_contracts_per_instrument_integration.py::TestMaxContractsPerInstrumentIntegration::test_dynamic_limit_configuration [31mERROR[0m[31m [ 11%][0m
tests/integration/test_max_position_integration.py::TestMaxPositionIntegration::test_single_symbol_within_limit [31mERROR[0m[31m [ 11%][0m
tests/integration/test_max_position_integration.py::TestMaxPositionIntegration::test_single_symbol_exceeds_limit [31mERROR[0m[31m [ 11%][0m
tests/integration/test_max_position_integration.py::TestMaxPositionIntegration::test_multi_symbol_total_within_limit [31mERROR[0m[31m [ 11%][0m
tests/integration/test_max_position_integration.py::TestMaxPositionIntegration::test_multi_symbol_total_exceeds_limit [31mERROR[0m[31m [ 11%][0m
tests/integration/test_max_position_integration.py::TestMaxPositionIntegration::test_short_positions_absolute_value [31mERROR[0m[31m [ 12%][0m
tests/integration/test_max_position_integration.py::TestMaxPositionIntegration::test_event_bus_integration [31mERROR[0m[31m [ 12%][0m
tests/integration/test_max_position_integration.py::TestMaxPositionIntegration::test_no_lockout_on_violation [31mERROR[0m[31m [ 12%][0m
tests/integration/test_max_position_integration.py::TestMaxPositionIntegration::test_zero_position_no_violation [31mERROR[0m[31m [ 12%][0m
tests/integration/test_max_position_integration.py::TestMaxPositionIntegration::test_exactly_at_limit_no_violation [31mERROR[0m[31m [ 12%][0m
tests/integration/test_max_position_integration.py::TestMaxPositionIntegration::test_performance_many_symbols [31mERROR[0m[31m [ 12%][0m
tests/integration/test_max_unrealized_profit_integration.py::TestMaxUnrealizedProfitIntegration::test_es_long_position_reaches_target [31mFAILED[0m[31m [ 12%][0m
tests/integration/test_max_unrealized_profit_integration.py::TestMaxUnrealizedProfitIntegration::test_mnq_short_position_reaches_target [31mFAILED[0m[31m [ 12%][0m
tests/integration/test_max_unrealized_profit_integration.py::TestMaxUnrealizedProfitIntegration::test_multi_position_independence [31mFAILED[0m[31m [ 13%][0m
tests/integration/test_max_unrealized_profit_integration.py::TestMaxUnrealizedProfitIntegration::test_market_price_updates_real_time_monitoring [31mFAILED[0m[31m [ 13%][0m
tests/integration/test_max_unrealized_profit_integration.py::TestMaxUnrealizedProfitIntegration::test_different_tick_sizes_calculation [31mFAILED[0m[31m [ 13%][0m
tests/integration/test_max_unrealized_profit_integration.py::TestMaxUnrealizedProfitIntegration::test_long_and_short_positions_accuracy [31mFAILED[0m[31m [ 13%][0m
tests/integration/test_max_unrealized_profit_integration.py::TestMaxUnrealizedProfitIntegration::test_event_bus_integration_complete_flow [31mFAILED[0m[31m [ 13%][0m
tests/integration/test_max_unrealized_profit_integration.py::TestMaxUnrealizedProfitIntegration::test_enforcement_closes_position_not_flatten_all [31mFAILED[0m[31m [ 13%][0m
tests/integration/test_max_unrealized_profit_integration.py::TestMaxUnrealizedProfitIntegration::test_position_closed_before_target [32mPASSED[0m[31m [ 13%][0m
tests/integration/test_max_unrealized_profit_integration.py::TestMaxUnrealizedProfitIntegration::test_zero_negative_profit_no_violation [31mFAILED[0m[31m [ 14%][0m
tests/integration/test_no_stop_loss_grace_integration.py::TestNoStopLossGraceIntegration::test_grace_period_timer_expires_and_closes_position [31mFAILED[0m[31m [ 14%][0m
tests/integration/test_no_stop_loss_grace_integration.py::TestNoStopLossGraceIntegration::test_stop_loss_placed_cancels_timer_no_enforcement [32mPASSED[0m[31m [ 14%][0m
tests/integration/test_no_stop_loss_grace_integration.py::TestNoStopLossGraceIntegration::test_multiple_positions_independent_timers [31mFAILED[0m[31m [ 14%][0m
tests/integration/test_no_stop_loss_grace_integration.py::TestNoStopLossGraceIntegration::test_position_closed_before_grace_expires [32mPASSED[0m[31m [ 14%][0m
tests/integration/test_no_stop_loss_grace_integration.py::TestNoStopLossGraceIntegration::test_real_async_timer_callback_execution [32mPASSED[0m[31m [ 14%][0m
tests/integration/test_no_stop_loss_grace_integration.py::TestNoStopLossGraceIntegration::test_order_type_detection_only_stops_cancel_timer [32mPASSED[0m[31m [ 14%][0m
tests/integration/test_no_stop_loss_grace_integration.py::TestNoStopLossGraceIntegration::test_event_bus_integration_with_rule_events [32mPASSED[0m[31m [ 15%][0m
tests/integration/test_no_stop_loss_grace_integration.py::TestNoStopLossGraceIntegration::test_timer_recreated_after_manager_restart [32mPASSED[0m[31m [ 15%][0m
tests/integration/test_no_stop_loss_grace_integration.py::TestNoStopLossGraceIntegration::test_concurrent_timer_operations [31mFAILED[0m[31m [ 15%][0m
tests/integration/test_no_stop_loss_grace_integration.py::TestNoStopLossGraceIntegration::test_enforcement_failure_does_not_crash [31mFAILED[0m[31m [ 15%][0m
tests/integration/test_no_stop_loss_grace_integration.py::TestNoStopLossGraceIntegration::test_rule_status_shows_active_timers [32mPASSED[0m[31m [ 15%][0m
tests/integration/test_no_stop_loss_grace_integration.py::TestNoStopLossGraceIntegration::test_disabled_rule_integration [32mPASSED[0m[31m [ 15%][0m
tests/integration/test_session_block_outside_integration.py::TestSessionBlockOutsideIntegration::test_outside_hours_lockout_flow [32mPASSED[0m[31m [ 15%][0m
tests/integration/test_session_block_outside_integration.py::TestSessionBlockOutsideIntegration::test_inside_hours_no_violation [32mPASSED[0m[31m [ 15%][0m
tests/integration/test_session_block_outside_integration.py::TestSessionBlockOutsideIntegration::test_weekend_blocking_saturday [32mPASSED[0m[31m [ 16%][0m
tests/integration/test_session_block_outside_integration.py::TestSessionBlockOutsideIntegration::test_weekend_blocking_sunday [32mPASSED[0m[31m [ 16%][0m
tests/integration/test_session_block_outside_integration.py::TestSessionBlockOutsideIntegration::test_dst_spring_forward_transition [32mPASSED[0m[31m [ 16%][0m
tests/integration/test_session_block_outside_integration.py::TestSessionBlockOutsideIntegration::test_dst_fall_back_transition [32mPASSED[0m[31m [ 16%][0m
tests/integration/test_session_block_outside_integration.py::TestSessionBlockOutsideIntegration::test_lockout_persistence_across_restarts [32mPASSED[0m[31m [ 16%][0m
tests/integration/test_session_block_outside_integration.py::TestSessionBlockOutsideIntegration::test_multi_account_independence [32mPASSED[0m[31m [ 16%][0m
tests/integration/test_session_block_outside_integration.py::TestSessionBlockOutsideIntegration::test_event_bus_integration [32mPASSED[0m[31m [ 16%][0m
tests/integration/test_session_block_outside_integration.py::TestSessionBlockOutsideIntegration::test_database_schema_validation [32mPASSED[0m[31m [ 17%][0m
tests/integration/test_session_block_outside_integration.py::TestSessionBlockOutsideIntegration::test_lockout_auto_expiry [32mPASSED[0m[31m [ 17%][0m
tests/integration/test_session_block_outside_integration.py::TestSessionBlockOutsideIntegration::test_different_timezone_support [32mPASSED[0m[31m [ 17%][0m
tests/integration/test_symbol_blocks_integration.py::TestSymbolBlocksRuleIntegration::test_order_rejection_flow_integration [32mPASSED[0m[31m [ 17%][0m
tests/integration/test_symbol_blocks_integration.py::TestSymbolBlocksRuleIntegration::test_allowed_symbol_passes_integration [32mPASSED[0m[31m [ 17%][0m
tests/integration/test_symbol_blocks_integration.py::TestSymbolBlocksRuleIntegration::test_position_close_flow_integration [32mPASSED[0m[31m [ 17%][0m
tests/integration/test_symbol_blocks_integration.py::TestSymbolBlocksRuleIntegration::test_position_opened_triggers_violation [32mPASSED[0m[31m [ 17%][0m
tests/integration/test_symbol_blocks_integration.py::TestSymbolBlocksRuleIntegration::test_wildcard_prefix_matching_integration [32mPASSED[0m[31m [ 17%][0m
tests/integration/test_symbol_blocks_integration.py::TestSymbolBlocksRuleIntegration::test_wildcard_contains_matching_integration [32mPASSED[0m[31m [ 18%][0m
tests/integration/test_symbol_blocks_integration.py::TestSymbolBlocksRuleIntegration::test_wildcard_does_not_match_allowed_symbols [32mPASSED[0m[31m [ 18%][0m
tests/integration/test_symbol_blocks_integration.py::TestSymbolBlocksRuleIntegration::test_case_insensitive_matching_integration [32mPASSED[0m[31m [ 18%][0m
tests/integration/test_symbol_blocks_integration.py::TestSymbolBlocksRuleIntegration::test_wildcard_case_insensitive_integration [32mPASSED[0m[31m [ 18%][0m
tests/integration/test_symbol_blocks_integration.py::TestSymbolBlocksRuleIntegration::test_multi_symbol_account_selective_close [32mPASSED[0m[31m [ 18%][0m
tests/integration/test_symbol_blocks_integration.py::TestSymbolBlocksRuleIntegration::test_multiple_blocked_symbols_in_account [32mPASSED[0m[31m [ 18%][0m
tests/integration/test_symbol_blocks_integration.py::TestSymbolBlocksRuleIntegration::test_event_bus_handles_violation_errors [32mPASSED[0m[31m [ 18%][0m
tests/integration/test_symbol_blocks_integration.py::TestSymbolBlocksRuleIntegration::test_no_lockout_trade_by_trade_enforcement [32mPASSED[0m[31m [ 19%][0m
tests/integration/test_symbol_blocks_integration.py::TestSymbolBlocksRuleIntegration::test_end_to_end_multiple_event_types [32mPASSED[0m[31m [ 19%][0m
tests/integration/test_symbol_blocks_integration.py::TestSymbolBlocksRuleIntegration::test_symbol_matching_performance [32mPASSED[0m[31m [ 19%][0m
tests/integration/test_symbol_blocks_integration.py::TestSymbolBlocksRuleIntegration::test_dynamic_blocked_list_update [32mPASSED[0m[31m [ 19%][0m
tests/integration/test_trade_frequency_limit_integration.py::TestTradeFrequencyLimitIntegration::test_frequency_limit_cooldown_flow [32mPASSED[0m[31m [ 19%][0m
tests/integration/test_trade_frequency_limit_integration.py::TestTradeFrequencyLimitIntegration::test_rolling_window_tracking [32mPASSED[0m[31m [ 19%][0m
tests/integration/test_trade_frequency_limit_integration.py::TestTradeFrequencyLimitIntegration::test_multi_tier_limits [32mPASSED[0m[31m [ 19%][0m
tests/integration/test_trade_frequency_limit_integration.py::TestTradeFrequencyLimitIntegration::test_database_persistence [32mPASSED[0m[31m [ 20%][0m
tests/integration/test_trade_frequency_limit_integration.py::TestTradeFrequencyLimitIntegration::test_timer_auto_unlock_integration [32mPASSED[0m[31m [ 20%][0m
tests/integration/test_trade_frequency_limit_integration.py::TestTradeFrequencyLimitIntegration::test_multi_account_independence [32mPASSED[0m[31m [ 20%][0m
tests/integration/test_trade_frequency_limit_integration.py::TestTradeFrequencyLimitIntegration::test_session_reset [32mPASSED[0m[31m [ 20%][0m
tests/integration/test_trade_frequency_limit_integration.py::TestTradeFrequencyLimitIntegration::test_priority_order [32mPASSED[0m[31m [ 20%][0m
tests/integration/test_trade_frequency_limit_integration.py::TestTradeFrequencyLimitIntegration::test_concurrent_rapid_fire_trades [32mPASSED[0m[31m [ 20%][0m
tests/integration/test_trade_frequency_limit_integration.py::TestTradeFrequencyLimitIntegration::test_timer_cancellation_and_restart [32mPASSED[0m[31m [ 20%][0m
tests/integration/test_trade_frequency_limit_integration.py::TestTradeFrequencyLimitIntegration::test_database_query_performance [32mPASSED[0m[31m [ 20%][0m
tests/integration/test_trade_frequency_limit_integration.py::TestTradeFrequencyLimitIntegration::test_error_recovery_database_unavailable [32mPASSED[0m[31m [ 21%][0m
tests/integration/test_trade_management_integration.py::TestTradeManagementIntegration::test_auto_stop_loss_placement_es_long [32mPASSED[0m[31m [ 21%][0m
tests/integration/test_trade_management_integration.py::TestTradeManagementIntegration::test_auto_stop_loss_placement_mnq_short [32mPASSED[0m[31m [ 21%][0m
tests/integration/test_trade_management_integration.py::TestTradeManagementIntegration::test_auto_take_profit_placement [32mPASSED[0m[31m [ 21%][0m
tests/integration/test_trade_management_integration.py::TestTradeManagementIntegration::test_bracket_order_creation [32mPASSED[0m[31m [ 21%][0m
tests/integration/test_trade_management_integration.py::TestTradeManagementIntegration::test_trailing_stop_adjustment_on_profit [32mPASSED[0m[31m [ 21%][0m
tests/integration/test_trade_management_integration.py::TestTradeManagementIntegration::test_trailing_stop_not_adjusted_on_loss [32mPASSED[0m[31m [ 21%][0m
tests/integration/test_trade_management_integration.py::TestTradeManagementIntegration::test_multi_symbol_independent_management [32mPASSED[0m[31m [ 22%][0m
tests/integration/test_trade_management_integration.py::TestTradeManagementIntegration::test_position_closed_orders_cleanup [32mPASSED[0m[31m [ 22%][0m
tests/integration/test_trade_management_integration.py::TestTradeManagementIntegration::test_event_bus_routes_to_rule [32mPASSED[0m[31m [ 22%][0m
tests/integration/test_trade_management_integration.py::TestTradeManagementIntegration::test_stop_loss_disabled_only_take_profit [32mPASSED[0m[31m [ 22%][0m
tests/integration/test_trade_management_integration.py::TestTradeManagementIntegration::test_take_profit_disabled_only_stop_loss [32mPASSED[0m[31m [ 22%][0m
tests/integration/test_trade_management_integration.py::TestTradeManagementIntegration::test_complete_order_placement_flow [32mPASSED[0m[31m [ 22%][0m
tests/integration/test_trade_management_integration.py::TestTradeManagementIntegration::test_event_processing_performance [32mPASSED[0m[31m [ 22%][0m
tests/runtime/test_async_debug.py::test_async_task_creation [32mPASSED[0m[31m       [ 22%][0m
tests/runtime/test_async_debug.py::test_async_task_lifecycle [32mPASSED[0m[31m      [ 23%][0m
tests/runtime/test_async_debug.py::test_async_task_cancellation [32mPASSED[0m[31m   [ 23%][0m
tests/runtime/test_async_debug.py::test_async_race_condition_detection [32mPASSED[0m[31m [ 23%][0m
tests/runtime/test_async_debug.py::test_async_deadlock_prevention [32mPASSED[0m[31m [ 23%][0m
tests/runtime/test_async_debug.py::test_async_resource_leak_detection [32mPASSED[0m[31m [ 23%][0m
tests/runtime/test_async_debug.py::test_async_task_duration_tracking [32mPASSED[0m[31m [ 23%][0m
tests/runtime/test_async_debug.py::test_async_slow_task_detection [32mPASSED[0m[31m [ 23%][0m
tests/runtime/test_async_debug.py::test_async_memory_usage [32mPASSED[0m[31m        [ 24%][0m
tests/runtime/test_async_debug.py::test_async_exception_tracking [32mPASSED[0m[31m  [ 24%][0m
tests/runtime/test_async_debug.py::test_async_timeout_detection [32mPASSED[0m[31m   [ 24%][0m
tests/runtime/test_async_debug.py::test_async_task_inspection [32mPASSED[0m[31m     [ 24%][0m
tests/runtime/test_async_debug.py::test_async_event_loop_monitoring [32mPASSED[0m[31m [ 24%][0m
tests/runtime/test_async_debug.py::test_async_debug_logging [32mPASSED[0m[31m       [ 24%][0m
tests/runtime/test_dry_run.py::test_dry_run_enabled [32mPASSED[0m[31m               [ 24%][0m
tests/runtime/test_dry_run.py::test_dry_run_no_real_trades [32mPASSED[0m[31m        [ 25%][0m
tests/runtime/test_dry_run.py::test_dry_run_simulates_positions [32mPASSED[0m[31m   [ 25%][0m
tests/runtime/test_dry_run.py::test_dry_run_logs_actions [32mPASSED[0m[31m          [ 25%][0m
tests/runtime/test_dry_run.py::test_dry_run_validates_operations [32mPASSED[0m[31m  [ 25%][0m
tests/runtime/test_dry_run.py::test_dry_run_tracks_simulated_state [32mPASSED[0m[31m [ 25%][0m
tests/runtime/test_dry_run.py::test_dry_run_pnl_calculation [31mFAILED[0m[31m       [ 25%][0m
tests/runtime/test_dry_run.py::test_dry_run_state_isolation [32mPASSED[0m[31m       [ 25%][0m
tests/runtime/test_dry_run.py::test_dry_run_vs_real_comparison [31mFAILED[0m[31m    [ 25%][0m
tests/runtime/test_dry_run.py::test_dry_run_same_logic [32mPASSED[0m[31m            [ 26%][0m
tests/runtime/test_dry_run.py::test_dry_run_detects_errors [32mPASSED[0m[31m        [ 26%][0m
tests/runtime/test_dry_run.py::test_dry_run_error_handling [32mPASSED[0m[31m        [ 26%][0m
tests/runtime/test_dry_run.py::test_dry_run_generates_report [32mPASSED[0m[31m      [ 26%][0m
tests/runtime/test_dry_run.py::test_dry_run_summary_statistics [32mPASSED[0m[31m    [ 26%][0m
tests/runtime/test_heartbeat.py::test_heartbeat_initial_alive [32mPASSED[0m[31m     [ 26%][0m
tests/runtime/test_heartbeat.py::test_heartbeat_regular_updates [32mPASSED[0m[31m   [ 26%][0m
tests/runtime/test_heartbeat.py::test_heartbeat_timestamp_recent [32mPASSED[0m[31m  [ 27%][0m
tests/runtime/test_heartbeat.py::test_heartbeat_health_status_healthy [32mPASSED[0m[31m [ 27%][0m
tests/runtime/test_heartbeat.py::test_heartbeat_continuous_monitoring [32mPASSED[0m[31m [ 27%][0m
tests/runtime/test_heartbeat.py::test_heartbeat_timeout_failure [32mPASSED[0m[31m   [ 27%][0m
tests/runtime/test_heartbeat.py::test_heartbeat_monitor_stopped [32mPASSED[0m[31m   [ 27%][0m
tests/runtime/test_heartbeat.py::test_heartbeat_degraded_health [32mPASSED[0m[31m   [ 27%][0m
tests/runtime/test_heartbeat.py::test_heartbeat_unhealthy_status [32mPASSED[0m[31m  [ 27%][0m
tests/runtime/test_heartbeat.py::test_heartbeat_uptime_tracking [32mPASSED[0m[31m   [ 27%][0m
tests/runtime/test_heartbeat.py::test_heartbeat_uptime_reset_on_restart [32mPASSED[0m[31m [ 28%][0m
tests/runtime/test_heartbeat.py::test_heartbeat_recovery_after_pause [32mPASSED[0m[31m [ 28%][0m
tests/runtime/test_heartbeat.py::test_heartbeat_automatic_restart [32mPASSED[0m[31m [ 28%][0m
tests/runtime/test_heartbeat.py::test_heartbeat_metrics_collection [32mPASSED[0m[31m [ 28%][0m
tests/runtime/test_heartbeat.py::test_heartbeat_interval_consistency [32mPASSED[0m[31m [ 28%][0m
tests/runtime/test_post_conditions.py::test_post_condition_state_valid_after_trade [32mPASSED[0m[31m [ 28%][0m
tests/runtime/test_post_conditions.py::test_post_condition_positions_consistent [32mPASSED[0m[31m [ 28%][0m
tests/runtime/test_post_conditions.py::test_post_condition_rules_enforced [32mPASSED[0m[31m [ 29%][0m
tests/runtime/test_post_conditions.py::test_post_condition_event_bus_operational [31mFAILED[0m[31m [ 29%][0m
tests/runtime/test_post_conditions.py::test_post_condition_memory_bounds [32mPASSED[0m[31m [ 29%][0m
tests/runtime/test_post_conditions.py::test_post_condition_invalid_state [32mPASSED[0m[31m [ 29%][0m
tests/runtime/test_post_conditions.py::test_post_condition_data_inconsistency [32mPASSED[0m[31m [ 29%][0m
tests/runtime/test_post_conditions.py::test_post_condition_constraint_violated [32mPASSED[0m[31m [ 29%][0m
tests/runtime/test_post_conditions.py::test_post_condition_timeout [32mPASSED[0m[31m [ 29%][0m
tests/runtime/test_post_conditions.py::test_post_condition_multiple_checks [32mPASSED[0m[31m [ 30%][0m
tests/runtime/test_post_conditions.py::test_post_condition_partial_failure [32mPASSED[0m[31m [ 30%][0m
tests/runtime/test_post_conditions.py::test_post_condition_invariant_maintained [32mPASSED[0m[31m [ 30%][0m
tests/runtime/test_post_conditions.py::test_post_condition_referential_integrity [32mPASSED[0m[31m [ 30%][0m
tests/runtime/test_post_conditions.py::test_post_condition_audit_trail [32mPASSED[0m[31m [ 30%][0m
tests/runtime/test_smoke.py::test_smoke_basic_startup_success [32mPASSED[0m[31m     [ 30%][0m
tests/runtime/test_smoke.py::test_smoke_configuration_load_success [32mPASSED[0m[31m [ 30%][0m
tests/runtime/test_smoke.py::test_smoke_event_bus_success [31mFAILED[0m[31m         [ 30%][0m
tests/runtime/test_smoke.py::test_smoke_rule_engine_success [32mPASSED[0m[31m       [ 31%][0m
tests/runtime/test_smoke.py::test_smoke_state_tracking_success [31mFAILED[0m[31m    [ 31%][0m
tests/runtime/test_smoke.py::test_smoke_missing_config_failure [32mPASSED[0m[31m    [ 31%][0m
tests/runtime/test_smoke.py::test_smoke_invalid_config_failure [32mPASSED[0m[31m    [ 31%][0m
tests/runtime/test_smoke.py::test_smoke_startup_timeout_failure [32mPASSED[0m[31m   [ 31%][0m
tests/runtime/test_smoke.py::test_smoke_dependency_failure [32mPASSED[0m[31m        [ 31%][0m
tests/runtime/test_smoke.py::test_smoke_full_suite_success [32mPASSED[0m[31m        [ 31%][0m
tests/runtime/test_smoke.py::test_smoke_partial_failure [32mPASSED[0m[31m           [ 32%][0m
tests/runtime/test_smoke.py::test_smoke_log_output_verification [32mPASSED[0m[31m   [ 32%][0m
tests/runtime/test_smoke.py::test_smoke_error_log_output [32mPASSED[0m[31m          [ 32%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_load_from_env_variables [32mPASSED[0m[31m [ 32%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_env_variables_override_defaults [32mPASSED[0m[31m [ 32%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_explicit_params_override_env [31mFAILED[0m[31m [ 32%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_partial_env_variables [31mFAILED[0m[31m [ 32%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_env_variable_case_insensitive [32mPASSED[0m[31m [ 32%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_env_variable_with_prefix [32mPASSED[0m[31m [ 33%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_boolean_env_variables [32mPASSED[0m[31m [ 33%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_integer_env_variables [32mPASSED[0m[31m [ 33%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_float_env_variables [32mPASSED[0m[31m [ 33%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_optional_env_variables [32mPASSED[0m[31m [ 33%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_missing_optional_env_variables [31mFAILED[0m[31m [ 33%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_env_file_loading [31mFAILED[0m[31m [ 33%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_env_variables_override_env_file [31mFAILED[0m[31m [ 34%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_empty_env_variable [32mPASSED[0m[31m [ 34%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_whitespace_env_variable [32mPASSED[0m[31m [ 34%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_env_variable_with_special_characters [32mPASSED[0m[31m [ 34%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_multiline_env_variable [32mPASSED[0m[31m [ 34%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_env_variable_validation_alias [32mPASSED[0m[31m [ 34%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_url_env_variables [32mPASSED[0m[31m [ 34%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_all_fields_from_env [32mPASSED[0m[31m [ 35%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_env_variable_type_coercion_errors [32mPASSED[0m[31m [ 35%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_missing_required_env_variable [31mFAILED[0m[31m [ 35%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_env_file_with_comments [31mFAILED[0m[31m [ 35%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_env_file_with_quotes [31mFAILED[0m[31m [ 35%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_env_file_with_equals_in_value [32mPASSED[0m[31m [ 35%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_env_file_missing [32mPASSED[0m[31m [ 35%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_combined_yaml_and_env [31mFAILED[0m[31m [ 35%][0m
tests/unit/test_config/test_env_substitution.py::TestEnvironmentVariableSubstitution::test_env_variable_unicode [32mPASSED[0m[31m [ 36%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_valid_yaml_file [31mFAILED[0m[31m [ 36%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_yaml_with_all_fields [31mFAILED[0m[31m [ 36%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_yaml_minimal_required_only [31mFAILED[0m[31m [ 36%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_yaml_missing_required_field [31mFAILED[0m[31m [ 36%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_nonexistent_file [32mPASSED[0m[31m [ 36%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_empty_yaml_file [31mFAILED[0m[31m [ 36%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_yaml_with_null_values [31mFAILED[0m[31m [ 37%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_yaml_with_comments [31mFAILED[0m[31m [ 37%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_yaml_with_extra_fields [31mFAILED[0m[31m [ 37%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_yaml_with_nested_structure [31mFAILED[0m[31m [ 37%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_yaml_with_boolean_strings [32mPASSED[0m[31m [ 37%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_yaml_with_numeric_strings [32mPASSED[0m[31m [ 37%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_yaml_with_invalid_yaml_syntax [32mPASSED[0m[31m [ 37%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_yaml_with_duplicate_keys [32mPASSED[0m[31m [ 37%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_from_string_path [31mFAILED[0m[31m [ 38%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_from_pathlib_path [31mFAILED[0m[31m [ 38%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_yaml_with_list_values [31mFAILED[0m[31m [ 38%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_yaml_with_scientific_notation [31mFAILED[0m[31m [ 38%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_yaml_with_multiline_strings [31mFAILED[0m[31m [ 38%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_yaml_preserves_field_types [32mPASSED[0m[31m [ 38%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_yaml_with_special_characters_in_strings [31mFAILED[0m[31m [ 38%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_yaml_with_unicode_characters [31mFAILED[0m[31m [ 39%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_yaml_file_permission_error [32mPASSED[0m[31m [ 39%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_yaml_relative_path [31mFAILED[0m[31m [ 39%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_load_yaml_absolute_path [31mFAILED[0m[31m [ 39%][0m
tests/unit/test_config/test_loader.py::TestConfigLoader::test_to_dict_roundtrip [31mFAILED[0m[31m [ 39%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_valid_config_minimal [31mFAILED[0m[31m [ 39%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_valid_config_all_fields [31mFAILED[0m[31m [ 39%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_missing_required_field_api_key [31mFAILED[0m[31m [ 40%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_missing_required_field_username [31mFAILED[0m[31m [ 40%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_missing_both_required_fields [31mFAILED[0m[31m [ 40%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_invalid_max_contracts_negative [32mPASSED[0m[31m [ 40%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_invalid_max_contracts_zero [32mPASSED[0m[31m [ 40%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_max_daily_loss_positive [32mPASSED[0m[31m [ 40%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_max_daily_loss_zero [32mPASSED[0m[31m [ 40%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_optional_fields_none [31mFAILED[0m[31m [ 40%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_log_level_valid_values [32mPASSED[0m[31m [ 41%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_log_level_case_insensitive [32mPASSED[0m[31m [ 41%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_boolean_fields_true [32mPASSED[0m[31m [ 41%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_boolean_fields_false [32mPASSED[0m[31m [ 41%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_integer_fields_valid [32mPASSED[0m[31m [ 41%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_float_fields_valid [32mPASSED[0m[31m [ 41%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_string_fields_empty [31mFAILED[0m[31m [ 41%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_extra_fields_ignored [32mPASSED[0m[31m [ 42%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_to_dict_method [31mFAILED[0m[31m [ 42%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_model_dump_includes_all_fields [32mPASSED[0m[31m [ 42%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_environment_field_values [32mPASSED[0m[31m [ 42%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_url_fields_format [31mFAILED[0m[31m [ 42%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_type_coercion_string_to_int [32mPASSED[0m[31m [ 42%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_type_coercion_string_to_float [32mPASSED[0m[31m [ 42%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_type_coercion_string_to_bool [32mPASSED[0m[31m [ 42%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_invalid_type_for_int_field [32mPASSED[0m[31m [ 43%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_invalid_type_for_float_field [32mPASSED[0m[31m [ 43%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_config_equality [32mPASSED[0m[31m [ 43%][0m
tests/unit/test_config/test_models.py::TestRiskConfigModel::test_config_immutability_after_creation [32mPASSED[0m[31m [ 43%][0m
tests/unit/test_config/test_validator.py::TestFieldValidation::test_positive_max_contracts_valid [32mPASSED[0m[31m [ 43%][0m
tests/unit/test_config/test_validator.py::TestFieldValidation::test_zero_max_contracts_valid [32mPASSED[0m[31m [ 43%][0m
tests/unit/test_config/test_validator.py::TestFieldValidation::test_negative_max_contracts_allowed [32mPASSED[0m[31m [ 43%][0m
tests/unit/test_config/test_validator.py::TestFieldValidation::test_negative_max_daily_loss_valid [32mPASSED[0m[31m [ 44%][0m
tests/unit/test_config/test_validator.py::TestFieldValidation::test_positive_max_daily_loss_allowed [32mPASSED[0m[31m [ 44%][0m
tests/unit/test_config/test_validator.py::TestFieldValidation::test_zero_max_daily_loss_valid [32mPASSED[0m[31m [ 44%][0m
tests/unit/test_config/test_validator.py::TestFieldValidation::test_positive_grace_seconds_valid [32mPASSED[0m[31m [ 44%][0m
tests/unit/test_config/test_validator.py::TestFieldValidation::test_zero_grace_seconds_valid [32mPASSED[0m[31m [ 44%][0m
tests/unit/test_config/test_validator.py::TestFieldValidation::test_negative_grace_seconds_allowed [32mPASSED[0m[31m [ 44%][0m
tests/unit/test_config/test_validator.py::TestFieldValidation::test_positive_latency_target_valid [32mPASSED[0m[31m [ 44%][0m
tests/unit/test_config/test_validator.py::TestFieldValidation::test_positive_max_events_valid [32mPASSED[0m[31m [ 45%][0m
tests/unit/test_config/test_validator.py::TestFieldValidation::test_empty_string_api_key_valid [31mFAILED[0m[31m [ 45%][0m
tests/unit/test_config/test_validator.py::TestFieldValidation::test_empty_string_username_valid [31mFAILED[0m[31m [ 45%][0m
tests/unit/test_config/test_validator.py::TestFieldValidation::test_whitespace_string_api_key_valid [31mFAILED[0m[31m [ 45%][0m
tests/unit/test_config/test_validator.py::TestFieldValidation::test_valid_log_levels [32mPASSED[0m[31m [ 45%][0m
tests/unit/test_config/test_validator.py::TestFieldValidation::test_lowercase_log_level_valid [32mPASSED[0m[31m [ 45%][0m
tests/unit/test_config/test_validator.py::TestFieldValidation::test_invalid_log_level_allowed [32mPASSED[0m[31m [ 45%][0m
tests/unit/test_config/test_validator.py::TestFieldValidation::test_valid_environment_values [32mPASSED[0m[31m [ 45%][0m
tests/unit/test_config/test_validator.py::TestFieldValidation::test_invalid_environment_allowed [32mPASSED[0m[31m [ 46%][0m
tests/unit/test_config/test_validator.py::TestFieldValidation::test_valid_url_formats [32mPASSED[0m[31m [ 46%][0m
tests/unit/test_config/test_validator.py::TestFieldValidation::test_invalid_url_format_allowed [31mFAILED[0m[31m [ 46%][0m
tests/unit/test_config/test_validator.py::TestModelValidation::test_all_required_fields_present [31mFAILED[0m[31m [ 46%][0m
tests/unit/test_config/test_validator.py::TestModelValidation::test_conflicting_ai_settings_allowed [31mFAILED[0m[31m [ 46%][0m
tests/unit/test_config/test_validator.py::TestModelValidation::test_ai_features_without_enable_ai_allowed [32mPASSED[0m[31m [ 46%][0m
tests/unit/test_config/test_validator.py::TestModelValidation::test_notifications_without_credentials_allowed [32mPASSED[0m[31m [ 46%][0m
tests/unit/test_config/test_validator.py::TestModelValidation::test_debug_in_production_allowed [32mPASSED[0m[31m [ 47%][0m
tests/unit/test_config/test_validator.py::TestModelValidation::test_low_latency_with_high_events_allowed [32mPASSED[0m[31m [ 47%][0m
tests/unit/test_config/test_validator.py::TestTypeValidation::test_string_to_int_coercion [32mPASSED[0m[31m [ 47%][0m
tests/unit/test_config/test_validator.py::TestTypeValidation::test_string_to_float_coercion [32mPASSED[0m[31m [ 47%][0m
tests/unit/test_config/test_validator.py::TestTypeValidation::test_string_to_bool_coercion_true [32mPASSED[0m[31m [ 47%][0m
tests/unit/test_config/test_validator.py::TestTypeValidation::test_string_to_bool_coercion_false [32mPASSED[0m[31m [ 47%][0m
tests/unit/test_config/test_validator.py::TestTypeValidation::test_int_to_float_coercion [32mPASSED[0m[31m [ 47%][0m
tests/unit/test_config/test_validator.py::TestTypeValidation::test_float_to_int_coercion [31mFAILED[0m[31m [ 47%][0m
tests/unit/test_config/test_validator.py::TestTypeValidation::test_invalid_string_to_int_raises_error [32mPASSED[0m[31m [ 48%][0m
tests/unit/test_config/test_validator.py::TestTypeValidation::test_invalid_string_to_float_raises_error [32mPASSED[0m[31m [ 48%][0m
tests/unit/test_config/test_validator.py::TestTypeValidation::test_list_to_string_raises_error [31mFAILED[0m[31m [ 48%][0m
tests/unit/test_config/test_validator.py::TestTypeValidation::test_dict_to_string_raises_error [31mFAILED[0m[31m [ 48%][0m
tests/unit/test_config/test_validator.py::TestTypeValidation::test_none_for_required_field_raises_error [31mFAILED[0m[31m [ 48%][0m
tests/unit/test_config/test_validator.py::TestTypeValidation::test_none_for_optional_field_valid [31mFAILED[0m[31m [ 48%][0m
tests/unit/test_config/test_validator.py::TestErrorMessages::test_missing_required_field_error_message [31mFAILED[0m[31m [ 48%][0m
tests/unit/test_config/test_validator.py::TestErrorMessages::test_invalid_type_error_message [32mPASSED[0m[31m [ 49%][0m
tests/unit/test_config/test_validator.py::TestErrorMessages::test_multiple_errors_reported [31mFAILED[0m[31m [ 49%][0m
tests/unit/test_config/test_validator.py::TestErrorMessages::test_error_includes_field_location [31mFAILED[0m[31m [ 49%][0m
tests/unit/test_config/test_validator.py::TestEdgeCases::test_very_large_max_contracts [32mPASSED[0m[31m [ 49%][0m
tests/unit/test_config/test_validator.py::TestEdgeCases::test_very_large_loss_limit [32mPASSED[0m[31m [ 49%][0m
tests/unit/test_config/test_validator.py::TestEdgeCases::test_very_small_latency_target [32mPASSED[0m[31m [ 49%][0m
tests/unit/test_config/test_validator.py::TestEdgeCases::test_very_high_event_rate [32mPASSED[0m[31m [ 49%][0m
tests/unit/test_config/test_validator.py::TestEdgeCases::test_very_long_strings [31mFAILED[0m[31m [ 50%][0m
tests/unit/test_config/test_validator.py::TestEdgeCases::test_special_characters_in_all_string_fields [31mFAILED[0m[31m [ 50%][0m
tests/unit/test_core/test_enforcement_wiring.py::TestEnforcementWiring::test_engine_accepts_trading_integration [32mPASSED[0m[31m [ 50%][0m
tests/unit/test_core/test_enforcement_wiring.py::TestEnforcementWiring::test_flatten_all_calls_trading_integration [32mPASSED[0m[31m [ 50%][0m
tests/unit/test_core/test_enforcement_wiring.py::TestEnforcementWiring::test_flatten_all_without_trading_integration [32mPASSED[0m[31m [ 50%][0m
tests/unit/test_core/test_enforcement_wiring.py::TestEnforcementWiring::test_enforcement_from_violation [32mPASSED[0m[31m [ 50%][0m
tests/unit/test_core/test_events.py::TestEventBus::test_create_event_bus [32mPASSED[0m[31m [ 50%][0m
tests/unit/test_core/test_events.py::TestEventBus::test_subscribe_to_event [32mPASSED[0m[31m [ 50%][0m
tests/unit/test_core/test_events.py::TestEventBus::test_subscribe_multiple_callbacks [32mPASSED[0m[31m [ 51%][0m
tests/unit/test_core/test_events.py::TestEventBus::test_unsubscribe_from_event [32mPASSED[0m[31m [ 51%][0m
tests/unit/test_core/test_events.py::TestRiskEvent::test_create_event [32mPASSED[0m[31m [ 51%][0m
tests/unit/test_core/test_events.py::TestRiskEvent::test_event_has_timestamp [32mPASSED[0m[31m [ 51%][0m
tests/unit/test_core/test_events.py::TestEventType::test_event_types_exist [32mPASSED[0m[31m [ 51%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_rule_initialization [32mPASSED[0m[31m [ 51%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_rule_initialization_custom_settings [32mPASSED[0m[31m [ 51%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_sdk_disconnected_creates_alert [32mPASSED[0m[31m [ 52%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_sdk_disconnected_updates_connection_state [32mPASSED[0m[31m [ 52%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_sdk_disconnected_disabled_returns_none [32mPASSED[0m[31m [ 52%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_sdk_disconnected_no_account_id_returns_none [32mPASSED[0m[31m [ 52%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_sdk_connected_no_alert [32mPASSED[0m[31m [ 52%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_sdk_connected_updates_connection_state [32mPASSED[0m[31m [ 52%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_auth_failed_creates_alert [32mPASSED[0m[31m [ 52%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_auth_failed_disabled_returns_none [32mPASSED[0m[31m [ 52%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_auth_failed_no_account_id_returns_none [32mPASSED[0m[31m [ 53%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_auth_success_no_alert [32mPASSED[0m[31m [ 53%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_position_updated_ignored [32mPASSED[0m[31m [ 53%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_order_filled_ignored [32mPASSED[0m[31m [ 53%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_trade_executed_ignored [32mPASSED[0m[31m [ 53%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_get_connection_status_unknown_account [32mPASSED[0m[31m [ 53%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_get_connection_status_known_account [32mPASSED[0m[31m [ 53%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_get_last_alert_time_unknown_account [32mPASSED[0m[31m [ 54%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_last_alert_time_tracked [32mPASSED[0m[31m [ 54%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_multiple_accounts_independent [32mPASSED[0m[31m [ 54%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_one_account_reconnects [32mPASSED[0m[31m [ 54%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_enforce_does_nothing [32mPASSED[0m[31m [ 54%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_disconnect_alert_has_required_fields [32mPASSED[0m[31m [ 54%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_auth_failed_alert_has_required_fields [32mPASSED[0m[31m [ 54%][0m
tests/unit/test_rules/test_auth_loss_guard.py::TestAuthLossGuardRuleUnit::test_alert_timestamp_is_iso_format [32mPASSED[0m[31m [ 55%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_rule_initialization [32mPASSED[0m[31m [ 55%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_rule_initialization_validates_thresholds [32mPASSED[0m[31m [ 55%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_rule_initialization_validates_duration [32mPASSED[0m[31m [ 55%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_rule_initialization_sorts_thresholds [32mPASSED[0m[31m [ 55%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_winning_trade_no_cooldown [32mPASSED[0m[31m [ 55%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_breakeven_trade_no_cooldown [32mPASSED[0m[31m [ 55%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_small_loss_below_threshold [32mPASSED[0m[31m [ 55%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_loss_at_threshold_triggers_cooldown [32mPASSED[0m[31m [ 56%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_loss_exceeds_threshold_triggers_cooldown [32mPASSED[0m[31m [ 56%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_tiered_cooldown_tier1 [32mPASSED[0m[31m [ 56%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_tiered_cooldown_tier2 [32mPASSED[0m[31m [ 56%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_tiered_cooldown_tier3 [32mPASSED[0m[31m [ 56%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_tiered_cooldown_selects_highest_tier [32mPASSED[0m[31m [ 56%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_cooldown_starts_timer [31mFAILED[0m[31m [ 56%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_cooldown_expires_unlocks_account [31mFAILED[0m[31m [ 57%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_already_in_cooldown_skips_evaluation [32mPASSED[0m[31m [ 57%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_half_turn_trade_ignored [32mPASSED[0m[31m [ 57%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_only_evaluates_trade_executed_events [32mPASSED[0m[31m [ 57%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_evaluates_position_closed_events [32mPASSED[0m[31m [ 57%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_missing_account_id [32mPASSED[0m[31m [ 57%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_missing_pnl_field [32mPASSED[0m[31m [ 57%][0m
tests/unit/test_rules/test_cooldown_after_loss.py::TestCooldownAfterLossRule::test_violation_message_clarity [32mPASSED[0m[31m [ 57%][0m
tests/unit/test_rules/test_daily_realized_loss.py::TestDailyRealizedLossRule::test_rule_initialization [32mPASSED[0m[31m [ 58%][0m
tests/unit/test_rules/test_daily_realized_loss.py::TestDailyRealizedLossRule::test_rule_initialization_custom_limit [32mPASSED[0m[31m [ 58%][0m
tests/unit/test_rules/test_daily_realized_loss.py::TestDailyRealizedLossRule::test_rule_initialization_validates_limit [32mPASSED[0m[31m [ 58%][0m
tests/unit/test_rules/test_daily_realized_loss.py::TestDailyRealizedLossRule::test_loss_below_limit_passes [32mPASSED[0m[31m [ 58%][0m
tests/unit/test_rules/test_daily_realized_loss.py::TestDailyRealizedLossRule::test_profitable_day_passes [32mPASSED[0m[31m [ 58%][0m
tests/unit/test_rules/test_daily_realized_loss.py::TestDailyRealizedLossRule::test_loss_at_limit_passes [32mPASSED[0m[31m [ 58%][0m
tests/unit/test_rules/test_daily_realized_loss.py::TestDailyRealizedLossRule::test_loss_exceeds_limit_violates [32mPASSED[0m[31m [ 58%][0m
tests/unit/test_rules/test_daily_realized_loss.py::TestDailyRealizedLossRule::test_large_loss_violates [32mPASSED[0m[31m [ 59%][0m
tests/unit/test_rules/test_daily_realized_loss.py::TestDailyRealizedLossRule::test_violation_triggers_lockout [32mPASSED[0m[31m [ 59%][0m
tests/unit/test_rules/test_daily_realized_loss.py::TestDailyRealizedLossRule::test_lockout_persists_until_reset [32mPASSED[0m[31m [ 59%][0m
tests/unit/test_rules/test_daily_realized_loss.py::TestDailyRealizedLossRule::test_multi_symbol_loss_tracking [32mPASSED[0m[31m [ 59%][0m
tests/unit/test_rules/test_daily_realized_loss.py::TestDailyRealizedLossRule::test_ignores_half_turn_trades [32mPASSED[0m[31m [ 59%][0m
tests/unit/test_rules/test_daily_realized_loss.py::TestDailyRealizedLossRule::test_counts_only_closed_positions [32mPASSED[0m[31m [ 59%][0m
tests/unit/test_rules/test_daily_realized_loss.py::TestDailyRealizedLossRule::test_approaching_limit_warning [32mPASSED[0m[31m [ 59%][0m
tests/unit/test_rules/test_daily_realized_loss.py::TestDailyRealizedLossRule::test_rule_disabled_when_locked [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_rules/test_daily_realized_loss.py::TestDailyRealizedLossRule::test_enforcement_action_correct [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_rules/test_daily_realized_loss.py::TestDailyRealizedLossRule::test_only_evaluates_pnl_events [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_rules/test_daily_realized_loss.py::TestDailyRealizedLossRule::test_evaluates_pnl_updated_event [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_rules/test_daily_realized_loss.py::TestDailyRealizedLossRule::test_zero_pnl [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_rules/test_daily_realized_loss.py::TestDailyRealizedLossRule::test_missing_pnl_data [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_rules/test_daily_realized_loss.py::TestDailyRealizedLossRule::test_violation_message_clarity [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_rule_initialization [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_rule_initialization_custom_target [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_rule_initialization_validates_target [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_profit_below_target_passes [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_losing_day_passes [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_profit_at_target_violates [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_profit_exceeds_target_violates [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_large_profit_violates [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_violation_triggers_lockout [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_lockout_persists_until_reset [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_multi_symbol_profit_tracking [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_ignores_half_turn_trades [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_counts_only_closed_positions [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_approaching_target_no_violation [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_rule_disabled_when_locked [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_enforcement_action_correct [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_only_evaluates_pnl_events [32mPASSED[0m[31m [ 63%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_evaluates_pnl_updated_event [32mPASSED[0m[31m [ 63%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_zero_pnl [32mPASSED[0m[31m [ 63%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_missing_pnl_data [32mPASSED[0m[31m [ 63%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_violation_message_clarity [32mPASSED[0m[31m [ 63%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_mixed_trades_reach_target [32mPASSED[0m[31m [ 63%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_success_message_positive_tone [32mPASSED[0m[31m [ 63%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_cannot_trigger_both_profit_and_loss [32mPASSED[0m[31m [ 64%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_rule_can_be_disabled [32mPASSED[0m[31m [ 64%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_enforce_method_sets_lockout [32mPASSED[0m[31m [ 64%][0m
tests/unit/test_rules/test_daily_realized_profit.py::TestDailyRealizedProfitRule::test_reset_time_calculation [32mPASSED[0m[31m [ 64%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_rule_initialization [32mPASSED[0m[31m [ 64%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_rule_initialization_validates_negative_limit [32mPASSED[0m[31m [ 64%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_loss_within_limit_passes [32mPASSED[0m[31m [ 64%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_zero_loss_passes [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_profit_does_not_trigger [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_loss_at_exact_limit_violates [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_loss_exceeds_limit_violates [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_short_position_loss_exceeds_limit [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_violation_targets_specific_position_only [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_violation_does_not_create_lockout [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_multi_symbol_independent_tracking [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_long_position_pnl_calculation [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_es_position_pnl_calculation [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_only_evaluates_position_events [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_evaluates_position_updated_event [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_missing_market_price_returns_none [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_missing_position_data_returns_none [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_small_loss_within_limit [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_disabled_rule_does_not_trigger [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_rule_name [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_rty_symbol_tick_calculation [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_evaluates_position_opened_event [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_rules/test_daily_unrealized_loss.py::TestDailyUnrealizedLossRule::test_zero_size_position_returns_zero_pnl [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_rules/test_max_position_rule.py::TestMaxPositionRuleUnit::test_rule_initialization [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_rules/test_max_position_rule.py::TestMaxPositionRuleUnit::test_rule_initialization_custom_action [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_rules/test_max_position_rule.py::TestMaxPositionRuleUnit::test_position_below_limit_passes [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_rules/test_max_position_rule.py::TestMaxPositionRuleUnit::test_zero_position_passes [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_rules/test_max_position_rule.py::TestMaxPositionRuleUnit::test_position_at_limit_passes [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_rules/test_max_position_rule.py::TestMaxPositionRuleUnit::test_position_exceeds_limit_violates [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_rules/test_max_position_rule.py::TestMaxPositionRuleUnit::test_large_position_violates [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_rules/test_max_position_rule.py::TestMaxPositionRuleUnit::test_multi_symbol_total_below_limit [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_rules/test_max_position_rule.py::TestMaxPositionRuleUnit::test_multi_symbol_total_exceeds_limit [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_rules/test_max_position_rule.py::TestMaxPositionRuleUnit::test_short_position_below_limit [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_rules/test_max_position_rule.py::TestMaxPositionRuleUnit::test_short_position_exceeds_limit [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_rules/test_max_position_rule.py::TestMaxPositionRuleUnit::test_flatten_action_in_violation [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_rules/test_max_position_rule.py::TestMaxPositionRuleUnit::test_reject_action_in_violation [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_rules/test_max_position_rule.py::TestMaxPositionRuleUnit::test_only_evaluates_position_events [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_rules/test_max_position_rule.py::TestMaxPositionRuleUnit::test_evaluates_order_filled_event [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_rules/test_max_position_rule.py::TestMaxPositionRuleUnit::test_negative_limit_raises_error [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_rules/test_max_position_rule.py::TestMaxPositionRuleUnit::test_zero_limit [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_rules/test_max_position_rule.py::TestMaxPositionRuleUnit::test_missing_position_data [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_rules/test_max_position_rule.py::TestMaxPositionRuleUnit::test_violation_message_clarity [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_rules/test_max_unrealized_profit.py::TestMaxUnrealizedProfitRule::test_rule_initialization [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_rules/test_max_unrealized_profit.py::TestMaxUnrealizedProfitRule::test_rule_initialization_validates_positive_target [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_rules/test_max_unrealized_profit.py::TestMaxUnrealizedProfitRule::test_profit_below_target_passes [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_rules/test_max_unrealized_profit.py::TestMaxUnrealizedProfitRule::test_zero_profit_passes [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_rules/test_max_unrealized_profit.py::TestMaxUnrealizedProfitRule::test_profit_at_exact_target_passes [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_rules/test_max_unrealized_profit.py::TestMaxUnrealizedProfitRule::test_profit_exceeds_target_violates [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_rules/test_max_unrealized_profit.py::TestMaxUnrealizedProfitRule::test_short_position_profit_exceeds_target [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_rules/test_max_unrealized_profit.py::TestMaxUnrealizedProfitRule::test_violation_targets_specific_position_only [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_rules/test_max_unrealized_profit.py::TestMaxUnrealizedProfitRule::test_violation_does_not_create_lockout [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_rules/test_max_unrealized_profit.py::TestMaxUnrealizedProfitRule::test_multi_symbol_independent_tracking [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_rules/test_max_unrealized_profit.py::TestMaxUnrealizedProfitRule::test_long_position_pnl_calculation [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_rules/test_max_unrealized_profit.py::TestMaxUnrealizedProfitRule::test_mnq_position_pnl_calculation [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_rules/test_max_unrealized_profit.py::TestMaxUnrealizedProfitRule::test_only_evaluates_position_events [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_rules/test_max_unrealized_profit.py::TestMaxUnrealizedProfitRule::test_evaluates_position_updated_event [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_rules/test_max_unrealized_profit.py::TestMaxUnrealizedProfitRule::test_missing_market_price_returns_none [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_rules/test_max_unrealized_profit.py::TestMaxUnrealizedProfitRule::test_missing_position_data_returns_none [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_rules/test_no_stop_loss_grace.py::test_rule_initialization [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_rules/test_no_stop_loss_grace.py::test_rule_can_be_disabled [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_rules/test_no_stop_loss_grace.py::test_position_opened_starts_grace_period_timer [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_rules/test_no_stop_loss_grace.py::test_position_opened_with_zero_size_ignored [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_rules/test_no_stop_loss_grace.py::test_position_opened_missing_contract_id_ignored [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_rules/test_no_stop_loss_grace.py::test_stop_order_placed_cancels_grace_period [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_rules/test_no_stop_loss_grace.py::test_stop_order_without_stop_price_ignored [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_rules/test_no_stop_loss_grace.py::test_non_stop_order_ignored [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_rules/test_no_stop_loss_grace.py::test_stop_order_for_different_position_ignored [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_rules/test_no_stop_loss_grace.py::test_grace_period_expiry_closes_position [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_rules/test_no_stop_loss_grace.py::test_grace_period_expiry_with_actual_timer [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_rules/test_no_stop_loss_grace.py::test_position_closed_cancels_grace_period [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_rules/test_no_stop_loss_grace.py::test_multiple_positions_tracked_separately [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_rules/test_no_stop_loss_grace.py::test_rule_disabled_no_timers_started [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_rules/test_no_stop_loss_grace.py::test_get_status [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_rules/test_no_stop_loss_grace.py::test_position_reopened_restarts_timer [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_rules/test_no_stop_loss_grace.py::test_enforcement_failure_logged [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_rules/test_no_stop_loss_grace.py::test_ignore_non_position_and_order_events [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_rule_initialization [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_rule_initialization_with_custom_hours [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_rule_initialization_validates_time_format [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_rule_disabled_when_config_disabled [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_converts_et_to_utc_correctly [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_handles_dst_transitions [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_trading_inside_hours_passes [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_trading_at_session_start_passes [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_trading_just_before_session_end_passes [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_trading_before_session_start_violates [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_trading_after_session_end_violates [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_trading_at_session_end_violates [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_trading_on_saturday_violates [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_trading_on_sunday_violates [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_weekend_blocking_can_be_disabled [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_violation_triggers_lockout_until_session_start [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_lockout_skips_weekends [32mPASSED[0m[31m [ 77%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_enforcement_sets_lockout [32mPASSED[0m[31m [ 77%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_only_evaluates_position_events [32mPASSED[0m[31m [ 77%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_evaluates_position_opened_event [32mPASSED[0m[31m [ 77%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_handles_missing_account_id_gracefully [32mPASSED[0m[31m [ 77%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_rule_disabled_skips_evaluation [32mPASSED[0m[31m [ 77%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_already_locked_account_skips_evaluation [32mPASSED[0m[31m [ 77%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_violation_message_clarity [32mPASSED[0m[31m [ 77%][0m
tests/unit/test_rules/test_session_block_outside.py::TestSessionBlockOutsideRule::test_different_timezones_supported [32mPASSED[0m[31m [ 78%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_rule_initialization [32mPASSED[0m[31m [ 78%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_rule_initialization_with_wildcards [32mPASSED[0m[31m [ 78%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_rule_initialization_empty_list [32mPASSED[0m[31m [ 78%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_allowed_symbol_passes [32mPASSED[0m[31m [ 78%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_multiple_allowed_symbols_pass [32mPASSED[0m[31m [ 78%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_blocked_symbol_violates [32mPASSED[0m[31m [ 78%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_position_in_blocked_symbol_violates [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_all_blocked_symbols_violate [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_case_insensitive_uppercase [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_case_insensitive_lowercase [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_case_insensitive_mixed_case [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_wildcard_prefix_match [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_wildcard_contains_match [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_wildcard_no_match [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_wildcard_case_insensitive [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_evaluates_order_placed_event [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_evaluates_position_opened_event [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_evaluates_position_updated_event [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_ignores_irrelevant_events [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_no_lockout_on_violation [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_empty_blocked_list_allows_all [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_missing_symbol_in_event [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_none_symbol_in_event [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_disabled_rule_allows_all [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_violation_message_clarity [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_violation_includes_rule_name [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_multiple_exact_matches [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_rules/test_symbol_blocks.py::TestSymbolBlocksRuleUnit::test_mixed_exact_and_wildcard [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_rule_initialization [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_rule_initialization_custom_limits [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_rule_initialization_validates_limits [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_trades_within_minute_limit_passes [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_trades_within_hour_limit_passes [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_first_trade_of_day_passes [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_trades_at_minute_limit_passes [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_per_minute_limit_exceeded_violates [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_per_minute_limit_significantly_exceeded [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_per_hour_limit_exceeded_violates [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_per_session_limit_exceeded_violates [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_violation_starts_cooldown_timer [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_different_cooldowns_for_different_breaches [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_rolling_window_only_counts_recent_trades [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_old_trades_expire_from_window [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_multiple_accounts_tracked_independently [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_cooldown_auto_unlocks_via_timer [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_minute_limit_takes_priority [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_only_evaluates_trade_executed_events [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_evaluates_all_trade_types [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_missing_account_id [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_database_error_handled [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_zero_cooldown_duration [32mPASSED[0m[31m [ 85%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_violation_message_clarity [32mPASSED[0m[31m [ 85%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_violation_includes_countdown_info [32mPASSED[0m[31m [ 85%][0m
tests/unit/test_rules/test_trade_frequency_limit.py::TestTradeFrequencyLimitRule::test_rule_disabled_skips_evaluation [32mPASSED[0m[31m [ 85%][0m
tests/unit/test_rules/test_trade_management.py::TestTradeManagementRule::test_rule_initialization [32mPASSED[0m[31m [ 85%][0m
tests/unit/test_rules/test_trade_management.py::TestTradeManagementRule::test_rule_initialization_with_partial_config [32mPASSED[0m[31m [ 85%][0m
tests/unit/test_rules/test_trade_management.py::TestTradeManagementRule::test_place_stop_loss_on_long_position_open [32mPASSED[0m[31m [ 85%][0m
tests/unit/test_rules/test_trade_management.py::TestTradeManagementRule::test_place_stop_loss_on_short_position_open [32mPASSED[0m[31m [ 85%][0m
tests/unit/test_rules/test_trade_management.py::TestTradeManagementRule::test_place_take_profit_on_long_position_open [32mPASSED[0m[31m [ 86%][0m
tests/unit/test_rules/test_trade_management.py::TestTradeManagementRule::test_place_take_profit_on_short_position_open [32mPASSED[0m[31m [ 86%][0m
tests/unit/test_rules/test_trade_management.py::TestTradeManagementRule::test_place_bracket_order_on_position_open [32mPASSED[0m[31m [ 86%][0m
tests/unit/test_rules/test_trade_management.py::TestTradeManagementRule::test_adjust_trailing_stop_on_profit [32mPASSED[0m[31m [ 86%][0m
tests/unit/test_rules/test_trade_management.py::TestTradeManagementRule::test_trailing_stop_not_adjusted_on_loss [32mPASSED[0m[31m [ 86%][0m
tests/unit/test_rules/test_trade_management.py::TestTradeManagementRule::test_no_stop_loss_when_disabled [32mPASSED[0m[31m [ 86%][0m
tests/unit/test_rules/test_trade_management.py::TestTradeManagementRule::test_independent_management_per_symbol [32mPASSED[0m[31m [ 86%][0m
tests/unit/test_rules/test_trade_management.py::TestTradeManagementRule::test_only_evaluates_position_events [32mPASSED[0m[31m [ 87%][0m
tests/unit/test_rules/test_trade_management.py::TestTradeManagementRule::test_evaluates_position_opened_event [32mPASSED[0m[31m [ 87%][0m
tests/unit/test_rules/test_trade_management.py::TestTradeManagementRule::test_missing_symbol_returns_none [32mPASSED[0m[31m [ 87%][0m
tests/unit/test_rules/test_trade_management.py::TestTradeManagementRule::test_missing_position_data_returns_none [32mPASSED[0m[31m [ 87%][0m
tests/unit/test_rules/test_trade_management.py::TestTradeManagementRule::test_rule_disabled_returns_none [32mPASSED[0m[31m [ 87%][0m
tests/unit/test_rules/test_trade_management.py::TestTradeManagementRule::test_calculate_stop_price_long [32mPASSED[0m[31m [ 87%][0m
tests/unit/test_rules/test_trade_management.py::TestTradeManagementRule::test_calculate_stop_price_short [32mPASSED[0m[31m [ 87%][0m
tests/unit/test_rules/test_trade_management.py::TestTradeManagementRule::test_calculate_target_price_long [32mPASSED[0m[31m [ 87%][0m
tests/unit/test_rules/test_trade_management.py::TestTradeManagementRule::test_calculate_target_price_short [32mPASSED[0m[31m [ 88%][0m
tests/unit/test_state/test_lockout_manager.py::TestHardLockoutOperations::test_set_lockout_locks_account [32mPASSED[0m[31m [ 88%][0m
tests/unit/test_state/test_lockout_manager.py::TestHardLockoutOperations::test_is_locked_out_returns_true_when_locked [32mPASSED[0m[31m [ 88%][0m
tests/unit/test_state/test_lockout_manager.py::TestHardLockoutOperations::test_is_locked_out_returns_false_when_not_locked [32mPASSED[0m[31m [ 88%][0m
tests/unit/test_state/test_lockout_manager.py::TestHardLockoutOperations::test_get_lockout_info_returns_details [32mPASSED[0m[31m [ 88%][0m
tests/unit/test_state/test_lockout_manager.py::TestHardLockoutOperations::test_get_lockout_info_returns_none_when_not_locked [32mPASSED[0m[31m [ 88%][0m
tests/unit/test_state/test_lockout_manager.py::TestHardLockoutOperations::test_clear_lockout_removes_lockout [32mPASSED[0m[31m [ 88%][0m
tests/unit/test_state/test_lockout_manager.py::TestCooldownTimers::test_set_cooldown_creates_timer [32mPASSED[0m[31m [ 89%][0m
tests/unit/test_state/test_lockout_manager.py::TestCooldownTimers::test_cooldown_auto_expires_after_duration [32mPASSED[0m[31m [ 89%][0m
tests/unit/test_state/test_lockout_manager.py::TestCooldownTimers::test_cooldown_remaining_time_decreases [32mPASSED[0m[31m [ 89%][0m
tests/unit/test_state/test_lockout_manager.py::TestCooldownTimers::test_cooldown_cleared_cancels_timer [32mPASSED[0m[31m [ 89%][0m
tests/unit/test_state/test_lockout_manager.py::TestCooldownTimers::test_cooldown_integrates_with_timer_manager [32mPASSED[0m[31m [ 89%][0m
tests/unit/test_state/test_lockout_manager.py::TestBackgroundTask::test_check_expired_lockouts_runs_every_second [32mPASSED[0m[31m [ 89%][0m
tests/unit/test_state/test_lockout_manager.py::TestBackgroundTask::test_expired_lockout_auto_cleared [32mPASSED[0m[31m [ 89%][0m
tests/unit/test_state/test_lockout_manager.py::TestBackgroundTask::test_background_task_stops_on_shutdown [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_state/test_lockout_manager.py::TestMultipleAccounts::test_multiple_accounts_locked_independently [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_state/test_lockout_manager.py::TestMultipleAccounts::test_lockout_affects_only_target_account [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_state/test_lockout_manager.py::TestMultipleAccounts::test_clear_lockout_affects_only_target_account [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_state/test_lockout_manager.py::TestDatabasePersistence::test_lockout_saved_to_database [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_state/test_lockout_manager.py::TestDatabasePersistence::test_lockout_deleted_from_database_on_clear [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_state/test_lockout_manager.py::TestDatabasePersistence::test_load_lockouts_populates_memory_state [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_state/test_lockout_manager.py::TestDatabasePersistence::test_expired_lockout_removed_from_database [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_state/test_lockout_manager.py::TestDatabasePersistence::test_database_schema_correct [32mPASSED[0m[31m [ 91%][0m
tests/unit/test_state/test_lockout_manager.py::TestEdgeCases::test_lockout_until_past_time_immediately_expired [32mPASSED[0m[31m [ 91%][0m
tests/unit/test_state/test_lockout_manager.py::TestEdgeCases::test_lockout_reason_persisted_correctly [32mPASSED[0m[31m [ 91%][0m
tests/unit/test_state/test_lockout_manager.py::TestEdgeCases::test_double_lockout_overwrites_previous [32mPASSED[0m[31m [ 91%][0m
tests/unit/test_state/test_lockout_manager.py::TestEventRouterIntegration::test_locked_account_blocks_rule_processing [32mPASSED[0m[31m [ 91%][0m
tests/unit/test_state/test_lockout_manager.py::TestEventRouterIntegration::test_unlocked_account_allows_rule_processing [32mPASSED[0m[31m [ 91%][0m
tests/unit/test_state/test_lockout_manager.py::TestLockoutTypes::test_hard_lockout_type_stored_correctly [32mPASSED[0m[31m [ 91%][0m
tests/unit/test_state/test_lockout_manager.py::TestLockoutTypes::test_cooldown_type_stored_correctly [32mPASSED[0m[31m [ 92%][0m
tests/unit/test_state/test_lockout_manager.py::TestStartupShutdown::test_lockouts_restored_on_startup [32mPASSED[0m[31m [ 92%][0m
tests/unit/test_state/test_lockout_manager.py::TestStartupShutdown::test_shutdown_cancels_all_timers [32mPASSED[0m[31m [ 92%][0m
tests/unit/test_state/test_pnl_tracker.py::TestPnLTrackerBasics::test_tracker_initializes [32mPASSED[0m[31m [ 92%][0m
tests/unit/test_state/test_pnl_tracker.py::TestPnLTrackerBasics::test_get_daily_pnl_returns_zero_for_new_account [32mPASSED[0m[31m [ 92%][0m
tests/unit/test_state/test_pnl_tracker.py::TestPnLTrackerBasics::test_add_trade_pnl_updates_daily_total [32mPASSED[0m[31m [ 92%][0m
tests/unit/test_state/test_pnl_tracker.py::TestPnLTrackerPersistence::test_pnl_survives_restart [32mPASSED[0m[31m [ 92%][0m
tests/unit/test_state/test_pnl_tracker.py::TestPnLTrackerPersistence::test_multiple_accounts_tracked_independently [32mPASSED[0m[31m [ 92%][0m
tests/unit/test_state/test_pnl_tracker.py::TestPnLTrackerReset::test_reset_clears_daily_pnl [32mPASSED[0m[31m [ 93%][0m
tests/unit/test_state/test_pnl_tracker.py::TestPnLTrackerReset::test_different_dates_tracked_separately [32mPASSED[0m[31m [ 93%][0m
tests/unit/test_state/test_pnl_tracker.py::TestPnLTrackerTradeCount::test_trade_count_increments [32mPASSED[0m[31m [ 93%][0m
tests/unit/test_state/test_pnl_tracker.py::TestPnLTrackerTradeCount::test_trade_count_resets_with_pnl [32mPASSED[0m[31m [ 93%][0m
tests/unit/test_state/test_pnl_tracker.py::TestPnLTrackerEdgeCases::test_handles_zero_pnl_trades [32mPASSED[0m[31m [ 93%][0m
tests/unit/test_state/test_pnl_tracker.py::TestPnLTrackerEdgeCases::test_handles_large_pnl_values [32mPASSED[0m[31m [ 93%][0m
tests/unit/test_state/test_pnl_tracker.py::TestPnLTrackerEdgeCases::test_get_all_account_pnls [32mPASSED[0m[31m [ 93%][0m
tests/unit/test_state/test_reset_scheduler.py::TestDailyResetScheduling::test_schedule_daily_reset_creates_schedule [32mPASSED[0m[31m [ 94%][0m
tests/unit/test_state/test_reset_scheduler.py::TestDailyResetScheduling::test_daily_reset_converts_et_to_utc [32mPASSED[0m[31m [ 94%][0m
tests/unit/test_state/test_reset_scheduler.py::TestDailyResetScheduling::test_daily_reset_persists_to_database [32mPASSED[0m[31m [ 94%][0m
tests/unit/test_state/test_reset_scheduler.py::TestDailyResetScheduling::test_daily_reset_clears_pnl_tracker [32mPASSED[0m[31m [ 94%][0m
tests/unit/test_state/test_reset_scheduler.py::TestDailyResetScheduling::test_daily_reset_clears_lockout [32mPASSED[0m[31m [ 94%][0m
tests/unit/test_state/test_reset_scheduler.py::TestDailyResetScheduling::test_daily_reset_does_not_trigger_twice_same_day [32mPASSED[0m[31m [ 94%][0m
tests/unit/test_state/test_reset_scheduler.py::TestWeeklyResetScheduling::test_schedule_weekly_reset_creates_schedule [32mPASSED[0m[31m [ 94%][0m
tests/unit/test_state/test_reset_scheduler.py::TestWeeklyResetScheduling::test_weekly_reset_triggers_on_monday [32mPASSED[0m[31m [ 95%][0m
tests/unit/test_state/test_reset_scheduler.py::TestWeeklyResetScheduling::test_weekly_reset_clears_weekly_pnl [32mPASSED[0m[31m [ 95%][0m
tests/unit/test_state/test_reset_scheduler.py::TestTimezoneHandling::test_et_to_utc_conversion_standard_time [32mPASSED[0m[31m [ 95%][0m
tests/unit/test_state/test_reset_scheduler.py::TestTimezoneHandling::test_et_to_utc_conversion_daylight_time [32mPASSED[0m[31m [ 95%][0m
tests/unit/test_state/test_reset_scheduler.py::TestTimezoneHandling::test_dst_transition_handling [32mPASSED[0m[31m [ 95%][0m
tests/unit/test_state/test_reset_scheduler.py::TestDatabasePersistence::test_reset_log_saved_to_database [32mPASSED[0m[31m [ 95%][0m
tests/unit/test_state/test_reset_scheduler.py::TestDatabasePersistence::test_last_reset_time_loaded_from_database [32mPASSED[0m[31m [ 95%][0m
tests/unit/test_state/test_reset_scheduler.py::TestBackgroundTask::test_background_task_checks_every_minute [32mPASSED[0m[31m [ 95%][0m
tests/unit/test_state/test_reset_scheduler.py::TestBackgroundTask::test_reset_triggered_automatically_at_time [32mPASSED[0m[31m [ 96%][0m
tests/unit/test_state/test_reset_scheduler.py::TestBackgroundTask::test_shutdown_stops_background_task [32mPASSED[0m[31m [ 96%][0m
tests/unit/test_state/test_reset_scheduler.py::TestEdgeCases::test_multiple_accounts_independent_schedules [32mPASSED[0m[31m [ 96%][0m
tests/unit/test_state/test_reset_scheduler.py::TestEdgeCases::test_reset_time_calculation_near_midnight [32mPASSED[0m[31m [ 96%][0m
tests/unit/test_state/test_reset_scheduler.py::TestEdgeCases::test_unscheduled_account_returns_none [32mPASSED[0m[31m [ 96%][0m
tests/unit/test_state/test_reset_scheduler.py::TestDatabaseSchema::test_reset_log_table_created [32mPASSED[0m[31m [ 96%][0m
tests/unit/test_state/test_reset_scheduler.py::TestIntegration::test_reset_sequence_executes_in_order [32mPASSED[0m[31m [ 96%][0m
tests/unit/test_state/test_reset_scheduler.py::TestIntegration::test_full_lifecycle_start_to_stop [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_state/test_timer_manager.py::test_start_timer_creates_timer [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_state/test_timer_manager.py::test_get_remaining_time_decreases [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_state/test_timer_manager.py::test_cancel_timer_removes_timer [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_state/test_timer_manager.py::test_expired_timer_executes_callback [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_state/test_timer_manager.py::test_expired_timer_auto_removed [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_state/test_timer_manager.py::test_multiple_timers_run_simultaneously [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_state/test_timer_manager.py::test_timers_expire_independently [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_state/test_timer_manager.py::test_cancel_specific_timer_preserves_others [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_state/test_timer_manager.py::test_callback_receives_correct_context [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_state/test_timer_manager.py::test_callback_exception_doesnt_crash_manager [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_state/test_timer_manager.py::test_callback_executes_exactly_once [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_state/test_timer_manager.py::test_async_callback_supported [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_state/test_timer_manager.py::test_zero_duration_timer_executes_immediately [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_state/test_timer_manager.py::test_negative_duration_raises_error [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_state/test_timer_manager.py::test_timer_precision_within_tolerance [32mPASSED[0m[31m [ 99%][0m
tests/unit/test_state/test_timer_manager.py::test_check_timers_runs_every_second [32mPASSED[0m[31m [ 99%][0m
tests/unit/test_state/test_timer_manager.py::test_check_timers_stops_on_shutdown [32mPASSED[0m[31m [ 99%][0m
tests/unit/test_state/test_timer_manager.py::test_get_remaining_time_nonexistent_timer_returns_zero [32mPASSED[0m[31m [ 99%][0m
tests/unit/test_state/test_timer_manager.py::test_cancel_nonexistent_timer_no_error [32mPASSED[0m[31m [ 99%][0m
tests/unit/test_state/test_timer_manager.py::test_duplicate_timer_name_overwrites_previous [32mPASSED[0m[31m [ 99%][0m
tests/unit/test_state/test_timer_manager.py::test_has_timer_returns_false_for_nonexistent [32mPASSED[0m[31m [ 99%][0m
tests/unit/test_state/test_timer_manager.py::test_start_timer_without_callback_raises_error [32mPASSED[0m[31m [100%][0m<unknown>:125: SyntaxWarning: invalid escape sequence '\d'
/mnt/c/Users/jakers/Desktop/risk-manager-v34/src/risk_manager/config/validator.py:125: SyntaxWarning: invalid escape sequence '\d'
  Validate duration format: \d+[smh] or special values.


==================================== ERRORS ====================================
[31m[1m_ ERROR at setup of TestMaxContractsPerInstrumentIntegration.test_short_positions_absolute_value _[0m
file /mnt/c/Users/jakers/Desktop/risk-manager-v34/tests/integration/test_max_contracts_per_instrument_integration.py, line 241
      @pytest.mark.asyncio
      @pytest.mark.integration
      async def test_short_positions_absolute_value(self, engine):
          """
          Test short positions counted as absolute value.

          Given: ES limit = 3
          When: ES short -4 contracts
          Then: Violation (abs(-4) = 4 > 3)
          """
          # Given: Short position exceeding limit
          engine.current_positions = {
              "ES": {"symbol": "ES", "size": -4, "avgPrice": 5000.0, "contractId": "CON.F.US.ES.H25"}
          }

          event = RiskEvent(
              event_type=EventType.POSITION_UPDATED,
              data={
                  "symbol": "ES",
                  "size": -4,
                  "avgPrice": 5000.0,
                  "contractId": "CON.F.US.ES.H25"
              }
          )

          # When: Rule evaluates
          violations = await engine.evaluate_rules(event)

          # Then: Violation detected
          assert len(violations) == 1
          violation = violations[0]
          assert violation["symbol"] == "ES"
          assert violation["position_size"] == 4  # Absolute value
[31mE       fixture 'engine' not found[0m
[31m>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, class_mocker, cov, doctest_namespace, event_bus, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, losing_trade, mock_engine, mock_suite, mock_suite_manager, mocker, module_mocker, monkeypatch, no_cover, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, risk_manager, rule, sample_order_event, sample_position, sample_position_event, sample_trade_event, session_mocker, setup_loguru_caplog, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, winning_trade[0m
[31m>       use 'pytest --fixtures [testpath]' for help on them.[0m

/mnt/c/Users/jakers/Desktop/risk-manager-v34/tests/integration/test_max_contracts_per_instrument_integration.py:241
[31m[1m_ ERROR at setup of TestMaxContractsPerInstrumentIntegration.test_exactly_at_limit_no_violation _[0m
file /mnt/c/Users/jakers/Desktop/risk-manager-v34/tests/integration/test_max_contracts_per_instrument_integration.py, line 279
      @pytest.mark.asyncio
      @pytest.mark.integration
      async def test_exactly_at_limit_no_violation(self, engine):
          """
          Test position exactly at limit does not violate.

          Given: ES limit = 3
          When: ES position = 3 contracts
          Then: No violation (rule uses > not >=)
          """
          # Given: Position exactly at limit
          engine.current_positions = {
              "ES": {"symbol": "ES", "size": 3, "avgPrice": 5000.0}
          }

          event = RiskEvent(
              event_type=EventType.POSITION_UPDATED,
              data={
                  "symbol": "ES",
                  "size": 3,
                  "avgPrice": 5000.0,
                  "contractId": "CON.F.US.ES.H25"
              }
          )

          # When: Rule evaluates
          violations = await engine.evaluate_rules(event)

          # Then: No violation
          assert len(violations) == 0
[31mE       fixture 'engine' not found[0m
[31m>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, class_mocker, cov, doctest_namespace, event_bus, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, losing_trade, mock_engine, mock_suite, mock_suite_manager, mocker, module_mocker, monkeypatch, no_cover, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, risk_manager, rule, sample_order_event, sample_position, sample_position_event, sample_trade_event, session_mocker, setup_loguru_caplog, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, winning_trade[0m
[31m>       use 'pytest --fixtures [testpath]' for help on them.[0m

/mnt/c/Users/jakers/Desktop/risk-manager-v34/tests/integration/test_max_contracts_per_instrument_integration.py:279
[31m[1m_ ERROR at setup of TestMaxContractsPerInstrumentIntegration.test_event_bus_integration _[0m
file /mnt/c/Users/jakers/Desktop/risk-manager-v34/tests/integration/test_max_contracts_per_instrument_integration.py, line 314
      @pytest.mark.asyncio
      @pytest.mark.integration
      async def test_event_bus_integration(self, engine, event_bus):
          """
          Test complete event flow through EventBus.

          Flow:
          1. Publish POSITION_UPDATED event
          2. Engine evaluates rule
          3. RULE_VIOLATED event published if exceeded
          """
          # Track violations
          violations_published = []

          async def violation_handler(event):
              if event.event_type == EventType.RULE_VIOLATED:
                  violations_published.append(event)

          event_bus.subscribe(EventType.RULE_VIOLATED, violation_handler)

          # Given: Position exceeds limit
          engine.current_positions = {
              "MNQ": {"symbol": "MNQ", "size": 4, "avgPrice": 21000.0, "contractId": "CON.F.US.MNQ.H25"}
          }

          event = RiskEvent(
              event_type=EventType.POSITION_UPDATED,
              data={
                  "symbol": "MNQ",
                  "size": 4,
                  "avgPrice": 21000.0,
                  "contractId": "CON.F.US.MNQ.H25"
              }
          )

          # When: Evaluate rules
          await engine.evaluate_rules(event)

          # Wait for event propagation
          await asyncio.sleep(0.1)

          # Then: Violation published
          assert len(violations_published) == 1
          assert violations_published[0].data["rule"] == "MaxContractsPerInstrumentRule"
[31mE       fixture 'engine' not found[0m
[31m>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, class_mocker, cov, doctest_namespace, event_bus, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, losing_trade, mock_engine, mock_suite, mock_suite_manager, mocker, module_mocker, monkeypatch, no_cover, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, risk_manager, rule, sample_order_event, sample_position, sample_position_event, sample_trade_event, session_mocker, setup_loguru_caplog, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, winning_trade[0m
[31m>       use 'pytest --fixtures [testpath]' for help on them.[0m

/mnt/c/Users/jakers/Desktop/risk-manager-v34/tests/integration/test_max_contracts_per_instrument_integration.py:314
[31m[1m_ ERROR at setup of TestMaxContractsPerInstrumentIntegration.test_no_lockout_on_violation _[0m
file /mnt/c/Users/jakers/Desktop/risk-manager-v34/tests/integration/test_max_contracts_per_instrument_integration.py, line 363
      @pytest.mark.asyncio
      @pytest.mark.integration
      async def test_no_lockout_on_violation(self, engine):
          """
          Test violation does NOT create lockout.

          Trade-by-trade rule: Close excess for that symbol only.
          Trader can continue trading other symbols.
          """
          # Given: ES exceeds limit
          engine.current_positions = {
              "ES": {"symbol": "ES", "size": 5, "avgPrice": 5000.0, "contractId": "CON.F.US.ES.H25"},
              "MNQ": {"symbol": "MNQ", "size": 1, "avgPrice": 21000.0}
          }

          event = RiskEvent(
              event_type=EventType.POSITION_UPDATED,
              data={
                  "symbol": "ES",
                  "size": 5,
                  "avgPrice": 5000.0,
                  "contractId": "CON.F.US.ES.H25"
              }
          )

          # When: Rule evaluates
          violations = await engine.evaluate_rules(event)

          # Then: Violation for ES only, no account lockout
          assert len(violations) == 1
          violation = violations[0]
          assert "lockout" not in violation or violation.get("lockout") is False
[31mE       fixture 'engine' not found[0m
[31m>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, class_mocker, cov, doctest_namespace, event_bus, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, losing_trade, mock_engine, mock_suite, mock_suite_manager, mocker, module_mocker, monkeypatch, no_cover, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, risk_manager, rule, sample_order_event, sample_position, sample_position_event, sample_trade_event, session_mocker, setup_loguru_caplog, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, winning_trade[0m
[31m>       use 'pytest --fixtures [testpath]' for help on them.[0m

/mnt/c/Users/jakers/Desktop/risk-manager-v34/tests/integration/test_max_contracts_per_instrument_integration.py:363
[31m[1m_ ERROR at setup of TestMaxContractsPerInstrumentIntegration.test_dynamic_limit_configuration _[0m
file /mnt/c/Users/jakers/Desktop/risk-manager-v34/tests/integration/test_max_contracts_per_instrument_integration.py, line 400
      @pytest.mark.asyncio
      @pytest.mark.integration
      async def test_dynamic_limit_configuration(self, engine, event_bus, mock_trading_integration):
          """
          Test rule can be reconfigured with different limits.

          Verifies limits can be updated without recreating engine.
          """
          # Given: Initial configuration tested
          # (ES=3 from fixture)

          # When: Update rule with new limits
          new_rule = MaxContractsPerInstrumentRule(
              config={
                  "limits": {
                      "ES": 2,  # Reduced from 3
                      "MNQ": 1   # Reduced from 2
                  }
              }
          )

          # Replace rule
          engine.rules = [new_rule]

          # And: Position that was OK with old limit
          engine.current_positions = {
              "ES": {"symbol": "ES", "size": 3, "avgPrice": 5000.0, "contractId": "CON.F.US.ES.H25"}
          }

          event = RiskEvent(
              event_type=EventType.POSITION_UPDATED,
              data={
                  "symbol": "ES",
                  "size": 3,
                  "avgPrice": 5000.0,
                  "contractId": "CON.F.US.ES.H25"
              }
          )

          # Then: Now violates with new limit
          violations = await engine.evaluate_rules(event)
          assert len(violations) == 1
          violation = violations[0]
          assert violation["limit"] == 2  # New limit applied
[31mE       fixture 'engine' not found[0m
[31m>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, class_mocker, cov, doctest_namespace, event_bus, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, losing_trade, mock_engine, mock_suite, mock_suite_manager, mocker, module_mocker, monkeypatch, no_cover, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, risk_manager, rule, sample_order_event, sample_position, sample_position_event, sample_trade_event, session_mocker, setup_loguru_caplog, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, winning_trade[0m
[31m>       use 'pytest --fixtures [testpath]' for help on them.[0m

/mnt/c/Users/jakers/Desktop/risk-manager-v34/tests/integration/test_max_contracts_per_instrument_integration.py:400
[31m[1m_ ERROR at setup of TestMaxPositionIntegration.test_single_symbol_within_limit _[0m
[1m[31mtests/integration/test_max_position_integration.py[0m:36: in mock_engine
    [0mmock_engine.current_positions ={}[90m[39;49;00m
    ^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   NameError: name 'mock_engine' is not defined[0m
[31m[1m_ ERROR at setup of TestMaxPositionIntegration.test_single_symbol_exceeds_limit _[0m
[1m[31mtests/integration/test_max_position_integration.py[0m:36: in mock_engine
    [0mmock_engine.current_positions ={}[90m[39;49;00m
    ^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   NameError: name 'mock_engine' is not defined[0m
[31m[1m_ ERROR at setup of TestMaxPositionIntegration.test_multi_symbol_total_within_limit _[0m
[1m[31mtests/integration/test_max_position_integration.py[0m:36: in mock_engine
    [0mmock_engine.current_positions ={}[90m[39;49;00m
    ^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   NameError: name 'mock_engine' is not defined[0m
[31m[1m_ ERROR at setup of TestMaxPositionIntegration.test_multi_symbol_total_exceeds_limit _[0m
[1m[31mtests/integration/test_max_position_integration.py[0m:36: in mock_engine
    [0mmock_engine.current_positions ={}[90m[39;49;00m
    ^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   NameError: name 'mock_engine' is not defined[0m
[31m[1m_ ERROR at setup of TestMaxPositionIntegration.test_short_positions_absolute_value _[0m
[1m[31mtests/integration/test_max_position_integration.py[0m:36: in mock_engine
    [0mmock_engine.current_positions ={}[90m[39;49;00m
    ^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   NameError: name 'mock_engine' is not defined[0m
[31m[1m___ ERROR at setup of TestMaxPositionIntegration.test_event_bus_integration ____[0m
[1m[31mtests/integration/test_max_position_integration.py[0m:36: in mock_engine
    [0mmock_engine.current_positions ={}[90m[39;49;00m
    ^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   NameError: name 'mock_engine' is not defined[0m
[31m[1m__ ERROR at setup of TestMaxPositionIntegration.test_no_lockout_on_violation ___[0m
file /mnt/c/Users/jakers/Desktop/risk-manager-v34/tests/integration/test_max_position_integration.py, line 279
      @pytest.mark.asyncio
      @pytest.mark.integration
      async def test_no_lockout_on_violation(self, engine):
          """
          Test that violation does NOT create lockout.

          This is a trade-by-trade rule - close excess position only.
          Trader can continue trading within limits.
          """
          # Given: Position exceeds limit
          mock_engine.current_positions ={
              "ES": {"symbol": "ES", "size": 7, "avgPrice": 5000.0, "contractId": "CON.F.US.ES.H25"}
          }

          event = RiskEvent(
              event_type=EventType.POSITION_UPDATED,
              data={
                  "symbol": "ES",
                  "size": 7,
                  "avgPrice": 5000.0,
                  "contractId": "CON.F.US.ES.H25"
              }
          )

          # When: Rule evaluates
          violation = await rule.evaluate(event, mock_engine)

          # Then: Violation exists but action is close_position, not lockout
          assert violation is not None
          assert "lockout" not in violation or violation.get("lockout") is False
[31mE       fixture 'engine' not found[0m
[31m>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, class_mocker, cov, doctest_namespace, event_bus, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, losing_trade, mock_engine, mock_suite, mock_suite_manager, mocker, module_mocker, monkeypatch, no_cover, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, risk_manager, rule, sample_order_event, sample_position, sample_position_event, sample_trade_event, session_mocker, setup_loguru_caplog, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, winning_trade[0m
[31m>       use 'pytest --fixtures [testpath]' for help on them.[0m

/mnt/c/Users/jakers/Desktop/risk-manager-v34/tests/integration/test_max_position_integration.py:279
[31m[1m_ ERROR at setup of TestMaxPositionIntegration.test_zero_position_no_violation _[0m
file /mnt/c/Users/jakers/Desktop/risk-manager-v34/tests/integration/test_max_position_integration.py, line 314
      @pytest.mark.asyncio
      @pytest.mark.integration
      async def test_zero_position_no_violation(self, engine):
          """Test that zero position does not trigger violation."""
          # Given: No positions
          mock_engine.current_positions ={}

          event = RiskEvent(
              event_type=EventType.POSITION_UPDATED,
              data={
                  "symbol": "ES",
                  "size": 0,
                  "avgPrice": 0.0,
                  "contractId": "CON.F.US.ES.H25"
              }
          )

          # When: Rule evaluates
          violation = await rule.evaluate(event, mock_engine)

          # Then: No violation
          assert violation is None
[31mE       fixture 'engine' not found[0m
[31m>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, class_mocker, cov, doctest_namespace, event_bus, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, losing_trade, mock_engine, mock_suite, mock_suite_manager, mocker, module_mocker, monkeypatch, no_cover, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, risk_manager, rule, sample_order_event, sample_position, sample_position_event, sample_trade_event, session_mocker, setup_loguru_caplog, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, winning_trade[0m
[31m>       use 'pytest --fixtures [testpath]' for help on them.[0m

/mnt/c/Users/jakers/Desktop/risk-manager-v34/tests/integration/test_max_position_integration.py:314
[31m[1m_ ERROR at setup of TestMaxPositionIntegration.test_exactly_at_limit_no_violation _[0m
file /mnt/c/Users/jakers/Desktop/risk-manager-v34/tests/integration/test_max_position_integration.py, line 341
      @pytest.mark.asyncio
      @pytest.mark.integration
      async def test_exactly_at_limit_no_violation(self, engine):
          """
          Test position exactly at limit does not violate.

          Given: Max contracts = 5
          When: Total position = 5
          Then: No violation (>= comparison)
          """
          # Given: Position exactly at limit
          mock_engine.current_positions ={
              "ES": {"symbol": "ES", "size": 5, "avgPrice": 5000.0}
          }

          event = RiskEvent(
              event_type=EventType.POSITION_UPDATED,
              data={
                  "symbol": "ES",
                  "size": 5,
                  "avgPrice": 5000.0,
                  "contractId": "CON.F.US.ES.H25"
              }
          )

          # When: Rule evaluates
          violation = await rule.evaluate(event, mock_engine)

          # Then: No violation (rule uses > not >=)
          assert violation is None
[31mE       fixture 'engine' not found[0m
[31m>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, class_mocker, cov, doctest_namespace, event_bus, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, losing_trade, mock_engine, mock_suite, mock_suite_manager, mocker, module_mocker, monkeypatch, no_cover, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, risk_manager, rule, sample_order_event, sample_position, sample_position_event, sample_trade_event, session_mocker, setup_loguru_caplog, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, winning_trade[0m
[31m>       use 'pytest --fixtures [testpath]' for help on them.[0m

/mnt/c/Users/jakers/Desktop/risk-manager-v34/tests/integration/test_max_position_integration.py:341
[31m[1m__ ERROR at setup of TestMaxPositionIntegration.test_performance_many_symbols __[0m
file /mnt/c/Users/jakers/Desktop/risk-manager-v34/tests/integration/test_max_position_integration.py, line 376
      @pytest.mark.asyncio
      @pytest.mark.integration
      async def test_performance_many_symbols(self, engine):
          """
          Test rule performs quickly with many symbols.

          Verifies rule can handle accounts with 10+ symbols.
          """
          import time

          # Given: Many symbols
          mock_engine.current_positions ={
              f"SYM{i}": {"symbol": f"SYM{i}", "size": 1, "avgPrice": 100.0}
              for i in range(20)
          }

          event = RiskEvent(
              event_type=EventType.POSITION_UPDATED,
              data={
                  "symbol": "SYM0",
                  "size": 1,
                  "avgPrice": 100.0,
                  "contractId": "CON.F.US.SYM0.H25"
              }
          )

          # When: Rule evaluates
          start = time.time()
          violation = await rule.evaluate(event, mock_engine)
          duration = time.time() - start

          # Then: Completes quickly (< 100ms)
          assert duration < 0.1

          # And: Violation detected (20 > 5)
          assert len(violations) == 1
[31mE       fixture 'engine' not found[0m
[31m>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, class_mocker, cov, doctest_namespace, event_bus, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, losing_trade, mock_engine, mock_suite, mock_suite_manager, mocker, module_mocker, monkeypatch, no_cover, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, risk_manager, rule, sample_order_event, sample_position, sample_position_event, sample_trade_event, session_mocker, setup_loguru_caplog, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, winning_trade[0m
[31m>       use 'pytest --fixtures [testpath]' for help on them.[0m

/mnt/c/Users/jakers/Desktop/risk-manager-v34/tests/integration/test_max_position_integration.py:376
=================================== FAILURES ===================================
[31m[1m___ TestCooldownAfterLossIntegration.test_database_cleanup_on_lockout_clear ____[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\integration\test_cooldown_after_loss_integration.py[0m:701: in test_database_cleanup_on_lockout_clear
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   assert 1 == 0[0m
[1m[31mE    +  where 1 = len([<sqlite3.Row object at 0x79bc62390100>])[0m
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 TimerManager initialized

[32mINFO    [0m root:conftest.py:37 Background task started

[32mINFO    [0m root:conftest.py:37 TimerManager started

[32mINFO    [0m root:conftest.py:37 Timer loop started

[32mINFO    [0m root:conftest.py:37 Applying schema migration: v1 (initial schema)

[32mINFO    [0m root:conftest.py:37 Schema v1 applied successfully

[32mINFO    [0m root:conftest.py:37 Database initialized at /tmp/pytest-of-jakers/pytest-0/test_database_cleanup_on_locko0/test_cooldown_integration.db

[32mINFO    [0m root:conftest.py:37 PnLTracker initialized

[32mINFO    [0m root:conftest.py:37 Loaded 0 lockouts from database

[32mINFO    [0m root:conftest.py:37 Lockout Manager initialized

[32mINFO    [0m root:conftest.py:37 Starting Lockout Manager

[32mINFO    [0m root:conftest.py:37 Loaded 0 lockouts from database

[32mINFO    [0m root:conftest.py:37 Lockout Manager started

[32mINFO    [0m root:conftest.py:37 Lockout expiry background task started

[32mINFO    [0m root:conftest.py:37 CooldownAfterLossRule initialized: 1 tiers
------------------------------ Captured log call -------------------------------
[32mINFO    [0m root:conftest.py:37 Cooldown triggered for account 1010: Loss=$-150.00, Cooldown=2s

[32mINFO    [0m root:conftest.py:37 ENFORCING RULE-007: Account 1010 Loss: $-150.00, Cooldown: 2s

[32mINFO    [0m root:conftest.py:37 Timer started: lockout_1010 (duration=2s, expires=22:34:48)

[32mINFO    [0m root:conftest.py:37 Timer started for account 1010 cooldown

[32mINFO    [0m root:conftest.py:37 Account 1010 cooldown for 2s: Cooldown triggered after $-150.00 loss (2s cooldown)

[32mINFO    [0m root:conftest.py:37 Account 1010 locked for 2s: Cooldown triggered after $-150.00 loss (2s cooldown)
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Shutting down Lockout Manager

[32mINFO    [0m root:conftest.py:37 Timer cancelled: lockout_1010

[32mINFO    [0m root:conftest.py:37 Error cancelling timer for account 1010: object NoneType can't be used in 'await' expression

[32mINFO    [0m root:conftest.py:37 Stopping Lockout Manager

[32mINFO    [0m root:conftest.py:37 Lockout Manager stopped

[32mINFO    [0m root:conftest.py:37 Lockout Manager shutdown complete

[32mINFO    [0m root:conftest.py:37 Database closed

[32mINFO    [0m root:conftest.py:37 Timer loop cancelled

[32mINFO    [0m root:conftest.py:37 Timer loop stopped

[32mINFO    [0m root:conftest.py:37 TimerManager stopped
[31m[1m___ TestDailyRealizedLossIntegration.test_full_loss_limit_flow_with_database ___[0m
[1m[31mtests/integration/test_daily_realized_loss_integration.py[0m:135: in test_full_loss_limit_flow_with_database
    [0m[94massert[39;49;00m pnl == -[94m300.0[39;49;00m[90m[39;49;00m
[1m[31mE   assert 0.0 == -300.0[0m
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 Applying schema migration: v1 (initial schema)

[32mINFO    [0m root:conftest.py:37 Schema v1 applied successfully

[32mINFO    [0m root:conftest.py:37 Database initialized at /tmp/pytest-of-jakers/pytest-0/test_full_loss_limit_flow_with0/test_daily_loss_integration.db

[32mINFO    [0m root:conftest.py:37 PnLTracker initialized

[32mINFO    [0m root:conftest.py:37 Loaded 0 lockouts from database

[32mINFO    [0m root:conftest.py:37 Lockout Manager initialized

[32mINFO    [0m root:conftest.py:37 Starting Lockout Manager

[32mINFO    [0m root:conftest.py:37 Loaded 0 lockouts from database

[32mINFO    [0m root:conftest.py:37 Lockout Manager started

[32mINFO    [0m root:conftest.py:37 Lockout expiry background task started

[32mINFO    [0m root:conftest.py:37 Reset scheduler ready to load last reset times from database

[32mINFO    [0m root:conftest.py:37 Reset Scheduler initialized

[32mINFO    [0m root:conftest.py:37 Starting Reset Scheduler

[32mINFO    [0m root:conftest.py:37 Reset Scheduler started

[32mINFO    [0m root:conftest.py:37 Reset loop started

[32mINFO    [0m root:conftest.py:37 DailyRealizedLossRule initialized: limit=$-1000.00, reset=17:00 America/New_York
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Stopping Reset Scheduler

[32mINFO    [0m root:conftest.py:37 Reset loop cancelled

[32mINFO    [0m root:conftest.py:37 Reset loop stopped

[32mINFO    [0m root:conftest.py:37 Reset Scheduler stopped

[32mINFO    [0m root:conftest.py:37 Shutting down Lockout Manager

[32mINFO    [0m root:conftest.py:37 Stopping Lockout Manager

[32mINFO    [0m root:conftest.py:37 Lockout Manager stopped

[32mINFO    [0m root:conftest.py:37 Lockout Manager shutdown complete

[32mINFO    [0m root:conftest.py:37 Database closed
[31m[1m_______ TestDailyRealizedLossIntegration.test_multi_account_independence _______[0m
[1m[31mtests/integration/test_daily_realized_loss_integration.py[0m:195: in test_multi_account_independence
    [0m[94massert[39;49;00m violation_a [95mis[39;49;00m [95mnot[39;49;00m [94mNone[39;49;00m[90m[39;49;00m
[1m[31mE   assert None is not None[0m
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 Applying schema migration: v1 (initial schema)

[32mINFO    [0m root:conftest.py:37 Schema v1 applied successfully

[32mINFO    [0m root:conftest.py:37 Database initialized at /tmp/pytest-of-jakers/pytest-0/test_multi_account_independenc0/test_daily_loss_integration.db

[32mINFO    [0m root:conftest.py:37 PnLTracker initialized

[32mINFO    [0m root:conftest.py:37 Loaded 0 lockouts from database

[32mINFO    [0m root:conftest.py:37 Lockout Manager initialized

[32mINFO    [0m root:conftest.py:37 Starting Lockout Manager

[32mINFO    [0m root:conftest.py:37 Loaded 0 lockouts from database

[32mINFO    [0m root:conftest.py:37 Lockout Manager started

[32mINFO    [0m root:conftest.py:37 Lockout expiry background task started

[32mINFO    [0m root:conftest.py:37 Reset scheduler ready to load last reset times from database

[32mINFO    [0m root:conftest.py:37 Reset Scheduler initialized

[32mINFO    [0m root:conftest.py:37 Starting Reset Scheduler

[32mINFO    [0m root:conftest.py:37 Reset Scheduler started

[32mINFO    [0m root:conftest.py:37 Reset loop started

[32mINFO    [0m root:conftest.py:37 DailyRealizedLossRule initialized: limit=$-1000.00, reset=17:00 America/New_York
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Stopping Reset Scheduler

[32mINFO    [0m root:conftest.py:37 Reset loop cancelled

[32mINFO    [0m root:conftest.py:37 Reset loop stopped

[32mINFO    [0m root:conftest.py:37 Reset Scheduler stopped

[32mINFO    [0m root:conftest.py:37 Shutting down Lockout Manager

[32mINFO    [0m root:conftest.py:37 Stopping Lockout Manager

[32mINFO    [0m root:conftest.py:37 Lockout Manager stopped

[32mINFO    [0m root:conftest.py:37 Lockout Manager shutdown complete

[32mINFO    [0m root:conftest.py:37 Database closed
[31m[1m___ TestDailyRealizedLossIntegration.test_lockout_persistence_crash_recovery ___[0m
[1m[31mtests/integration/test_daily_realized_loss_integration.py[0m:243: in test_lockout_persistence_crash_recovery
    [0mrule1 = DailyRealizedLossRule([90m[39;49;00m
[1m[31mE   TypeError: DailyRealizedLossRule.__init__() got an unexpected keyword argument 'config'[0m
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 Applying schema migration: v1 (initial schema)

[32mINFO    [0m root:conftest.py:37 Schema v1 applied successfully

[32mINFO    [0m root:conftest.py:37 Database initialized at /tmp/pytest-of-jakers/pytest-0/test_lockout_persistence_crash0/test_daily_loss_integration.db

[32mINFO    [0m root:conftest.py:37 PnLTracker initialized
------------------------------ Captured log call -------------------------------
[32mINFO    [0m root:conftest.py:37 Database initialized at /tmp/pytest-of-jakers/pytest-0/test_lockout_persistence_crash0/test_daily_loss_integration.db

[32mINFO    [0m root:conftest.py:37 PnLTracker initialized

[32mINFO    [0m root:conftest.py:37 Loaded 0 lockouts from database

[32mINFO    [0m root:conftest.py:37 Lockout Manager initialized

[32mINFO    [0m root:conftest.py:37 Starting Lockout Manager

[32mINFO    [0m root:conftest.py:37 Loaded 0 lockouts from database

[32mINFO    [0m root:conftest.py:37 Lockout Manager started

[32mINFO    [0m root:conftest.py:37 Reset scheduler ready to load last reset times from database

[32mINFO    [0m root:conftest.py:37 Reset Scheduler initialized

[32mINFO    [0m root:conftest.py:37 Starting Reset Scheduler

[32mINFO    [0m root:conftest.py:37 Reset Scheduler started

[32mINFO    [0m root:conftest.py:37 Lockout expiry background task started

[32mINFO    [0m root:conftest.py:37 Reset loop started
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Database closed

[32mINFO    [0m root:conftest.py:37 Reset loop cancelled

[32mINFO    [0m root:conftest.py:37 Reset loop stopped
[31m[1m______ TestDailyRealizedLossIntegration.test_reset_scheduler_integration _______[0m
[1m[31mtests/integration/test_daily_realized_loss_integration.py[0m:306: in test_reset_scheduler_integration
    [0m[94mawait[39;49;00m rule.enforce(account_id, violation, mock_engine)[90m[39;49;00m
[1m[31msrc/risk_manager/rules/daily_realized_loss.py[0m:213: in enforce
    [0mdaily_pnl = violation[[33m"[39;49;00m[33mcurrent_loss[39;49;00m[33m"[39;49;00m][90m[39;49;00m
                ^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: 'NoneType' object is not subscriptable[0m
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 Applying schema migration: v1 (initial schema)

[32mINFO    [0m root:conftest.py:37 Schema v1 applied successfully

[32mINFO    [0m root:conftest.py:37 Database initialized at /tmp/pytest-of-jakers/pytest-0/test_reset_scheduler_integrati0/test_daily_loss_integration.db

[32mINFO    [0m root:conftest.py:37 PnLTracker initialized

[32mINFO    [0m root:conftest.py:37 Loaded 0 lockouts from database

[32mINFO    [0m root:conftest.py:37 Lockout Manager initialized

[32mINFO    [0m root:conftest.py:37 Starting Lockout Manager

[32mINFO    [0m root:conftest.py:37 Loaded 0 lockouts from database

[32mINFO    [0m root:conftest.py:37 Lockout Manager started

[32mINFO    [0m root:conftest.py:37 Lockout expiry background task started

[32mINFO    [0m root:conftest.py:37 Reset scheduler ready to load last reset times from database

[32mINFO    [0m root:conftest.py:37 Reset Scheduler initialized

[32mINFO    [0m root:conftest.py:37 Starting Reset Scheduler

[32mINFO    [0m root:conftest.py:37 Reset Scheduler started

[32mINFO    [0m root:conftest.py:37 Reset loop started

[32mINFO    [0m root:conftest.py:37 DailyRealizedLossRule initialized: limit=$-1000.00, reset=17:00 America/New_York
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Stopping Reset Scheduler

[32mINFO    [0m root:conftest.py:37 Reset loop cancelled

[32mINFO    [0m root:conftest.py:37 Reset loop stopped

[32mINFO    [0m root:conftest.py:37 Reset Scheduler stopped

[32mINFO    [0m root:conftest.py:37 Shutting down Lockout Manager

[32mINFO    [0m root:conftest.py:37 Stopping Lockout Manager

[32mINFO    [0m root:conftest.py:37 Lockout Manager stopped

[32mINFO    [0m root:conftest.py:37 Lockout Manager shutdown complete

[32mINFO    [0m root:conftest.py:37 Database closed
[31m[1m_________ TestDailyRealizedLossIntegration.test_mixed_profit_loss_day __________[0m
[1m[31mtests/integration/test_daily_realized_loss_integration.py[0m:379: in test_mixed_profit_loss_day
    [0m[94massert[39;49;00m pnl_tracker.get_daily_pnl(account_id) == -[94m400.0[39;49;00m[90m[39;49;00m
[1m[31mE   assert 0.0 == -400.0[0m
[1m[31mE    +  where 0.0 = get_daily_pnl(666)[0m
[1m[31mE    +    where get_daily_pnl = <risk_manager.state.pnl_tracker.PnLTracker object at 0x79bc62464320>.get_daily_pnl[0m
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 Applying schema migration: v1 (initial schema)

[32mINFO    [0m root:conftest.py:37 Schema v1 applied successfully

[32mINFO    [0m root:conftest.py:37 Database initialized at /tmp/pytest-of-jakers/pytest-0/test_mixed_profit_loss_day0/test_daily_loss_integration.db

[32mINFO    [0m root:conftest.py:37 PnLTracker initialized

[32mINFO    [0m root:conftest.py:37 Loaded 0 lockouts from database

[32mINFO    [0m root:conftest.py:37 Lockout Manager initialized

[32mINFO    [0m root:conftest.py:37 Starting Lockout Manager

[32mINFO    [0m root:conftest.py:37 Loaded 0 lockouts from database

[32mINFO    [0m root:conftest.py:37 Lockout Manager started

[32mINFO    [0m root:conftest.py:37 Lockout expiry background task started

[32mINFO    [0m root:conftest.py:37 Reset scheduler ready to load last reset times from database

[32mINFO    [0m root:conftest.py:37 Reset Scheduler initialized

[32mINFO    [0m root:conftest.py:37 Starting Reset Scheduler

[32mINFO    [0m root:conftest.py:37 Reset Scheduler started

[32mINFO    [0m root:conftest.py:37 Reset loop started

[32mINFO    [0m root:conftest.py:37 DailyRealizedLossRule initialized: limit=$-1000.00, reset=17:00 America/New_York
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Stopping Reset Scheduler

[32mINFO    [0m root:conftest.py:37 Reset loop cancelled

[32mINFO    [0m root:conftest.py:37 Reset loop stopped

[32mINFO    [0m root:conftest.py:37 Reset Scheduler stopped

[32mINFO    [0m root:conftest.py:37 Shutting down Lockout Manager

[32mINFO    [0m root:conftest.py:37 Stopping Lockout Manager

[32mINFO    [0m root:conftest.py:37 Lockout Manager stopped

[32mINFO    [0m root:conftest.py:37 Lockout Manager shutdown complete

[32mINFO    [0m root:conftest.py:37 Database closed
[31m[1m____ TestDailyRealizedLossIntegration.test_concurrent_access_thread_safety _____[0m
[1m[31mtests/integration/test_daily_realized_loss_integration.py[0m:423: in test_concurrent_access_thread_safety
    [0m[94massert[39;49;00m pnl_tracker.get_daily_pnl(account_id) == -[94m1000.0[39;49;00m[90m[39;49;00m
[1m[31mE   assert 0.0 == -1000.0[0m
[1m[31mE    +  where 0.0 = get_daily_pnl(777)[0m
[1m[31mE    +    where get_daily_pnl = <risk_manager.state.pnl_tracker.PnLTracker object at 0x79bc623c80d0>.get_daily_pnl[0m
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 Applying schema migration: v1 (initial schema)

[32mINFO    [0m root:conftest.py:37 Schema v1 applied successfully

[32mINFO    [0m root:conftest.py:37 Database initialized at /tmp/pytest-of-jakers/pytest-0/test_concurrent_access_thread_0/test_daily_loss_integration.db

[32mINFO    [0m root:conftest.py:37 PnLTracker initialized

[32mINFO    [0m root:conftest.py:37 Loaded 0 lockouts from database

[32mINFO    [0m root:conftest.py:37 Lockout Manager initialized

[32mINFO    [0m root:conftest.py:37 Starting Lockout Manager

[32mINFO    [0m root:conftest.py:37 Loaded 0 lockouts from database

[32mINFO    [0m root:conftest.py:37 Lockout Manager started

[32mINFO    [0m root:conftest.py:37 Lockout expiry background task started

[32mINFO    [0m root:conftest.py:37 Reset scheduler ready to load last reset times from database

[32mINFO    [0m root:conftest.py:37 Reset Scheduler initialized

[32mINFO    [0m root:conftest.py:37 Starting Reset Scheduler

[32mINFO    [0m root:conftest.py:37 Reset Scheduler started

[32mINFO    [0m root:conftest.py:37 Reset loop started

[32mINFO    [0m root:conftest.py:37 DailyRealizedLossRule initialized: limit=$-1000.00, reset=17:00 America/New_York
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Stopping Reset Scheduler

[32mINFO    [0m root:conftest.py:37 Reset loop cancelled

[32mINFO    [0m root:conftest.py:37 Reset loop stopped

[32mINFO    [0m root:conftest.py:37 Reset Scheduler stopped

[32mINFO    [0m root:conftest.py:37 Shutting down Lockout Manager

[32mINFO    [0m root:conftest.py:37 Stopping Lockout Manager

[32mINFO    [0m root:conftest.py:37 Lockout Manager stopped

[32mINFO    [0m root:conftest.py:37 Lockout Manager shutdown complete

[32mINFO    [0m root:conftest.py:37 Database closed
[31m[1m_______ TestDailyRealizedLossIntegration.test_database_schema_validation _______[0m
[1m[31mtests/integration/test_daily_realized_loss_integration.py[0m:445: in test_database_schema_validation
    [0m[94massert[39;49;00m [33m"[39;49;00m[33mpnl[39;49;00m[33m"[39;49;00m [95min[39;49;00m columns[90m[39;49;00m
[1m[31mE   AssertionError: assert 'pnl' in ['id', 'account_id', 'date', 'realized_pnl', 'trade_count', 'created_at', ...][0m
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 Applying schema migration: v1 (initial schema)

[32mINFO    [0m root:conftest.py:37 Schema v1 applied successfully

[32mINFO    [0m root:conftest.py:37 Database initialized at /tmp/pytest-of-jakers/pytest-0/test_database_schema_validatio0/test_daily_loss_integration.db
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Database closed
[31m[1m_______ TestDailyRealizedLossIntegration.test_boundary_exactly_at_limit ________[0m
[1m[31mtests/integration/test_daily_realized_loss_integration.py[0m:479: in test_boundary_exactly_at_limit
    [0m[94massert[39;49;00m violation [95mis[39;49;00m [95mnot[39;49;00m [94mNone[39;49;00m[90m[39;49;00m
[1m[31mE   assert None is not None[0m
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 Applying schema migration: v1 (initial schema)

[32mINFO    [0m root:conftest.py:37 Schema v1 applied successfully

[32mINFO    [0m root:conftest.py:37 Database initialized at /tmp/pytest-of-jakers/pytest-0/test_boundary_exactly_at_limit0/test_daily_loss_integration.db

[32mINFO    [0m root:conftest.py:37 PnLTracker initialized

[32mINFO    [0m root:conftest.py:37 Loaded 0 lockouts from database

[32mINFO    [0m root:conftest.py:37 Lockout Manager initialized

[32mINFO    [0m root:conftest.py:37 Starting Lockout Manager

[32mINFO    [0m root:conftest.py:37 Loaded 0 lockouts from database

[32mINFO    [0m root:conftest.py:37 Lockout Manager started

[32mINFO    [0m root:conftest.py:37 Lockout expiry background task started

[32mINFO    [0m root:conftest.py:37 Reset scheduler ready to load last reset times from database

[32mINFO    [0m root:conftest.py:37 Reset Scheduler initialized

[32mINFO    [0m root:conftest.py:37 Starting Reset Scheduler

[32mINFO    [0m root:conftest.py:37 Reset Scheduler started

[32mINFO    [0m root:conftest.py:37 Reset loop started

[32mINFO    [0m root:conftest.py:37 DailyRealizedLossRule initialized: limit=$-1000.00, reset=17:00 America/New_York
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Stopping Reset Scheduler

[32mINFO    [0m root:conftest.py:37 Reset loop cancelled

[32mINFO    [0m root:conftest.py:37 Reset loop stopped

[32mINFO    [0m root:conftest.py:37 Reset Scheduler stopped

[32mINFO    [0m root:conftest.py:37 Shutting down Lockout Manager

[32mINFO    [0m root:conftest.py:37 Stopping Lockout Manager

[32mINFO    [0m root:conftest.py:37 Lockout Manager stopped

[32mINFO    [0m root:conftest.py:37 Lockout Manager shutdown complete

[32mINFO    [0m root:conftest.py:37 Database closed
[31m[1m___________ TestDailyRealizedLossIntegration.test_timer_auto_unlock ____________[0m
[1m[31mtests/integration/test_daily_realized_loss_integration.py[0m:504: in test_timer_auto_unlock
    [0m[94mawait[39;49;00m rule.enforce(account_id, violation, mock_engine)[90m[39;49;00m
[1m[31msrc/risk_manager/rules/daily_realized_loss.py[0m:213: in enforce
    [0mdaily_pnl = violation[[33m"[39;49;00m[33mcurrent_loss[39;49;00m[33m"[39;49;00m][90m[39;49;00m
                ^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: 'NoneType' object is not subscriptable[0m
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 Applying schema migration: v1 (initial schema)

[32mINFO    [0m root:conftest.py:37 Schema v1 applied successfully

[32mINFO    [0m root:conftest.py:37 Database initialized at /tmp/pytest-of-jakers/pytest-0/test_timer_auto_unlock0/test_daily_loss_integration.db

[32mINFO    [0m root:conftest.py:37 PnLTracker initialized

[32mINFO    [0m root:conftest.py:37 Loaded 0 lockouts from database

[32mINFO    [0m root:conftest.py:37 Lockout Manager initialized

[32mINFO    [0m root:conftest.py:37 Starting Lockout Manager

[32mINFO    [0m root:conftest.py:37 Loaded 0 lockouts from database

[32mINFO    [0m root:conftest.py:37 Lockout Manager started

[32mINFO    [0m root:conftest.py:37 Lockout expiry background task started

[32mINFO    [0m root:conftest.py:37 Reset scheduler ready to load last reset times from database

[32mINFO    [0m root:conftest.py:37 Reset Scheduler initialized

[32mINFO    [0m root:conftest.py:37 Starting Reset Scheduler

[32mINFO    [0m root:conftest.py:37 Reset Scheduler started

[32mINFO    [0m root:conftest.py:37 Reset loop started

[32mINFO    [0m root:conftest.py:37 DailyRealizedLossRule initialized: limit=$-1000.00, reset=17:00 America/New_York
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Stopping Reset Scheduler

[32mINFO    [0m root:conftest.py:37 Reset loop cancelled

[32mINFO    [0m root:conftest.py:37 Reset loop stopped

[32mINFO    [0m root:conftest.py:37 Reset Scheduler stopped

[32mINFO    [0m root:conftest.py:37 Shutting down Lockout Manager

[32mINFO    [0m root:conftest.py:37 Stopping Lockout Manager

[32mINFO    [0m root:conftest.py:37 Lockout Manager stopped

[32mINFO    [0m root:conftest.py:37 Lockout Manager shutdown complete

[32mINFO    [0m root:conftest.py:37 Database closed
[31m[1m___ TestMaxContractsPerInstrumentIntegration.test_single_symbol_within_limit ___[0m
[1m[31mtests/integration/test_max_contracts_per_instrument_integration.py[0m:66: in test_single_symbol_within_limit
    [0mengine.current_positions = {[90m[39;49;00m
    ^^^^^^[90m[39;49;00m
[1m[31mE   NameError: name 'engine' is not defined[0m
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 MaxContractsPerInstrumentRule initialized - Limits: {'ES': 3, 'MNQ': 2, 'NQ': 5}, Enforcement: reduce_to_limit, Unknown: block
[31m[1m__ TestMaxContractsPerInstrumentIntegration.test_single_symbol_exceeds_limit ___[0m
[1m[31mtests/integration/test_max_contracts_per_instrument_integration.py[0m:101: in test_single_symbol_exceeds_limit
    [0mengine.current_positions = {[90m[39;49;00m
    ^^^^^^[90m[39;49;00m
[1m[31mE   NameError: name 'engine' is not defined[0m
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 MaxContractsPerInstrumentRule initialized - Limits: {'ES': 3, 'MNQ': 2, 'NQ': 5}, Enforcement: reduce_to_limit, Unknown: block
[31m[1m_ TestMaxContractsPerInstrumentIntegration.test_multiple_symbols_independent_limits _[0m
[1m[31mtests/integration/test_max_contracts_per_instrument_integration.py[0m:141: in test_multiple_symbols_independent_limits
    [0mengine.current_positions = {[90m[39;49;00m
    ^^^^^^[90m[39;49;00m
[1m[31mE   NameError: name 'engine' is not defined[0m
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 MaxContractsPerInstrumentRule initialized - Limits: {'ES': 3, 'MNQ': 2, 'NQ': 5}, Enforcement: reduce_to_limit, Unknown: block
[31m[1m_ TestMaxContractsPerInstrumentIntegration.test_one_symbol_violates_others_ok __[0m
[1m[31mtests/integration/test_max_contracts_per_instrument_integration.py[0m:177: in test_one_symbol_violates_others_ok
    [0mengine.current_positions = {[90m[39;49;00m
    ^^^^^^[90m[39;49;00m
[1m[31mE   NameError: name 'engine' is not defined[0m
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 MaxContractsPerInstrumentRule initialized - Limits: {'ES': 3, 'MNQ': 2, 'NQ': 5}, Enforcement: reduce_to_limit, Unknown: block
[31m[1m_ TestMaxContractsPerInstrumentIntegration.test_symbol_without_configured_limit _[0m
[1m[31mtests/integration/test_max_contracts_per_instrument_integration.py[0m:217: in test_symbol_without_configured_limit
    [0mengine.current_positions = {[90m[39;49;00m
    ^^^^^^[90m[39;49;00m
[1m[31mE   NameError: name 'engine' is not defined[0m
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 MaxContractsPerInstrumentRule initialized - Limits: {'ES': 3, 'MNQ': 2, 'NQ': 5}, Enforcement: reduce_to_limit, Unknown: block
[31m[1m___ TestMaxUnrealizedProfitIntegration.test_es_long_position_reaches_target ____[0m
[1m[31mtests/integration/test_max_unrealized_profit_integration.py[0m:113: in test_es_long_position_reaches_target
    [0m[94massert[39;49;00m [96mlen[39;49;00m(violations1) == [94m0[39;49;00m  [90m# Under target[39;49;00m[90m[39;49;00m
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AssertionError: assert 1 == 0[0m
[1m[31mE    +  where 1 = len([{'action': 'close_position', 'contractId': 'CON.F.US.ES.H25', 'message': 'Profit target hit for ES: $6400.00 >= $2000.00 (take profit)', 'rule': 'MaxUnrealizedProfitRule', ...}])[0m
---------------------------- Captured stdout setup -----------------------------
2025-10-28T03:35:03.822551Z | INFO     | engine.start:40 | ✅ Event loop running: 1 active rules monitoring events
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 Risk Engine initialized

[32mINFO    [0m root:conftest.py:37 Added rule: MaxUnrealizedProfitRule

[32mINFO    [0m root:conftest.py:37 Risk Engine started
----------------------------- Captured stdout call -----------------------------
2025-10-28T03:35:03.824458Z | INFO     | engine.evaluate_rules:74 | 📨 Event received: position_updated - evaluating 1 rules
2025-10-28T03:35:03.824646Z | INFO     | engine.evaluate_rules:82 | 🔍 Rule evaluated: MaxUnrealizedProfitRule - VIOLATED
2025-10-28T03:35:03.824934Z | WARNING  | engine._handle_violation:115 | ⚠️ Enforcement triggered: CLOSE POSITION - Rule: MaxUnrealizedProfitRule
------------------------------ Captured log call -------------------------------
[32mINFO    [0m root:conftest.py:37 Rule violation: MaxUnrealizedProfitRule - {'rule': 'MaxUnrealizedProfitRule', 'message': 'Profit target hit for ES: $6400.00 >= $2000.00 (take profit)', 'symbol': 'ES', 'contractId': 'CON.F.US.ES.H25', 'unrealized_pnl': 6400.0, 'target': 2000.0, 'action': 'close_position', 'timestamp': '2025-10-28T03:35:03.824586+00:00'}

[32mINFO    [0m root:conftest.py:37 CLOSING POSITION: ES (CON.F.US.ES.H25)

[32mINFO    [0m root:conftest.py:37 ✅ Position closed: ES (CON.F.US.ES.H25)
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Risk Engine stopped
[31m[1m__ TestMaxUnrealizedProfitIntegration.test_mnq_short_position_reaches_target ___[0m
[1m[31mtests/integration/test_max_unrealized_profit_integration.py[0m:163: in test_mnq_short_position_reaches_target
    [0mevent_type=EventType.QUOTE_UPDATED,[90m[39;49;00m
               ^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: type object 'EventType' has no attribute 'QUOTE_UPDATED'[0m
---------------------------- Captured stdout setup -----------------------------
2025-10-28T03:35:03.909886Z | INFO     | engine.start:40 | ✅ Event loop running: 1 active rules monitoring events
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 Risk Engine initialized

[32mINFO    [0m root:conftest.py:37 Added rule: MaxUnrealizedProfitRule

[32mINFO    [0m root:conftest.py:37 Risk Engine started
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Risk Engine stopped
[31m[1m_____ TestMaxUnrealizedProfitIntegration.test_multi_position_independence ______[0m
[1m[31mtests/integration/test_max_unrealized_profit_integration.py[0m:215: in test_multi_position_independence
    [0mevent_type=EventType.QUOTE_UPDATED,[90m[39;49;00m
               ^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: type object 'EventType' has no attribute 'QUOTE_UPDATED'[0m
---------------------------- Captured stdout setup -----------------------------
2025-10-28T03:35:03.994410Z | INFO     | engine.start:40 | ✅ Event loop running: 1 active rules monitoring events
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 Risk Engine initialized

[32mINFO    [0m root:conftest.py:37 Added rule: MaxUnrealizedProfitRule

[32mINFO    [0m root:conftest.py:37 Risk Engine started
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Risk Engine stopped
[31m[1m_ TestMaxUnrealizedProfitIntegration.test_market_price_updates_real_time_monitoring _[0m
[1m[31mtests/integration/test_max_unrealized_profit_integration.py[0m:258: in test_market_price_updates_real_time_monitoring
    [0mevent_type=EventType.QUOTE_UPDATED,[90m[39;49;00m
               ^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: type object 'EventType' has no attribute 'QUOTE_UPDATED'[0m
---------------------------- Captured stdout setup -----------------------------
2025-10-28T03:35:04.076763Z | INFO     | engine.start:40 | ✅ Event loop running: 1 active rules monitoring events
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 Risk Engine initialized

[32mINFO    [0m root:conftest.py:37 Added rule: MaxUnrealizedProfitRule

[32mINFO    [0m root:conftest.py:37 Risk Engine started
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Risk Engine stopped
[31m[1m___ TestMaxUnrealizedProfitIntegration.test_different_tick_sizes_calculation ___[0m
[1m[31mtests/integration/test_max_unrealized_profit_integration.py[0m:296: in test_different_tick_sizes_calculation
    [0mevent_type=EventType.QUOTE_UPDATED,[90m[39;49;00m
               ^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: type object 'EventType' has no attribute 'QUOTE_UPDATED'[0m
---------------------------- Captured stdout setup -----------------------------
2025-10-28T03:35:04.158621Z | INFO     | engine.start:40 | ✅ Event loop running: 1 active rules monitoring events
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 Risk Engine initialized

[32mINFO    [0m root:conftest.py:37 Added rule: MaxUnrealizedProfitRule

[32mINFO    [0m root:conftest.py:37 Risk Engine started
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Risk Engine stopped
[31m[1m__ TestMaxUnrealizedProfitIntegration.test_long_and_short_positions_accuracy ___[0m
[1m[31mtests/integration/test_max_unrealized_profit_integration.py[0m:350: in test_long_and_short_positions_accuracy
    [0mevent_type=EventType.QUOTE_UPDATED,[90m[39;49;00m
               ^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: type object 'EventType' has no attribute 'QUOTE_UPDATED'[0m
---------------------------- Captured stdout setup -----------------------------
2025-10-28T03:35:04.241050Z | INFO     | engine.start:40 | ✅ Event loop running: 1 active rules monitoring events
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 Risk Engine initialized

[32mINFO    [0m root:conftest.py:37 Added rule: MaxUnrealizedProfitRule

[32mINFO    [0m root:conftest.py:37 Risk Engine started
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Risk Engine stopped
[31m[1m_ TestMaxUnrealizedProfitIntegration.test_event_bus_integration_complete_flow __[0m
[1m[31mtests/integration/test_max_unrealized_profit_integration.py[0m:410: in test_event_bus_integration_complete_flow
    [0mevent_type=EventType.QUOTE_UPDATED,[90m[39;49;00m
               ^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: type object 'EventType' has no attribute 'QUOTE_UPDATED'[0m
---------------------------- Captured stdout setup -----------------------------
2025-10-28T03:35:04.323297Z | INFO     | engine.start:40 | ✅ Event loop running: 1 active rules monitoring events
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 Risk Engine initialized

[32mINFO    [0m root:conftest.py:37 Added rule: MaxUnrealizedProfitRule

[32mINFO    [0m root:conftest.py:37 Risk Engine started
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Risk Engine stopped
[31m[1m_ TestMaxUnrealizedProfitIntegration.test_enforcement_closes_position_not_flatten_all _[0m
[1m[31mtests/integration/test_max_unrealized_profit_integration.py[0m:457: in test_enforcement_closes_position_not_flatten_all
    [0mevent_type=EventType.QUOTE_UPDATED,[90m[39;49;00m
               ^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: type object 'EventType' has no attribute 'QUOTE_UPDATED'[0m
---------------------------- Captured stdout setup -----------------------------
2025-10-28T03:35:04.404754Z | INFO     | engine.start:40 | ✅ Event loop running: 1 active rules monitoring events
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 Risk Engine initialized

[32mINFO    [0m root:conftest.py:37 Added rule: MaxUnrealizedProfitRule

[32mINFO    [0m root:conftest.py:37 Risk Engine started
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Risk Engine stopped
[31m[1m__ TestMaxUnrealizedProfitIntegration.test_zero_negative_profit_no_violation ___[0m
[1m[31mtests/integration/test_max_unrealized_profit_integration.py[0m:535: in test_zero_negative_profit_no_violation
    [0mevent_type=EventType.QUOTE_UPDATED,[90m[39;49;00m
               ^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: type object 'EventType' has no attribute 'QUOTE_UPDATED'[0m
---------------------------- Captured stdout setup -----------------------------
2025-10-28T03:35:04.509383Z | INFO     | engine.start:40 | ✅ Event loop running: 1 active rules monitoring events
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 Risk Engine initialized

[32mINFO    [0m root:conftest.py:37 Added rule: MaxUnrealizedProfitRule

[32mINFO    [0m root:conftest.py:37 Risk Engine started
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Risk Engine stopped
[31m[1m_ TestNoStopLossGraceIntegration.test_grace_period_timer_expires_and_closes_position _[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\integration\test_no_stop_loss_grace_integration.py[0m:116: in test_grace_period_timer_expires_and_closes_position
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert not True[0m
[1m[31mE    +  where True = has_timer('no_stop_loss_grace_CON.F.US.MNQ.Z25')[0m
[1m[31mE    +    where has_timer = <risk_manager.state.timer_manager.TimerManager object at 0x79bc624004d0>.has_timer[0m
[1m[31mE    +      where <risk_manager.state.timer_manager.TimerManager object at 0x79bc624004d0> = <risk_manager.rules.no_stop_loss_grace.NoStopLossGraceRule object at 0x79bc623b9fd0>.timer_manager[0m
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 TimerManager initialized

[32mINFO    [0m root:conftest.py:37 Background task started

[32mINFO    [0m root:conftest.py:37 TimerManager started

[32mINFO    [0m root:conftest.py:37 Timer loop started

[32mINFO    [0m root:conftest.py:37 NoStopLossGraceRule initialized - Grace period: 2s, Enforcement: close_position, Enabled: True
------------------------------ Captured log call -------------------------------
[32mINFO    [0m root:conftest.py:37 RULE-008: Position opened MNQ/CON.F.US.MNQ.Z25 (size=2), starting 2s grace period for stop-loss

[32mINFO    [0m root:conftest.py:37 Timer started: no_stop_loss_grace_CON.F.US.MNQ.Z25 (duration=2s, expires=22:35:06)
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Timer loop cancelled

[32mINFO    [0m root:conftest.py:37 Timer loop stopped

[32mINFO    [0m root:conftest.py:37 TimerManager stopped
[31m[1m__ TestNoStopLossGraceIntegration.test_multiple_positions_independent_timers ___[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\integration\test_no_stop_loss_grace_integration.py[0m:264: in test_multiple_positions_independent_timers
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   assert 0 == 1[0m
[1m[31mE    +  where 0 = len([])[0m
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 TimerManager initialized

[32mINFO    [0m root:conftest.py:37 Background task started

[32mINFO    [0m root:conftest.py:37 TimerManager started

[32mINFO    [0m root:conftest.py:37 Timer loop started

[32mINFO    [0m root:conftest.py:37 NoStopLossGraceRule initialized - Grace period: 2s, Enforcement: close_position, Enabled: True
------------------------------ Captured log call -------------------------------
[32mINFO    [0m root:conftest.py:37 RULE-008: Position opened ES/CON.F.US.ES.H25 (size=1), starting 2s grace period for stop-loss

[32mINFO    [0m root:conftest.py:37 Timer started: no_stop_loss_grace_CON.F.US.ES.H25 (duration=2s, expires=22:35:11)

[32mINFO    [0m root:conftest.py:37 RULE-008: Position opened MNQ/CON.F.US.MNQ.Z25 (size=2), starting 2s grace period for stop-loss

[32mINFO    [0m root:conftest.py:37 Timer started: no_stop_loss_grace_CON.F.US.MNQ.Z25 (duration=2s, expires=22:35:12)

[32mINFO    [0m root:conftest.py:37 Timer cancelled: no_stop_loss_grace_CON.F.US.ES.H25

[32mINFO    [0m root:conftest.py:37 RULE-008: Stop-loss order placed for ES/CON.F.US.ES.H25 (stopPrice=5180.0), grace period cancelled ✅
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Timer loop cancelled

[32mINFO    [0m root:conftest.py:37 Timer loop stopped

[32mINFO    [0m root:conftest.py:37 TimerManager stopped
[31m[1m_______ TestNoStopLossGraceIntegration.test_concurrent_timer_operations ________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\integration\test_no_stop_loss_grace_integration.py[0m:642: in test_concurrent_timer_operations
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   assert 0 == 2[0m
[1m[31mE    +  where 0 = len([])[0m
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 TimerManager initialized

[32mINFO    [0m root:conftest.py:37 Background task started

[32mINFO    [0m root:conftest.py:37 TimerManager started

[32mINFO    [0m root:conftest.py:37 Timer loop started

[32mINFO    [0m root:conftest.py:37 NoStopLossGraceRule initialized - Grace period: 2s, Enforcement: close_position, Enabled: True
------------------------------ Captured log call -------------------------------
[32mINFO    [0m root:conftest.py:37 RULE-008: Position opened SYM0/CON.F.US.MNQ.Z25 (size=1), starting 2s grace period for stop-loss

[32mINFO    [0m root:conftest.py:37 Timer started: no_stop_loss_grace_CON.F.US.MNQ.Z25 (duration=2s, expires=22:35:21)

[32mINFO    [0m root:conftest.py:37 RULE-008: Position opened SYM1/CON.F.US.ES.H25 (size=1), starting 2s grace period for stop-loss

[32mINFO    [0m root:conftest.py:37 Timer started: no_stop_loss_grace_CON.F.US.ES.H25 (duration=2s, expires=22:35:21)

[32mINFO    [0m root:conftest.py:37 RULE-008: Position opened SYM2/CON.F.US.NQ.Z25 (size=1), starting 2s grace period for stop-loss

[32mINFO    [0m root:conftest.py:37 Timer started: no_stop_loss_grace_CON.F.US.NQ.Z25 (duration=2s, expires=22:35:21)

[32mINFO    [0m root:conftest.py:37 RULE-008: Position opened SYM3/CON.F.US.YM.H25 (size=1), starting 2s grace period for stop-loss

[32mINFO    [0m root:conftest.py:37 Timer started: no_stop_loss_grace_CON.F.US.YM.H25 (duration=2s, expires=22:35:21)

[32mINFO    [0m root:conftest.py:37 RULE-008: Position opened SYM4/CON.F.US.RTY.Z25 (size=1), starting 2s grace period for stop-loss

[32mINFO    [0m root:conftest.py:37 Timer started: no_stop_loss_grace_CON.F.US.RTY.Z25 (duration=2s, expires=22:35:21)

[32mINFO    [0m root:conftest.py:37 Timer cancelled: no_stop_loss_grace_CON.F.US.MNQ.Z25

[32mINFO    [0m root:conftest.py:37 RULE-008: Stop-loss order placed for SYM0/CON.F.US.MNQ.Z25 (stopPrice=1000.0), grace period cancelled ✅

[32mINFO    [0m root:conftest.py:37 Timer cancelled: no_stop_loss_grace_CON.F.US.ES.H25

[32mINFO    [0m root:conftest.py:37 RULE-008: Stop-loss order placed for SYM1/CON.F.US.ES.H25 (stopPrice=1001.0), grace period cancelled ✅

[32mINFO    [0m root:conftest.py:37 Timer cancelled: no_stop_loss_grace_CON.F.US.NQ.Z25

[32mINFO    [0m root:conftest.py:37 RULE-008: Position closed for SYM2/CON.F.US.NQ.Z25, grace period cancelled
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Timer loop cancelled

[32mINFO    [0m root:conftest.py:37 Timer loop stopped

[32mINFO    [0m root:conftest.py:37 TimerManager stopped
[31m[1m____ TestNoStopLossGraceIntegration.test_enforcement_failure_does_not_crash ____[0m
[1m[31m/home/jakers/.local/share/uv/python/cpython-3.13.7-linux-x86_64-gnu/lib/python3.13/unittest/mock.py[0m:990: in assert_called_once_with
    [0m[94mraise[39;49;00m [96mAssertionError[39;49;00m(msg)[90m[39;49;00m
[1m[31mE   AssertionError: Expected 'close_position' to be called once. Called 0 times.[0m

[33mDuring handling of the above exception, another exception occurred:[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\integration\test_no_stop_loss_grace_integration.py[0m:684: in test_enforcement_failure_does_not_crash
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: Expected 'close_position' to be called once. Called 0 times.[0m
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 TimerManager initialized

[32mINFO    [0m root:conftest.py:37 Background task started

[32mINFO    [0m root:conftest.py:37 TimerManager started

[32mINFO    [0m root:conftest.py:37 Timer loop started

[32mINFO    [0m root:conftest.py:37 NoStopLossGraceRule initialized - Grace period: 2s, Enforcement: close_position, Enabled: True
------------------------------ Captured log call -------------------------------
[32mINFO    [0m root:conftest.py:37 RULE-008: Position opened MNQ/CON.F.US.MNQ.Z25 (size=2), starting 2s grace period for stop-loss

[32mINFO    [0m root:conftest.py:37 Timer started: no_stop_loss_grace_CON.F.US.MNQ.Z25 (duration=2s, expires=22:35:24)
---------------------------- Captured log teardown -----------------------------
[32mINFO    [0m root:conftest.py:37 Timer loop cancelled

[32mINFO    [0m root:conftest.py:37 Timer loop stopped

[32mINFO    [0m root:conftest.py:37 TimerManager stopped
[31m[1m_________________________ test_dry_run_pnl_calculation _________________________[0m
[1m[31mtests/runtime/test_dry_run.py[0m:175: in test_dry_run_pnl_calculation
    [0mdb = Database()[90m[39;49;00m
         ^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: Database.__init__() missing 1 required positional argument: 'db_path'[0m
[31m[1m_______________________ test_dry_run_vs_real_comparison ________________________[0m
[1m[31mtests/runtime/test_dry_run.py[0m:242: in test_dry_run_vs_real_comparison
    [0m[94massert[39;49;00m result[[33m'[39;49;00m[33mpassed[39;49;00m[33m'[39;49;00m] [95mis[39;49;00m [94mTrue[39;49;00m[90m[39;49;00m
[1m[31mE   assert False is True[0m
[31m[1m__________________ test_post_condition_event_bus_operational ___________________[0m
[1m[31mtests/runtime/test_post_conditions.py[0m:133: in test_post_condition_event_bus_operational
    [0m[94massert[39;49;00m result[[33m'[39;49;00m[33mpassed[39;49;00m[33m'[39;49;00m] [95mis[39;49;00m [94mTrue[39;49;00m[90m[39;49;00m
[1m[31mE   assert False is True[0m
[31m[1m_________________________ test_smoke_event_bus_success _________________________[0m
[1m[31mtests/runtime/test_smoke.py[0m:94: in test_smoke_event_bus_success
    [0m[94massert[39;49;00m result[[33m'[39;49;00m[33mpassed[39;49;00m[33m'[39;49;00m] [95mis[39;49;00m [94mTrue[39;49;00m[90m[39;49;00m
[1m[31mE   assert False is True[0m
[31m[1m______________________ test_smoke_state_tracking_success _______________________[0m
[1m[31mtests/runtime/test_smoke.py[0m:127: in test_smoke_state_tracking_success
    [0mdb = Database()[90m[39;49;00m
         ^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: Database.__init__() missing 1 required positional argument: 'db_path'[0m
[31m[1m____ TestEnvironmentVariableSubstitution.test_explicit_params_override_env _____[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_env_substitution.py[0m:46: in test_explicit_params_override_env
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'env_key' == 'explicit_key'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- explicit_key[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ env_key[39;49;00m[90m[39;49;00m[0m
[31m[1m________ TestEnvironmentVariableSubstitution.test_partial_env_variables ________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_env_substitution.py[0m:56: in test_partial_env_variables
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'jakertrader\r' == 'explicit_user'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- explicit_user[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ jakertrader[39;49;00m[90m[39;49;00m[0m
[31m[1m___ TestEnvironmentVariableSubstitution.test_missing_optional_env_variables ____[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_env_substitution.py[0m:138: in test_missing_optional_env_variables
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert '' is None[0m
[1m[31mE    +  where '' = RiskConfig(project_x_api_key='test_key', project_x_username='test_user', project_x_api_url='https://api.topstepx.com/api', project_x_websocket_url='wss://api.topstepx.com', max_daily_loss=-1000.0, max_contracts=5, require_stop_loss=True, stop_loss_grace_seconds=60, log_level='INFO', log_file='logs/risk_manager.log', enforcement_latency_target_ms=500, max_events_per_second=1000, anthropic_api_key='', enable_ai=False, enable_pattern_recognition=False, enable_anomaly_detection=False, discord_webhook_url='', telegram_bot_token='', telegram_chat_id='', environment='development', debug=False).anthropic_api_key[0m
[31m[1m__________ TestEnvironmentVariableSubstitution.test_env_file_loading ___________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_env_substitution.py[0m:157: in test_env_file_loading
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'dotenv_key'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- dotenv_key[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m___ TestEnvironmentVariableSubstitution.test_env_variables_override_env_file ___[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_env_substitution.py[0m:176: in test_env_variables_override_env_file
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'jakertrader\r' == 'dotenv_user'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- dotenv_user[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ jakertrader[39;49;00m[90m[39;49;00m[0m
[31m[1m____ TestEnvironmentVariableSubstitution.test_missing_required_env_variable ____[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_env_substitution.py[0m:284: in test_missing_required_env_variable
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   Failed: DID NOT RAISE <class 'Exception'>[0m
[31m[1m_______ TestEnvironmentVariableSubstitution.test_env_file_with_comments ________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_env_substitution.py[0m:302: in test_env_file_with_comments
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'dotenv_key'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- dotenv_key[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m________ TestEnvironmentVariableSubstitution.test_env_file_with_quotes _________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_env_substitution.py[0m:318: in test_env_file_with_quotes
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'key' in 'tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=\r'[0m
[1m[31mE    +  where 'tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=\r' = RiskConfig(project_x_api_key='tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=\r', project_x_username='jakertrader\r', project_x_api_url='https://api.topstepx.com/api', project_x_websocket_url='wss://api.topstepx.com', max_daily_loss=-1000.0, max_contracts=5, require_stop_loss=True, stop_loss_grace_seconds=60, log_level='INFO', log_file=None, enforcement_latency_target_ms=500, max_events_per_second=1000, anthropic_api_key=None, enable_ai=False, enable_pattern_recognition=False, enable_anomaly_detection=False, discord_webhook_url=None, telegram_bot_token=None, telegram_chat_id=None, environment='development', debug=False).project_x_api_key[0m
[31m[1m________ TestEnvironmentVariableSubstitution.test_combined_yaml_and_env ________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_env_substitution.py[0m:363: in test_combined_yaml_and_env
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'yaml_key'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- yaml_key[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m__________________ TestConfigLoader.test_load_valid_yaml_file __________________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_loader.py[0m:27: in test_load_valid_yaml_file
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key_123'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- test_key_123[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m_______________ TestConfigLoader.test_load_yaml_with_all_fields ________________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_loader.py[0m:61: in test_load_yaml_with_all_fields
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- test_key[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m____________ TestConfigLoader.test_load_yaml_minimal_required_only _____________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_loader.py[0m:78: in test_load_yaml_minimal_required_only
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'minimal_key'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- minimal_key[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m____________ TestConfigLoader.test_load_yaml_missing_required_field ____________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_loader.py[0m:93: in test_load_yaml_missing_required_field
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>[0m
[31m[1m__________________ TestConfigLoader.test_load_empty_yaml_file __________________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_loader.py[0m:112: in test_load_empty_yaml_file
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31msrc/risk_manager/core/config.py[0m:74: in from_file
    [0m[94mreturn[39;49;00m [96mcls[39;49;00m(**config_data)[90m[39;49;00m
           ^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: risk_manager.core.config.RiskConfig() argument after ** must be a mapping, not NoneType[0m
[31m[1m_______________ TestConfigLoader.test_load_yaml_with_null_values _______________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_loader.py[0m:128: in test_load_yaml_with_null_values
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert '' is None[0m
[1m[31mE    +  where '' = RiskConfig(project_x_api_key='tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=\r', project_x_username='jakertrader\r', project_x_api_url='https://api.topstepx.com/api', project_x_websocket_url='wss://api.topstepx.com', max_daily_loss=-1000.0, max_contracts=5, require_stop_loss=True, stop_loss_grace_seconds=60, log_level='INFO', log_file=None, enforcement_latency_target_ms=500, max_events_per_second=1000, anthropic_api_key='', enable_ai=False, enable_pattern_recognition=False, enable_anomaly_detection=False, discord_webhook_url=None, telegram_bot_token='', telegram_chat_id='', environment='development', debug=False).anthropic_api_key[0m
[31m[1m________________ TestConfigLoader.test_load_yaml_with_comments _________________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_loader.py[0m:144: in test_load_yaml_with_comments
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- test_key[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m______________ TestConfigLoader.test_load_yaml_with_extra_fields _______________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_loader.py[0m:159: in test_load_yaml_with_extra_fields
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- test_key[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m____________ TestConfigLoader.test_load_yaml_with_nested_structure _____________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_loader.py[0m:175: in test_load_yaml_with_nested_structure
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- test_key[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m_________________ TestConfigLoader.test_load_from_string_path __________________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_loader.py[0m:251: in test_load_from_string_path
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- test_key[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m_________________ TestConfigLoader.test_load_from_pathlib_path _________________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_loader.py[0m:264: in test_load_from_pathlib_path
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- test_key[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m_______________ TestConfigLoader.test_load_yaml_with_list_values _______________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_loader.py[0m:278: in test_load_yaml_with_list_values
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- test_key[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m___________ TestConfigLoader.test_load_yaml_with_scientific_notation ___________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_loader.py[0m:290: in test_load_yaml_with_scientific_notation
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31msrc/risk_manager/core/config.py[0m:74: in from_file
    [0m[94mreturn[39;49;00m [96mcls[39;49;00m(**config_data)[90m[39;49;00m
           ^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31m.venv/lib/python3.13/site-packages/pydantic_settings/main.py[0m:193: in __init__
    [0m[96msuper[39;49;00m().[92m__init__[39;49;00m([90m[39;49;00m
[1m[31mE   pydantic_core._pydantic_core.ValidationError: 1 validation error for RiskConfig[0m
[1m[31mE   max_events_per_second[0m
[1m[31mE     Input should be a valid integer, unable to parse string as an integer [type=int_parsing, input_value='1e4', input_type=str][0m
[1m[31mE       For further information visit https://errors.pydantic.dev/2.12/v/int_parsing[0m
[31m[1m____________ TestConfigLoader.test_load_yaml_with_multiline_strings ____________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_loader.py[0m:308: in test_load_yaml_with_multiline_strings
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'test_key_multiline' in 'tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=\r'[0m
[1m[31mE    +  where 'tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=\r' = RiskConfig(project_x_api_key='tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=\r', project_x_username='jakertrader\r', project_x_api_url='https://api.topstepx.com/api', project_x_websocket_url='wss://api.topstepx.com', max_daily_loss=-1000.0, max_contracts=5, require_stop_loss=True, stop_loss_grace_seconds=60, log_level='INFO', log_file='logs/risk_manager.log', enforcement_latency_target_ms=500, max_events_per_second=1000, anthropic_api_key='', enable_ai=False, enable_pattern_recognition=False, enable_anomaly_detection=False, discord_webhook_url='', telegram_bot_token='', telegram_chat_id='', environment='development', debug=False).project_x_api_key[0m
[31m[1m______ TestConfigLoader.test_load_yaml_with_special_characters_in_strings ______[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_loader.py[0m:341: in test_load_yaml_with_special_characters_in_strings
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test@key#123!$%'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- test@key#123!$%[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m___________ TestConfigLoader.test_load_yaml_with_unicode_characters ____________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_loader.py[0m:355: in test_load_yaml_with_unicode_characters
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert '™' in 'tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=\r'[0m
[1m[31mE    +  where 'tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=\r' = RiskConfig(project_x_api_key='tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=\r', project_x_username='jakertrader\r', project_x_api_url='https://api.topstepx.com/api', project_x_websocket_url='wss://api.topstepx.com', max_daily_loss=-1000.0, max_contracts=5, require_stop_loss=True, stop_loss_grace_seconds=60, log_level='INFO', log_file='logs/risk_manager.log', enforcement_latency_target_ms=500, max_events_per_second=1000, anthropic_api_key='', enable_ai=False, enable_pattern_recognition=False, enable_anomaly_detection=False, discord_webhook_url='', telegram_bot_token='', telegram_chat_id='', environment='development', debug=False).project_x_api_key[0m
[31m[1m________________ TestConfigLoader.test_load_yaml_relative_path _________________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_loader.py[0m:389: in test_load_yaml_relative_path
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- test_key[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m________________ TestConfigLoader.test_load_yaml_absolute_path _________________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_loader.py[0m:402: in test_load_yaml_absolute_path
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- test_key[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m___________________ TestConfigLoader.test_to_dict_roundtrip ____________________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_loader.py[0m:417: in test_to_dict_roundtrip
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- test_key[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m________________ TestRiskConfigModel.test_valid_config_minimal _________________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_models.py[0m:21: in test_valid_config_minimal
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- test_key[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m_______________ TestRiskConfigModel.test_valid_config_all_fields _______________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_models.py[0m:57: in test_valid_config_all_fields
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- test_key[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m___________ TestRiskConfigModel.test_missing_required_field_api_key ____________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_models.py[0m:66: in test_missing_required_field_api_key
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>[0m
[31m[1m___________ TestRiskConfigModel.test_missing_required_field_username ___________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_models.py[0m:74: in test_missing_required_field_username
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>[0m
[31m[1m____________ TestRiskConfigModel.test_missing_both_required_fields _____________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_models.py[0m:82: in test_missing_both_required_fields
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>[0m
[31m[1m________________ TestRiskConfigModel.test_optional_fields_none _________________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_models.py[0m:142: in test_optional_fields_none
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert '' is None[0m
[1m[31mE    +  where '' = RiskConfig(project_x_api_key='tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=\r', project_x_username='jakertrader\r', project_x_api_url='https://api.topstepx.com/api', project_x_websocket_url='wss://api.topstepx.com', max_daily_loss=-1000.0, max_contracts=5, require_stop_loss=True, stop_loss_grace_seconds=60, log_level='INFO', log_file=None, enforcement_latency_target_ms=500, max_events_per_second=1000, anthropic_api_key='', enable_ai=False, enable_pattern_recognition=False, enable_anomaly_detection=False, discord_webhook_url=None, telegram_bot_token=None, telegram_chat_id=None, environment='development', debug=False).anthropic_api_key[0m
[31m[1m_________________ TestRiskConfigModel.test_string_fields_empty _________________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_models.py[0m:228: in test_string_fields_empty
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == ''[0m
[1m[31mE     [0m
[1m[31mE     [0m[92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m___________________ TestRiskConfigModel.test_to_dict_method ____________________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_models.py[0m:255: in test_to_dict_method
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- test_key[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m__________________ TestRiskConfigModel.test_url_fields_format __________________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_models.py[0m:297: in test_url_fields_format
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'https://api.topstepx.com/api' == 'https://custom.com/api'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- https://custom.com/api[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ https://api.topstepx.com/api[39;49;00m[90m[39;49;00m[0m
[31m[1m_____________ TestFieldValidation.test_empty_string_api_key_valid ______________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_validator.py[0m:118: in test_empty_string_api_key_valid
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == ''[0m
[1m[31mE     [0m
[1m[31mE     [0m[92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m_____________ TestFieldValidation.test_empty_string_username_valid _____________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_validator.py[0m:126: in test_empty_string_username_valid
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'jakertrader\r' == ''[0m
[1m[31mE     [0m
[1m[31mE     [0m[92m+ jakertrader[39;49;00m[90m[39;49;00m[0m
[31m[1m___________ TestFieldValidation.test_whitespace_string_api_key_valid ___________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_validator.py[0m:134: in test_whitespace_string_api_key_valid
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == '   '[0m
[1m[31mE     [0m
[1m[31mE     Strings contain only whitespace, escaping them using repr()[0m
[1m[31mE     [0m[91m- '   '[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ 'tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=\r'[39;49;00m[90m[39;49;00m[0m
[31m[1m_____________ TestFieldValidation.test_invalid_url_format_allowed ______________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_validator.py[0m:203: in test_invalid_url_format_allowed
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'https://api.topstepx.com/api' == 'not_a_url'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- not_a_url[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ https://api.topstepx.com/api[39;49;00m[90m[39;49;00m[0m
[31m[1m_____________ TestModelValidation.test_all_required_fields_present _____________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_validator.py[0m:215: in test_all_required_fields_present
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- test_key[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m___________ TestModelValidation.test_conflicting_ai_settings_allowed ___________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_validator.py[0m:228: in test_conflicting_ai_settings_allowed
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert '' is None[0m
[1m[31mE    +  where '' = RiskConfig(project_x_api_key='tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=\r', project_x_username='jakertrader\r', project_x_api_url='https://api.topstepx.com/api', project_x_websocket_url='wss://api.topstepx.com', max_daily_loss=-1000.0, max_contracts=5, require_stop_loss=True, stop_loss_grace_seconds=60, log_level='INFO', log_file='logs/risk_manager.log', enforcement_latency_target_ms=500, max_events_per_second=1000, anthropic_api_key='', enable_ai=True, enable_pattern_recognition=False, enable_anomaly_detection=False, discord_webhook_url='', telegram_bot_token='', telegram_chat_id='', environment='development', debug=False).anthropic_api_key[0m
[31m[1m________________ TestTypeValidation.test_float_to_int_coercion _________________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_validator.py[0m:330: in test_float_to_int_coercion
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31m.venv/lib/python3.13/site-packages/pydantic_settings/main.py[0m:193: in __init__
    [0m[96msuper[39;49;00m().[92m__init__[39;49;00m([90m[39;49;00m
[1m[31mE   pydantic_core._pydantic_core.ValidationError: 1 validation error for RiskConfig[0m
[1m[31mE   max_contracts[0m
[1m[31mE     Input should be a valid integer, got a number with a fractional part [type=int_from_float, input_value=10.9, input_type=float][0m
[1m[31mE       For further information visit https://errors.pydantic.dev/2.12/v/int_from_float[0m
[31m[1m_____________ TestTypeValidation.test_list_to_string_raises_error ______________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_validator.py[0m:362: in test_list_to_string_raises_error
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>[0m
[31m[1m_____________ TestTypeValidation.test_dict_to_string_raises_error ______________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_validator.py[0m:370: in test_dict_to_string_raises_error
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>[0m
[31m[1m_________ TestTypeValidation.test_none_for_required_field_raises_error _________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_validator.py[0m:378: in test_none_for_required_field_raises_error
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>[0m
[31m[1m____________ TestTypeValidation.test_none_for_optional_field_valid _____________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_validator.py[0m:393: in test_none_for_optional_field_valid
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert '' is None[0m
[1m[31mE    +  where '' = RiskConfig(project_x_api_key='tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=\r', project_x_username='jakertrader\r', project_x_api_url='https://api.topstepx.com/api', project_x_websocket_url='wss://api.topstepx.com', max_daily_loss=-1000.0, max_contracts=5, require_stop_loss=True, stop_loss_grace_seconds=60, log_level='INFO', log_file=None, enforcement_latency_target_ms=500, max_events_per_second=1000, anthropic_api_key='', enable_ai=False, enable_pattern_recognition=False, enable_anomaly_detection=False, discord_webhook_url='', telegram_bot_token='', telegram_chat_id='', environment='development', debug=False).anthropic_api_key[0m
[31m[1m_________ TestErrorMessages.test_missing_required_field_error_message __________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_validator.py[0m:401: in test_missing_required_field_error_message
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>[0m
[31m[1m_______________ TestErrorMessages.test_multiple_errors_reported ________________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_validator.py[0m:430: in test_multiple_errors_reported
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 2 >= 3[0m
[1m[31mE    +  where 2 = len([{'input': 'also_invalid', 'loc': ('max_daily_loss',), 'msg': 'Input should be a valid number, unable to parse string as a number', 'type': 'float_parsing', ...}, {'input': 'invalid', 'loc': ('max_contracts',), 'msg': 'Input should be a valid integer, unable to parse string as an integer', 'type': 'int_parsing', ...}])[0m
[31m[1m_____________ TestErrorMessages.test_error_includes_field_location _____________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_validator.py[0m:434: in test_error_includes_field_location
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>[0m
[31m[1m_____________________ TestEdgeCases.test_very_long_strings _____________________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_validator.py[0m:488: in test_very_long_strings
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 45 == 10000[0m
[1m[31mE    +  where 45 = len('tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=\r')[0m
[1m[31mE    +    where 'tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=\r' = RiskConfig(project_x_api_key='tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=\r', project_x_username='jakertrader\r', project_x_api_url='https://api.topstepx.com/api', project_x_websocket_url='wss://api.topstepx.com', max_daily_loss=-1000.0, max_contracts=5, require_stop_loss=True, stop_loss_grace_seconds=60, log_level='INFO', log_file='logs/risk_manager.log', enforcement_latency_target_ms=500, max_events_per_second=1000, anthropic_api_key='', enable_ai=False, enable_pattern_recognition=False, enable_anomaly_detection=False, discord_webhook_url='', telegram_bot_token='', telegram_chat_id='', environment='development', debug=False).project_x_api_key[0m
[31m[1m__________ TestEdgeCases.test_special_characters_in_all_string_fields __________[0m
[1m[31mC:\Users\jakers\Desktop\risk-manager-v34\tests\unit\test_config\test_validator.py[0m:499: in test_special_characters_in_all_string_fields
    [0m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[04m[91m?[39;49;00m[90m[39;49;00m
[1m[31mE   assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == "!@#$%^&*()_+...}|;':,.<>?/~`"[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- !@#$%^&*()_+-=[]{}|;':,.<>?/~`[39;49;00m[90m[39;49;00m[0m
[1m[31mE     [92m+ tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=[39;49;00m[90m[39;49;00m[0m
[31m[1m_____________ TestCooldownAfterLossRule.test_cooldown_starts_timer _____________[0m
[1m[31mtests/unit/test_rules/test_cooldown_after_loss.py[0m:355: in test_cooldown_starts_timer
    [0m[94mawait[39;49;00m simple_rule.enforce([33m"[39;49;00m[33mACC-001[39;49;00m[33m"[39;49;00m, violation, mock_engine)[90m[39;49;00m
[1m[31msrc/risk_manager/rules/cooldown_after_loss.py[0m:267: in enforce
    [0m[94mawait[39;49;00m [96mself[39;49;00m.lockout_manager.set_cooldown([90m[39;49;00m
[1m[31mE   TypeError: object Mock can't be used in 'await' expression[0m
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 CooldownAfterLossRule initialized: 1 tiers
------------------------------ Captured log call -------------------------------
[32mINFO    [0m root:conftest.py:37 Cooldown triggered for account ACC-001: Loss=$-150.00, Cooldown=300s

[32mINFO    [0m root:conftest.py:37 ENFORCING RULE-007: Account ACC-001 Loss: $-150.00, Cooldown: 300s
[31m[1m_______ TestCooldownAfterLossRule.test_cooldown_expires_unlocks_account ________[0m
[1m[31mtests/unit/test_rules/test_cooldown_after_loss.py[0m:382: in test_cooldown_expires_unlocks_account
    [0m[94mawait[39;49;00m simple_rule.enforce([33m"[39;49;00m[33mACC-001[39;49;00m[33m"[39;49;00m, violation, Mock())[90m[39;49;00m
[1m[31msrc/risk_manager/rules/cooldown_after_loss.py[0m:267: in enforce
    [0m[94mawait[39;49;00m [96mself[39;49;00m.lockout_manager.set_cooldown([90m[39;49;00m
[1m[31mE   TypeError: object Mock can't be used in 'await' expression[0m
------------------------------ Captured log setup ------------------------------
[32mINFO    [0m root:conftest.py:37 CooldownAfterLossRule initialized: 1 tiers
------------------------------ Captured log call -------------------------------
[32mINFO    [0m root:conftest.py:37 ENFORCING RULE-007: Account ACC-001 Loss: $-150.00, Cooldown: 300s
[33m=============================== warnings summary ===============================[0m
.venv/lib/python3.13/site-packages/uvloop/__init__.py:154
  /mnt/c/Users/jakers/Desktop/risk-manager-v34/.venv/lib/python3.13/site-packages/uvloop/__init__.py:154: DeprecationWarning: uvloop.install() is deprecated in favor of uvloop.run() starting with Python 3.12.
    _warnings.warn(

tests/e2e/test_max_contracts_e2e.py:80
  /mnt/c/Users/jakers/Desktop/risk-manager-v34/tests/e2e/test_max_contracts_e2e.py:80: PytestUnknownMarkWarning: Unknown pytest.mark.e2e - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.e2e

tests/integration/test_cooldown_after_loss_integration.py: 15 warnings
tests/integration/test_daily_realized_loss_integration.py: 10 warnings
tests/integration/test_daily_realized_profit_integration.py: 15 warnings
tests/integration/test_session_block_outside_integration.py: 12 warnings
tests/integration/test_trade_frequency_limit_integration.py: 12 warnings
tests/unit/test_state/test_lockout_manager.py: 31 warnings
tests/unit/test_state/test_pnl_tracker.py: 12 warnings
tests/unit/test_state/test_reset_scheduler.py: 23 warnings
  /mnt/c/Users/jakers/Desktop/risk-manager-v34/src/risk_manager/state/database.py:82: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    (1, datetime.utcnow().isoformat()),

tests/integration/test_daily_realized_profit_integration.py: 34 warnings
tests/unit/test_state/test_pnl_tracker.py: 23 warnings
  /mnt/c/Users/jakers/Desktop/risk-manager-v34/src/risk_manager/state/pnl_tracker.py:63: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow().isoformat()

tests/integration/test_daily_realized_profit_integration.py::test_reset_scheduler_integration
tests/unit/test_state/test_pnl_tracker.py::TestPnLTrackerReset::test_reset_clears_daily_pnl
tests/unit/test_state/test_pnl_tracker.py::TestPnLTrackerTradeCount::test_trade_count_resets_with_pnl
  /mnt/c/Users/jakers/Desktop/risk-manager-v34/src/risk_manager/state/pnl_tracker.py:194: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow().isoformat()

tests/runtime/test_post_conditions.py::test_post_condition_event_bus_operational
  /mnt/c/Users/jakers/Desktop/risk-manager-v34/tests/runtime/test_post_conditions.py:117: RuntimeWarning: coroutine 'EventBus.publish' was never awaited
    bus.publish(RiskEvent(event_type=EventType.TRADE_EXECUTED, data={}))
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/runtime/test_smoke.py::test_smoke_event_bus_success
  /mnt/c/Users/jakers/Desktop/risk-manager-v34/tests/runtime/test_smoke.py:85: RuntimeWarning: coroutine 'EventBus.publish' was never awaited
    bus.publish(RiskEvent(event_type=EventType.POSITION_UPDATED, data={}))
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/test_state/test_lockout_manager.py::TestCooldownTimers::test_cooldown_auto_expires_after_duration
tests/unit/test_state/test_lockout_manager.py::TestCooldownTimers::test_cooldown_cleared_cancels_timer
  /mnt/c/Users/jakers/Desktop/risk-manager-v34/src/risk_manager/state/lockout_manager.py:394: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    self.timer_manager.cancel_timer(f"lockout_{account_id}")
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.13.7-final-0 ________________

Name                                                     Stmts   Miss Branch BrPart   Cover   Missing
-----------------------------------------------------------------------------------------------------
src/risk_manager/__init__.py                                 4      0      0      0 100.00%
src/risk_manager/ai/__init__.py                              0      0      0      0 100.00%
src/risk_manager/ai/integration.py                          48     48      6      0   0.00%   10-121
src/risk_manager/config/__init__.py                         10     10      2      0   0.00%   30-223
src/risk_manager/config/env.py                              69     69     34      0   0.00%   10-242
src/risk_manager/config/examples.py                        170    170     22      0   0.00%   11-339
src/risk_manager/config/loader.py                          126    126     16      0   0.00%   11-435
src/risk_manager/config/models.py                          603    603    118      0   0.00%   13-1496
src/risk_manager/config/validator.py                       172    172     98      0   0.00%   15-748
src/risk_manager/core/__init__.py                            5      0      0      0 100.00%
src/risk_manager/core/config.py                             39      0      2      0 100.00%
src/risk_manager/core/engine.py                             96     12     18      1  86.84%   87-88, 150-153, 175-176, 209-214, 218
src/risk_manager/core/events.py                             65      2     10      1  96.00%   68, 79, 102->exit
src/risk_manager/core/manager.py                           113     88     38      0  16.56%   27-47, 51-59, 95-125, 129-145, 149-160, 164-190, 194-216, 220-239, 243-244, 248, 252, 256, 260, 264
src/risk_manager/integrations/__init__.py                    0      0      0      0 100.00%
src/risk_manager/integrations/trading.py                   187    187     52      0   0.00%   3-416
src/risk_manager/rules/__init__.py                          16      0      0      0 100.00%
src/risk_manager/rules/auth_loss_guard.py                   51      1     18      1  97.10%   172
src/risk_manager/rules/base.py                              17      2      0      0  88.24%   42, 46
src/risk_manager/rules/cooldown_after_loss.py               61      3     24      1  95.29%   154, 262-263
src/risk_manager/rules/daily_loss.py                        17     11      8      0  24.00%   23-27, 31-48
src/risk_manager/rules/daily_realized_loss.py               63     27     16      3  59.49%   130, 143-144, 154-155, 160-162, 214-231, 257-289
src/risk_manager/rules/daily_realized_profit.py             67     12     16      3  81.93%   152-153, 163-164, 169-171, 237-238, 286->290, 299-302
src/risk_manager/rules/daily_unrealized_loss.py             45      2     20      2  93.85%   105, 178
src/risk_manager/rules/max_contracts_per_instrument.py      81     64     36      1  15.38%   54-58, 78-122, 138-180, 189-246, 255
src/risk_manager/rules/max_position.py                      24      5     14      2  71.05%   34, 47-50
src/risk_manager/rules/max_unrealized_profit.py             45      4     20      4  87.69%   92, 104, 170, 177
src/risk_manager/rules/no_stop_loss_grace.py                89      4     34      6  91.87%   189, 226, 231->238, 258-259, 303->315, 307->306
src/risk_manager/rules/session_block_outside.py             84      3     22      1  96.23%   111, 123-124
src/risk_manager/rules/symbol_blocks.py                     31      1     14      1  95.56%   71
src/risk_manager/rules/trade_frequency_limit.py             59      1     22      3  95.06%   163->185, 186->208, 209->235, 274
src/risk_manager/rules/trade_management.py                 108     15     54     12  80.86%   147, 169, 240, 257, 262, 267, 274, 293-298, 307->317, 311-315, 407
src/risk_manager/sdk/__init__.py                             4      4      0      0   0.00%   13-17
src/risk_manager/sdk/enforcement.py                        153    153     30      0   0.00%   8-343
src/risk_manager/sdk/event_bridge.py                       138    138     38      0   0.00%   13-379
src/risk_manager/sdk/suite_manager.py                       89     89     24      0   0.00%   8-223
src/risk_manager/state/__init__.py                           6      0      0      0 100.00%
src/risk_manager/state/database.py                          74      1     10      2  96.43%   77->exit, 269
src/risk_manager/state/lockout_manager.py                  145     20     48     11  82.90%   159, 248->261, 256-257, 290, 328, 355-363, 378, 395-396, 421, 457, 459, 483-484, 489
src/risk_manager/state/pnl_tracker.py                       56      8     16      1  81.94%   225, 257-277
src/risk_manager/state/reset_scheduler.py                  140     18     38     12  82.02%   121->128, 227, 233, 246->277, 266->273, 269->273, 338, 352-353, 357-360, 382->390, 386-387, 390->398, 394-395, 408-409, 434->445, 441-443
src/risk_manager/state/timer_manager.py                     95      8     26      5  89.26%   62-63, 77->85, 180-181, 213->224, 220-222, 235
src/runtime/__init__.py                                      6      6      0      0   0.00%   15-21
src/runtime/async_debug.py                                 101    101     28      0   0.00%   18-258
src/runtime/dry_run.py                                     146    146     34      0   0.00%   23-394
src/runtime/heartbeat.py                                    74     74     14      0   0.00%   17-197
src/runtime/post_conditions.py                              63     63      8      0   0.00%   16-213
src/runtime/smoke_test.py                                   71     71      6      0   0.00%   19-225
-----------------------------------------------------------------------------------------------------
TOTAL                                                     3926   2542   1054     73  34.84%
[36m[1m=========================== short test summary info ============================[0m
[31mFAILED[0m tests/integration/test_cooldown_after_loss_integration.py::[1mTestCooldownAfterLossIntegration::test_database_cleanup_on_lockout_clear[0m - assert 1 == 0
[31mFAILED[0m tests/integration/test_daily_realized_loss_integration.py::[1mTestDailyRealizedLossIntegration::test_full_loss_limit_flow_with_database[0m - assert 0.0 == -300.0
[31mFAILED[0m tests/integration/test_daily_realized_loss_integration.py::[1mTestDailyRealizedLossIntegration::test_multi_account_independence[0m - assert None is not None
[31mFAILED[0m tests/integration/test_daily_realized_loss_integration.py::[1mTestDailyRealizedLossIntegration::test_lockout_persistence_crash_recovery[0m - TypeError: DailyRealizedLossRule.__init__() got an unexpected keyword argum...
[31mFAILED[0m tests/integration/test_daily_realized_loss_integration.py::[1mTestDailyRealizedLossIntegration::test_reset_scheduler_integration[0m - TypeError: 'NoneType' object is not subscriptable
[31mFAILED[0m tests/integration/test_daily_realized_loss_integration.py::[1mTestDailyRealizedLossIntegration::test_mixed_profit_loss_day[0m - assert 0.0 == -400.0
[31mFAILED[0m tests/integration/test_daily_realized_loss_integration.py::[1mTestDailyRealizedLossIntegration::test_concurrent_access_thread_safety[0m - assert 0.0 == -1000.0
[31mFAILED[0m tests/integration/test_daily_realized_loss_integration.py::[1mTestDailyRealizedLossIntegration::test_database_schema_validation[0m - AssertionError: assert 'pnl' in ['id', 'account_id', 'date', 'realized_pnl'...
[31mFAILED[0m tests/integration/test_daily_realized_loss_integration.py::[1mTestDailyRealizedLossIntegration::test_boundary_exactly_at_limit[0m - assert None is not None
[31mFAILED[0m tests/integration/test_daily_realized_loss_integration.py::[1mTestDailyRealizedLossIntegration::test_timer_auto_unlock[0m - TypeError: 'NoneType' object is not subscriptable
[31mFAILED[0m tests/integration/test_max_contracts_per_instrument_integration.py::[1mTestMaxContractsPerInstrumentIntegration::test_single_symbol_within_limit[0m - NameError: name 'engine' is not defined
[31mFAILED[0m tests/integration/test_max_contracts_per_instrument_integration.py::[1mTestMaxContractsPerInstrumentIntegration::test_single_symbol_exceeds_limit[0m - NameError: name 'engine' is not defined
[31mFAILED[0m tests/integration/test_max_contracts_per_instrument_integration.py::[1mTestMaxContractsPerInstrumentIntegration::test_multiple_symbols_independent_limits[0m - NameError: name 'engine' is not defined
[31mFAILED[0m tests/integration/test_max_contracts_per_instrument_integration.py::[1mTestMaxContractsPerInstrumentIntegration::test_one_symbol_violates_others_ok[0m - NameError: name 'engine' is not defined
[31mFAILED[0m tests/integration/test_max_contracts_per_instrument_integration.py::[1mTestMaxContractsPerInstrumentIntegration::test_symbol_without_configured_limit[0m - NameError: name 'engine' is not defined
[31mFAILED[0m tests/integration/test_max_unrealized_profit_integration.py::[1mTestMaxUnrealizedProfitIntegration::test_es_long_position_reaches_target[0m - AssertionError: assert 1 == 0
[31mFAILED[0m tests/integration/test_max_unrealized_profit_integration.py::[1mTestMaxUnrealizedProfitIntegration::test_mnq_short_position_reaches_target[0m - AttributeError: type object 'EventType' has no attribute 'QUOTE_UPDATED'
[31mFAILED[0m tests/integration/test_max_unrealized_profit_integration.py::[1mTestMaxUnrealizedProfitIntegration::test_multi_position_independence[0m - AttributeError: type object 'EventType' has no attribute 'QUOTE_UPDATED'
[31mFAILED[0m tests/integration/test_max_unrealized_profit_integration.py::[1mTestMaxUnrealizedProfitIntegration::test_market_price_updates_real_time_monitoring[0m - AttributeError: type object 'EventType' has no attribute 'QUOTE_UPDATED'
[31mFAILED[0m tests/integration/test_max_unrealized_profit_integration.py::[1mTestMaxUnrealizedProfitIntegration::test_different_tick_sizes_calculation[0m - AttributeError: type object 'EventType' has no attribute 'QUOTE_UPDATED'
[31mFAILED[0m tests/integration/test_max_unrealized_profit_integration.py::[1mTestMaxUnrealizedProfitIntegration::test_long_and_short_positions_accuracy[0m - AttributeError: type object 'EventType' has no attribute 'QUOTE_UPDATED'
[31mFAILED[0m tests/integration/test_max_unrealized_profit_integration.py::[1mTestMaxUnrealizedProfitIntegration::test_event_bus_integration_complete_flow[0m - AttributeError: type object 'EventType' has no attribute 'QUOTE_UPDATED'
[31mFAILED[0m tests/integration/test_max_unrealized_profit_integration.py::[1mTestMaxUnrealizedProfitIntegration::test_enforcement_closes_position_not_flatten_all[0m - AttributeError: type object 'EventType' has no attribute 'QUOTE_UPDATED'
[31mFAILED[0m tests/integration/test_max_unrealized_profit_integration.py::[1mTestMaxUnrealizedProfitIntegration::test_zero_negative_profit_no_violation[0m - AttributeError: type object 'EventType' has no attribute 'QUOTE_UPDATED'
[31mFAILED[0m tests/integration/test_no_stop_loss_grace_integration.py::[1mTestNoStopLossGraceIntegration::test_grace_period_timer_expires_and_closes_position[0m - AssertionError: assert not True
[31mFAILED[0m tests/integration/test_no_stop_loss_grace_integration.py::[1mTestNoStopLossGraceIntegration::test_multiple_positions_independent_timers[0m - assert 0 == 1
[31mFAILED[0m tests/integration/test_no_stop_loss_grace_integration.py::[1mTestNoStopLossGraceIntegration::test_concurrent_timer_operations[0m - assert 0 == 2
[31mFAILED[0m tests/integration/test_no_stop_loss_grace_integration.py::[1mTestNoStopLossGraceIntegration::test_enforcement_failure_does_not_crash[0m - AssertionError: Expected 'close_position' to be called once. Called 0 times.
[31mFAILED[0m tests/runtime/test_dry_run.py::[1mtest_dry_run_pnl_calculation[0m - TypeError: Database.__init__() missing 1 required positional argument: 'db_...
[31mFAILED[0m tests/runtime/test_dry_run.py::[1mtest_dry_run_vs_real_comparison[0m - assert False is True
[31mFAILED[0m tests/runtime/test_post_conditions.py::[1mtest_post_condition_event_bus_operational[0m - assert False is True
[31mFAILED[0m tests/runtime/test_smoke.py::[1mtest_smoke_event_bus_success[0m - assert False is True
[31mFAILED[0m tests/runtime/test_smoke.py::[1mtest_smoke_state_tracking_success[0m - TypeError: Database.__init__() missing 1 required positional argument: 'db_...
[31mFAILED[0m tests/unit/test_config/test_env_substitution.py::[1mTestEnvironmentVariableSubstitution::test_explicit_params_override_env[0m - AssertionError: assert 'env_key' == 'explicit_key'
[31mFAILED[0m tests/unit/test_config/test_env_substitution.py::[1mTestEnvironmentVariableSubstitution::test_partial_env_variables[0m - AssertionError: assert 'jakertrader\r' == 'explicit_user'
[31mFAILED[0m tests/unit/test_config/test_env_substitution.py::[1mTestEnvironmentVariableSubstitution::test_missing_optional_env_variables[0m - AssertionError: assert '' is None
[31mFAILED[0m tests/unit/test_config/test_env_substitution.py::[1mTestEnvironmentVariableSubstitution::test_env_file_loading[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'dotenv_key'
[31mFAILED[0m tests/unit/test_config/test_env_substitution.py::[1mTestEnvironmentVariableSubstitution::test_env_variables_override_env_file[0m - AssertionError: assert 'jakertrader\r' == 'dotenv_user'
[31mFAILED[0m tests/unit/test_config/test_env_substitution.py::[1mTestEnvironmentVariableSubstitution::test_missing_required_env_variable[0m - Failed: DID NOT RAISE <class 'Exception'>
[31mFAILED[0m tests/unit/test_config/test_env_substitution.py::[1mTestEnvironmentVariableSubstitution::test_env_file_with_comments[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'dotenv_key'
[31mFAILED[0m tests/unit/test_config/test_env_substitution.py::[1mTestEnvironmentVariableSubstitution::test_env_file_with_quotes[0m - AssertionError: assert 'key' in 'tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7...
[31mFAILED[0m tests/unit/test_config/test_env_substitution.py::[1mTestEnvironmentVariableSubstitution::test_combined_yaml_and_env[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'yaml_key'
[31mFAILED[0m tests/unit/test_config/test_loader.py::[1mTestConfigLoader::test_load_valid_yaml_file[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key_123'
[31mFAILED[0m tests/unit/test_config/test_loader.py::[1mTestConfigLoader::test_load_yaml_with_all_fields[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'
[31mFAILED[0m tests/unit/test_config/test_loader.py::[1mTestConfigLoader::test_load_yaml_minimal_required_only[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'minimal_key'
[31mFAILED[0m tests/unit/test_config/test_loader.py::[1mTestConfigLoader::test_load_yaml_missing_required_field[0m - Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>
[31mFAILED[0m tests/unit/test_config/test_loader.py::[1mTestConfigLoader::test_load_empty_yaml_file[0m - TypeError: risk_manager.core.config.RiskConfig() argument after ** must be ...
[31mFAILED[0m tests/unit/test_config/test_loader.py::[1mTestConfigLoader::test_load_yaml_with_null_values[0m - AssertionError: assert '' is None
[31mFAILED[0m tests/unit/test_config/test_loader.py::[1mTestConfigLoader::test_load_yaml_with_comments[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'
[31mFAILED[0m tests/unit/test_config/test_loader.py::[1mTestConfigLoader::test_load_yaml_with_extra_fields[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'
[31mFAILED[0m tests/unit/test_config/test_loader.py::[1mTestConfigLoader::test_load_yaml_with_nested_structure[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'
[31mFAILED[0m tests/unit/test_config/test_loader.py::[1mTestConfigLoader::test_load_from_string_path[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'
[31mFAILED[0m tests/unit/test_config/test_loader.py::[1mTestConfigLoader::test_load_from_pathlib_path[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'
[31mFAILED[0m tests/unit/test_config/test_loader.py::[1mTestConfigLoader::test_load_yaml_with_list_values[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'
[31mFAILED[0m tests/unit/test_config/test_loader.py::[1mTestConfigLoader::test_load_yaml_with_scientific_notation[0m - pydantic_core._pydantic_core.ValidationError: 1 validation error for RiskCo...
[31mFAILED[0m tests/unit/test_config/test_loader.py::[1mTestConfigLoader::test_load_yaml_with_multiline_strings[0m - AssertionError: assert 'test_key_multiline' in 'tj5F5k0jDY2p3EKC2N6K88fgotP...
[31mFAILED[0m tests/unit/test_config/test_loader.py::[1mTestConfigLoader::test_load_yaml_with_special_characters_in_strings[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test@key#123!$%'
[31mFAILED[0m tests/unit/test_config/test_loader.py::[1mTestConfigLoader::test_load_yaml_with_unicode_characters[0m - AssertionError: assert '™' in 'tj5F5k0jDY2p3EKC2N6K88fgotPEaNyBDpNOz8W5n7s=\r'
[31mFAILED[0m tests/unit/test_config/test_loader.py::[1mTestConfigLoader::test_load_yaml_relative_path[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'
[31mFAILED[0m tests/unit/test_config/test_loader.py::[1mTestConfigLoader::test_load_yaml_absolute_path[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'
[31mFAILED[0m tests/unit/test_config/test_loader.py::[1mTestConfigLoader::test_to_dict_roundtrip[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'
[31mFAILED[0m tests/unit/test_config/test_models.py::[1mTestRiskConfigModel::test_valid_config_minimal[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'
[31mFAILED[0m tests/unit/test_config/test_models.py::[1mTestRiskConfigModel::test_valid_config_all_fields[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'
[31mFAILED[0m tests/unit/test_config/test_models.py::[1mTestRiskConfigModel::test_missing_required_field_api_key[0m - Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>
[31mFAILED[0m tests/unit/test_config/test_models.py::[1mTestRiskConfigModel::test_missing_required_field_username[0m - Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>
[31mFAILED[0m tests/unit/test_config/test_models.py::[1mTestRiskConfigModel::test_missing_both_required_fields[0m - Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>
[31mFAILED[0m tests/unit/test_config/test_models.py::[1mTestRiskConfigModel::test_optional_fields_none[0m - AssertionError: assert '' is None
[31mFAILED[0m tests/unit/test_config/test_models.py::[1mTestRiskConfigModel::test_string_fields_empty[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == ''
[31mFAILED[0m tests/unit/test_config/test_models.py::[1mTestRiskConfigModel::test_to_dict_method[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'
[31mFAILED[0m tests/unit/test_config/test_models.py::[1mTestRiskConfigModel::test_url_fields_format[0m - AssertionError: assert 'https://api.topstepx.com/api' == 'https://custom.co...
[31mFAILED[0m tests/unit/test_config/test_validator.py::[1mTestFieldValidation::test_empty_string_api_key_valid[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == ''
[31mFAILED[0m tests/unit/test_config/test_validator.py::[1mTestFieldValidation::test_empty_string_username_valid[0m - AssertionError: assert 'jakertrader\r' == ''
[31mFAILED[0m tests/unit/test_config/test_validator.py::[1mTestFieldValidation::test_whitespace_string_api_key_valid[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == '   '
[31mFAILED[0m tests/unit/test_config/test_validator.py::[1mTestFieldValidation::test_invalid_url_format_allowed[0m - AssertionError: assert 'https://api.topstepx.com/api' == 'not_a_url'
[31mFAILED[0m tests/unit/test_config/test_validator.py::[1mTestModelValidation::test_all_required_fields_present[0m - AssertionError: assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == 'test_key'
[31mFAILED[0m tests/unit/test_config/test_validator.py::[1mTestModelValidation::test_conflicting_ai_settings_allowed[0m - AssertionError: assert '' is None
[31mFAILED[0m tests/unit/test_config/test_validator.py::[1mTestTypeValidation::test_float_to_int_coercion[0m - pydantic_core._pydantic_core.ValidationError: 1 validation error for RiskCo...
[31mFAILED[0m tests/unit/test_config/test_validator.py::[1mTestTypeValidation::test_list_to_string_raises_error[0m - Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>
[31mFAILED[0m tests/unit/test_config/test_validator.py::[1mTestTypeValidation::test_dict_to_string_raises_error[0m - Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>
[31mFAILED[0m tests/unit/test_config/test_validator.py::[1mTestTypeValidation::test_none_for_required_field_raises_error[0m - Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>
[31mFAILED[0m tests/unit/test_config/test_validator.py::[1mTestTypeValidation::test_none_for_optional_field_valid[0m - AssertionError: assert '' is None
[31mFAILED[0m tests/unit/test_config/test_validator.py::[1mTestErrorMessages::test_missing_required_field_error_message[0m - Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>
[31mFAILED[0m tests/unit/test_config/test_validator.py::[1mTestErrorMessages::test_multiple_errors_reported[0m - AssertionError: assert 2 >= 3
[31mFAILED[0m tests/unit/test_config/test_validator.py::[1mTestErrorMessages::test_error_includes_field_location[0m - Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>
[31mFAILED[0m tests/unit/test_config/test_validator.py::[1mTestEdgeCases::test_very_long_strings[0m - AssertionError: assert 45 == 10000
[31mFAILED[0m tests/unit/test_config/test_validator.py::[1mTestEdgeCases::test_special_characters_in_all_string_fields[0m - assert 'tj5F5k0jDY2p...pNOz8W5n7s=\r' == "!@#$%^&*()_+...}|;':,.<>?/~`"
[31mFAILED[0m tests/unit/test_rules/test_cooldown_after_loss.py::[1mTestCooldownAfterLossRule::test_cooldown_starts_timer[0m - TypeError: object Mock can't be used in 'await' expression
[31mFAILED[0m tests/unit/test_rules/test_cooldown_after_loss.py::[1mTestCooldownAfterLossRule::test_cooldown_expires_unlocks_account[0m - TypeError: object Mock can't be used in 'await' expression
[31mERROR[0m tests/integration/test_max_contracts_per_instrument_integration.py::[1mTestMaxContractsPerInstrumentIntegration::test_short_positions_absolute_value[0m
[31mERROR[0m tests/integration/test_max_contracts_per_instrument_integration.py::[1mTestMaxContractsPerInstrumentIntegration::test_exactly_at_limit_no_violation[0m
[31mERROR[0m tests/integration/test_max_contracts_per_instrument_integration.py::[1mTestMaxContractsPerInstrumentIntegration::test_event_bus_integration[0m
[31mERROR[0m tests/integration/test_max_contracts_per_instrument_integration.py::[1mTestMaxContractsPerInstrumentIntegration::test_no_lockout_on_violation[0m
[31mERROR[0m tests/integration/test_max_contracts_per_instrument_integration.py::[1mTestMaxContractsPerInstrumentIntegration::test_dynamic_limit_configuration[0m
[31mERROR[0m tests/integration/test_max_position_integration.py::[1mTestMaxPositionIntegration::test_single_symbol_within_limit[0m - NameError: name 'mock_engine' is not defined
[31mERROR[0m tests/integration/test_max_position_integration.py::[1mTestMaxPositionIntegration::test_single_symbol_exceeds_limit[0m - NameError: name 'mock_engine' is not defined
[31mERROR[0m tests/integration/test_max_position_integration.py::[1mTestMaxPositionIntegration::test_multi_symbol_total_within_limit[0m - NameError: name 'mock_engine' is not defined
[31mERROR[0m tests/integration/test_max_position_integration.py::[1mTestMaxPositionIntegration::test_multi_symbol_total_exceeds_limit[0m - NameError: name 'mock_engine' is not defined
[31mERROR[0m tests/integration/test_max_position_integration.py::[1mTestMaxPositionIntegration::test_short_positions_absolute_value[0m - NameError: name 'mock_engine' is not defined
[31mERROR[0m tests/integration/test_max_position_integration.py::[1mTestMaxPositionIntegration::test_event_bus_integration[0m - NameError: name 'mock_engine' is not defined
[31mERROR[0m tests/integration/test_max_position_integration.py::[1mTestMaxPositionIntegration::test_no_lockout_on_violation[0m
[31mERROR[0m tests/integration/test_max_position_integration.py::[1mTestMaxPositionIntegration::test_zero_position_no_violation[0m
[31mERROR[0m tests/integration/test_max_position_integration.py::[1mTestMaxPositionIntegration::test_exactly_at_limit_no_violation[0m
[31mERROR[0m tests/integration/test_max_position_integration.py::[1mTestMaxPositionIntegration::test_performance_many_symbols[0m
[31m===== [31m[1m88 failed[0m, [32m637 passed[0m, [33m196 warnings[0m, [31m[1m15 errors[0m[31m in 206.14s (0:03:26)[0m[31m ======[0m


================================================================================
End of Report
================================================================================
