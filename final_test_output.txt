[32m2025-10-28 21:15:22.348[0m | [34m[1mDEBUG   [0m | [36mrisk_manager.state.database[0m:[36m__init__[0m:[36m44[0m - [34m[1mUsing persistent in-memory database connection[0m
[32m2025-10-28 21:15:22.349[0m | [1mINFO    [0m | [36mrisk_manager.state.database[0m:[36m_apply_migrations[0m:[36m87[0m - [1mApplying schema migration: v1 (initial schema)[0m
[32m2025-10-28 21:15:22.350[0m | [32m[1mSUCCESS [0m | [36mrisk_manager.state.database[0m:[36m_migrate_to_v1[0m:[36m196[0m - [32m[1mSchema v1 applied successfully[0m
[32m2025-10-28 21:15:22.350[0m | [1mINFO    [0m | [36mrisk_manager.state.database[0m:[36m__init__[0m:[36m49[0m - [1mDatabase initialized at :memory:[0m
[32m2025-10-28 21:15:22.350[0m | [1mINFO    [0m | [36mrisk_manager.state.pnl_tracker[0m:[36m__init__[0m:[36m36[0m - [1mPnLTracker initialized[0m
[32m2025-10-28 21:15:22.350[0m | [1mINFO    [0m | [36mrisk_manager.state.lockout_manager[0m:[36mload_lockouts_from_db[0m:[36m469[0m - [1mLoaded 0 lockouts from database[0m
[32m2025-10-28 21:15:22.350[0m | [1mINFO    [0m | [36mrisk_manager.state.lockout_manager[0m:[36m__init__[0m:[36m73[0m - [1mLockout Manager initialized[0m

[1;36m============================================================[0m
[1;36m        RISK RULE VALIDATION TESTS[0m
[1;36m============================================================[0m

[1;36mTesting RULE-[0m[1;36m001[0m[1;36m: Max Contracts[0m
[33mPosition [0m[1;33m1[0m[33m: [0m[1;33m2[0m[33m MNQ long[0m
  [1m[[0mOK[1m][0m [32mNo violation [0m[1;32m([0m[1;32m2[0m[32m/[0m[1;32m5[0m[32m contracts[0m[1;32m)[0m
[33mPosition [0m[1;33m2[0m[33m: [0m[1;33m1[0m[33m ES long[0m
  [1m[[0mOK[1m][0m [32mNo violation [0m[1;32m([0m[1;32m3[0m[32m/[0m[1;32m5[0m[32m contracts[0m[1;32m)[0m
[33mPosition [0m[1;33m3[0m[33m: [0m[1;33m3[0m[33m NQ long[0m
  [1m[[0mX[1m][0m [31mVIOLATION: [0m[1;31m{[0m[31m'rule'[0m[31m: [0m[31m'MaxPositionRule'[0m[31m, [0m[31m'message'[0m[31m: [0m[31m'Total position size [0m
[31mexceeds limit: 6 [0m[31m([0m[31mmax: 5[0m[31m)[0m[31m'[0m[31m, [0m[31m'current_size'[0m[31m: [0m[1;31m6[0m[31m, [0m[31m'max_size'[0m[31m: [0m[1;31m5[0m[31m, [0m[31m'action'[0m[31m: [0m
[31m'flatten'[0m[1;31m}[0m
  [31mEnforcement action: flatten[0m
  [31mExcess contracts: [0m[3;31mNone[0m

[1;32m[[0m[1;32mOK[0m[1;32m][0m[1;32m RULE-[0m[1;32m001[0m[1;32m PASSED[0m

[1;36mTesting RULE-[0m[1;36m002[0m[1;36m: Max Contracts Per Instrument[0m
[32m2025-10-28 21:15:22.372[0m | [1mINFO    [0m | [36mrisk_manager.rules.max_contracts_per_instrument[0m:[36m__init__[0m:[36m60[0m - [1mMaxContractsPerInstrumentRule initialized - Limits: {'MNQ': 2, 'ES': 1, 'NQ': 3}, Enforcement: reduce_to_limit, Unknown: block[0m
[33mPosition [0m[1;33m1[0m[33m: [0m[1;33m1[0m[33m MNQ long[0m
  [1m[[0mOK[1m][0m [32mNo violation [0m[1;32m([0m[1;32m1[0m[32m/[0m[1;32m2[0m[32m contracts for MNQ[0m[1;32m)[0m
[33mPosition [0m[1;33m2[0m[33m: [0m[1;33m2[0m[33m ES long[0m
[32m2025-10-28 21:15:22.374[0m | [33m[1mWARNING [0m | [36mrisk_manager.rules.max_contracts_per_instrument[0m:[36mevaluate[0m:[36m102[0m - [33m[1m\u26a0\ufe0f RULE-002 BREACH: ES position size 2 exceeds limit 1[0m
  [1m[[0mX[1m][0m [31mVIOLATION: [0m[3;31mTrue[0m
  [31mEnforcement action: reduce_to_limit[0m
[33mPosition [0m[1;33m3[0m[33m: [0m[1;33m3[0m[33m NQ long[0m
  [1m[[0mOK[1m][0m [32mNo violation [0m[1;32m([0m[1;32m3[0m[32m/[0m[1;32m3[0m[32m contracts for NQ[0m[1;32m)[0m

[1;32m[[0m[1;32mOK[0m[1;32m][0m[1;32m RULE-[0m[1;32m002[0m[1;32m PASSED[0m

[1;36mTesting RULE-[0m[1;36m003[0m[1;36m: Daily Realized Loss[0m
[32m2025-10-28 21:15:22.378[0m | [1mINFO    [0m | [36mrisk_manager.rules.daily_realized_loss[0m:[36m__init__[0m:[36m102[0m - [1mDailyRealizedLossRule initialized: limit=$-500.00, reset=17:00 America/New_York[0m
[33mTrade [0m[1;33m1[0m[33m: -$[0m[1;33m200[0m[33m loss[0m
[32m2025-10-28 21:15:22.379[0m | [34m[1mDEBUG   [0m | [36mrisk_manager.state.pnl_tracker[0m:[36madd_trade_pnl[0m:[36m108[0m - [34m[1mCreated P&L record for TEST-ACCOUNT-001 on 2025-10-28: -200.00[0m
  Current P&L: $[1;36m-200.00[0m
  [1m[[0mOK[1m][0m [32mNo violation[0m
[33mTrade [0m[1;33m2[0m[33m: -$[0m[1;33m150[0m[33m loss[0m
[32m2025-10-28 21:15:22.381[0m | [34m[1mDEBUG   [0m | [36mrisk_manager.state.pnl_tracker[0m:[36madd_trade_pnl[0m:[36m91[0m - [34m[1mUpdated P&L for TEST-ACCOUNT-001 on 2025-10-28: -200.00 \u2192 -350.00 (trade: -150.00)[0m
  Current P&L: $[1;36m-350.00[0m
  [1m[[0mOK[1m][0m [32mNo violation[0m
[33mTrade [0m[1;33m3[0m[33m: -$[0m[1;33m200[0m[33m loss[0m
[32m2025-10-28 21:15:22.383[0m | [34m[1mDEBUG   [0m | [36mrisk_manager.state.pnl_tracker[0m:[36madd_trade_pnl[0m:[36m91[0m - [34m[1mUpdated P&L for TEST-ACCOUNT-001 on 2025-10-28: -350.00 \u2192 -550.00 (trade: -200.00)[0m
[32m2025-10-28 21:15:22.383[0m | [33m[1mWARNING [0m | [36mrisk_manager.rules.daily_realized_loss[0m:[36mevaluate[0m:[36m168[0m - [33m[1mDaily loss limit breached for account TEST-ACCOUNT-001: P&L=$-550.00, Limit=$-500.00[0m
  Current P&L: $[1;36m-550.00[0m
  [1m[[0mX[1m][0m [31mVIOLATION: [0m[1;31m{[0m[31m'rule'[0m[31m: [0m[31m'DailyRealizedLossRule'[0m[31m, [0m[31m'message'[0m[31m: [0m[31m'Daily loss limit [0m
[31mexceeded: $-550.00 [0m[31m([0m[31mlimit: $-500.00[0m[31m)[0m[31m'[0m[31m, [0m[31m'account_id'[0m[31m: [0m[31m'TEST-ACCOUNT-001'[0m[31m, [0m
[31m'daily_loss'[0m[31m: [0m[1;31m-550.0[0m[31m, [0m[31m'current_loss'[0m[31m: [0m[1;31m-550.0[0m[31m, [0m[31m'limit'[0m[31m: [0m[1;31m-500.0[0m[31m, [0m[31m'action'[0m[31m: [0m
[31m'flatten'[0m[31m, [0m[31m'lockout_required'[0m[31m: [0m[3;31mTrue[0m[31m, [0m[31m'reset_time'[0m[31m: [0m[31m'17:00'[0m[31m, [0m[31m'timezone'[0m[31m: [0m
[31m'America/New_York'[0m[1;31m}[0m
  [31mEnforcement action: flatten[0m

[1;32m[[0m[1;32mOK[0m[1;32m][0m[1;32m RULE-[0m[1;32m003[0m[1;32m PASSED[0m

[1;36mTesting RULE-[0m[1;36m004[0m[1;36m: Daily Unrealized Loss[0m
[33mPosition opened: [0m[1;33m5[0m[33m MNQ long @ $[0m[1;33m21[0m[33m,[0m[1;33m500[0m
  [1m[[0mOK[1m][0m [32mNo violation [0m[1;32m([0m[32mP&L = $[0m[1;32m0.00[0m[1;32m)[0m
[33mMarket price update: $[0m[1;33m21[0m[33m,[0m[1;33m400[0m
  Expected P&L: $[1;36m-10000.00[0m
  [1m[[0mX[1m][0m [31mVIOLATION: Unrealized P&L $[0m[1;31m-10000.00[0m[31m <= $[0m[1;31m-750.00[0m
  [31mEnforcement action: close_position[0m
  [31mSymbol to close: MNQ[0m
[33mMarket price update: $[0m[1;33m21[0m[33m,[0m[1;33m300[0m
  Expected P&L: $[1;36m-20000.00[0m
  [1m[[0mX[1m][0m [31mVIOLATION: Unrealized P&L $[0m[1;31m-20000.00[0m[31m <= $[0m[1;31m-750.00[0m

[1;32m[[0m[1;32mOK[0m[1;32m][0m[1;32m RULE-[0m[1;32m004[0m[1;32m PASSED[0m

[1;36mTesting RULE-[0m[1;36m005[0m[1;36m: Max Unrealized Profit[0m
[33mPosition opened: ES @ $[0m[1;33m5[0m[33m,[0m[1;33m000[0m[33m, [0m[33msize[0m[33m=[0m[1;33m2[0m[33m long[0m
  [1m[[0mOK[1m][0m [32mNo violation [0m[1;32m([0m[32mprofit = $[0m[1;32m0[0m[1;32m)[0m
[33mMarket price [0m[1;33m1[0m[33m: $[0m[1;33m5[0m[33m,[0m[1;33m002[0m
  Expected profit: $[1;36m200.00[0m
  [1m[[0mOK[1m][0m [32mNo violation [0m[1;32m([0m[32mprofit < $[0m[1;32m500[0m[32m target[0m[1;32m)[0m
[33mMarket price [0m[1;33m2[0m[33m: $[0m[1;33m5[0m[33m,[0m[1;33m005[0m
  Expected profit: $[1;36m500.00[0m
  [1m[[0mX[1m][0m [31mVIOLATION: [0m[1;31m{[0m[31m'rule'[0m[31m: [0m[31m'MaxUnrealizedProfitRule'[0m[31m, [0m[31m'message'[0m[31m: [0m[31m'Profit target [0m
[31mhit for ES: $500.00 >= $500.00 [0m[31m([0m[31mtake profit[0m[31m)[0m[31m'[0m[31m, [0m[31m'symbol'[0m[31m: [0m[31m'ES'[0m[31m, [0m[31m'contractId'[0m[31m: [0m
[31m'CON.F.US.ES.H25'[0m[31m, [0m[31m'unrealized_pnl'[0m[31m: [0m[1;31m500.0[0m[31m, [0m[31m'target'[0m[31m: [0m[1;31m500.0[0m[31m, [0m[31m'action'[0m[31m: [0m
[31m'close_position'[0m[31m, [0m[31m'timestamp'[0m[31m: [0m[31m'2025-10-29T02:15:22.394588+00:00'[0m[1;31m}[0m
  [31mEnforcement action: close_position[0m
  [31mUnrealized P&L: $[0m[1;31m500.00[0m

[1;32m[[0m[1;32mOK[0m[1;32m][0m[1;32m RULE-[0m[1;32m005[0m[1;32m PASSED[0m

[1;36mTesting RULE-[0m[1;36m006[0m[1;36m: Trade Frequency Limit[0m
[32m2025-10-28 21:15:22.396[0m | [1mINFO    [0m | [36mrisk_manager.state.timer_manager[0m:[36m__init__[0m:[36m57[0m - [1mTimerManager initialized[0m
[32m2025-10-28 21:15:22.397[0m | [1mINFO    [0m | [36mrisk_manager.rules.trade_frequency_limit[0m:[36m__init__[0m:[36m115[0m - [1mTradeFrequencyLimitRule initialized: limits={'per_minute': 3}, cooldowns={'per_minute_breach': 60}[0m
[33mTrade [0m[1;33m1[0m[33m [0m[1;33m([0m[33m3s ago[0m[1;33m)[0m
  Trade count in last minute: [1;36m1[0m/[1;36m3[0m
  [1m[[0mOK[1m][0m [32mNo violation [0m[1;32m([0m[1;32m1[0m[32m/[0m[1;32m3[0m[32m trades[0m[1;32m)[0m
[33mTrade [0m[1;33m2[0m[33m [0m[1;33m([0m[33mnow + 20s[0m[1;33m)[0m
  Trade count in last minute: [1;36m2[0m/[1;36m3[0m
  [1m[[0mOK[1m][0m [32mNo violation [0m[1;32m([0m[1;32m2[0m[32m/[0m[1;32m3[0m[32m trades[0m[1;32m)[0m
[33mTrade [0m[1;33m3[0m[33m [0m[1;33m([0m[33mnow + 40s[0m[1;33m)[0m
  Trade count in last minute: [1;36m3[0m/[1;36m3[0m
  [1m[[0mOK[1m][0m [32mNo violation [0m[1;32m([0m[1;32m3[0m[32m/[0m[1;32m3[0m[32m trades[0m[1;32m)[0m
[33mTrade [0m[1;33m4[0m[33m [0m[1;33m([0m[33mnow + 50s[0m[1;33m)[0m
[32m2025-10-28 21:15:22.400[0m | [33m[1mWARNING [0m | [36mrisk_manager.rules.trade_frequency_limit[0m:[36mevaluate[0m:[36m166[0m - [33m[1mPer-minute trade limit breached for account TEST-ACCOUNT-006: 4 trades >= 3 limit[0m
  Trade count in last minute: [1;36m4[0m/[1;36m3[0m
  [1m[[0mX[1m][0m [31mVIOLATION: [0m[1;31m{[0m[31m'rule'[0m[31m: [0m[31m'TradeFrequencyLimitRule'[0m[31m, [0m[31m'message'[0m[31m: [0m[31m'Trade frequency[0m
[31mlimit exceeded: 4 trades in last minute [0m[31m([0m[31mlimit: 3[0m[31m)[0m[31m'[0m[31m, [0m[31m'account_id'[0m[31m: [0m
[31m'TEST-ACCOUNT-006'[0m[31m, [0m[31m'breach_type'[0m[31m: [0m[31m'per_minute'[0m[31m, [0m[31m'trade_count'[0m[31m: [0m[1;31m4[0m[31m, [0m[31m'limit'[0m[31m: [0m[1;31m3[0m[31m, [0m
[31m'cooldown_duration'[0m[31m: [0m[1;31m60[0m[31m, [0m[31m'action'[0m[31m: [0m[31m'cooldown'[0m[1;31m}[0m
  [31mEnforcement action: cooldown[0m
  [31mCooldown duration: 60s[0m

[1;32m[[0m[1;32mOK[0m[1;32m][0m[1;32m RULE-[0m[1;32m006[0m[1;32m PASSED[0m

[1;36mTesting RULE-[0m[1;36m007[0m[1;36m: Cooldown After Loss[0m
[32m2025-10-28 21:15:22.402[0m | [1mINFO    [0m | [36mrisk_manager.state.timer_manager[0m:[36m__init__[0m:[36m57[0m - [1mTimerManager initialized[0m
[32m2025-10-28 21:15:22.403[0m | [34m[1mDEBUG   [0m | [36mrisk_manager.state.timer_manager[0m:[36mstart_background_task[0m:[36m184[0m - [34m[1mBackground task started[0m
[32m2025-10-28 21:15:22.403[0m | [1mINFO    [0m | [36mrisk_manager.state.timer_manager[0m:[36mstart[0m:[36m67[0m - [1mTimerManager started[0m
[32m2025-10-28 21:15:22.403[0m | [1mINFO    [0m | [36mrisk_manager.rules.cooldown_after_loss[0m:[36m__init__[0m:[36m127[0m - [1mCooldownAfterLossRule initialized: 1 tiers[0m
[33mTrade [0m[1;33m1[0m[33m: -$[0m[1;33m50[0m[33m loss[0m
[32m2025-10-28 21:15:22.403[0m | [34m[1mDEBUG   [0m | [36mrisk_manager.rules.cooldown_after_loss[0m:[36mevaluate[0m:[36m204[0m - [34m[1mLoss $-50.00 below all thresholds, no cooldown[0m
  [1m[[0mOK[1m][0m [32mNo violation [0m[1;32m([0m[32mloss below threshold[0m[1;32m)[0m
  Account locked: [3;91mFalse[0m
[33mTrade [0m[1;33m2[0m[33m: -$[0m[1;33m150[0m[33m loss[0m
[32m2025-10-28 21:15:22.404[0m | [33m[1mWARNING [0m | [36mrisk_manager.rules.cooldown_after_loss[0m:[36mevaluate[0m:[36m211[0m - [33m[1mCooldown triggered for account TEST-ACCOUNT-007: Loss=$-150.00, Cooldown=300s[0m
  [1m[[0mX[1m][0m [31mVIOLATION: Cooldown triggered after $[0m[1;31m-150.00[0m[31m loss [0m[1;31m([0m[31m300s cooldown[0m[1;31m)[0m
  [31mEnforcement action: flatten[0m
  [31mCooldown duration: 300s[0m
[32m2025-10-28 21:15:22.405[0m | [41m[1mCRITICAL[0m | [36mrisk_manager.rules.cooldown_after_loss[0m:[36menforce[0m:[36m252[0m - [41m[1mENFORCING RULE-007: Account TEST-ACCOUNT-007 Loss: $-150.00, Cooldown: 300s[0m
[32m2025-10-28 21:15:22.406[0m | [33m[1mWARNING [0m | [36mrisk_manager.state.lockout_manager[0m:[36mset_cooldown[0m:[36m261[0m - [33m[1mAccount TEST-ACCOUNT-007 cooldown for 300s: Cooldown triggered after $-150.00 loss (300s cooldown)[0m
[32m2025-10-28 21:15:22.406[0m | [33m[1mWARNING [0m | [36mrisk_manager.rules.cooldown_after_loss[0m:[36menforce[0m:[36m273[0m - [33m[1mAccount TEST-ACCOUNT-007 locked for 300s: Cooldown triggered after $-150.00 loss (300s cooldown)[0m
  Account locked after enforcement: [3;92mTrue[0m
[32m2025-10-28 21:15:22.406[0m | [1mINFO    [0m | [36mrisk_manager.state.timer_manager[0m:[36mstop[0m:[36m85[0m - [1mTimerManager stopped[0m

[1;32m[[0m[1;32mOK[0m[1;32m][0m[1;32m RULE-[0m[1;32m007[0m[1;32m PASSED[0m

[1;36mTesting RULE-[0m[1;36m008[0m[1;36m: No Stop-Loss Grace[0m
[32m2025-10-28 21:15:22.407[0m | [1mINFO    [0m | [36mrisk_manager.state.timer_manager[0m:[36m__init__[0m:[36m57[0m - [1mTimerManager initialized[0m
[32m2025-10-28 21:15:22.407[0m | [34m[1mDEBUG   [0m | [36mrisk_manager.state.timer_manager[0m:[36mstart_background_task[0m:[36m184[0m - [34m[1mBackground task started[0m
[32m2025-10-28 21:15:22.407[0m | [1mINFO    [0m | [36mrisk_manager.state.timer_manager[0m:[36mstart[0m:[36m67[0m - [1mTimerManager started[0m
[32m2025-10-28 21:15:22.407[0m | [1mINFO    [0m | [36mrisk_manager.rules.no_stop_loss_grace[0m:[36m__init__[0m:[36m77[0m - [1mNoStopLossGraceRule initialized - Grace period: 60s, Enforcement: close_position, Enabled: True[0m
[33mStep [0m[1;33m1[0m[33m: Open position [0m[1;33m([0m[33mstarts 60s grace period[0m[1;33m)[0m
[32m2025-10-28 21:15:22.408[0m | [1mINFO    [0m | [36mrisk_manager.rules.no_stop_loss_grace[0m:[36m_handle_position_opened[0m:[36m149[0m - [1mRULE-008: Position opened MNQ/CON.F.US.MNQ.U25 (size=1), starting 60s grace period for stop-loss[0m
[32m2025-10-28 21:15:22.408[0m | [1mINFO    [0m | [36mrisk_manager.state.timer_manager[0m:[36mstart_timer[0m:[36m122[0m - [1mTimer started: no_stop_loss_grace_CON.F.US.MNQ.U25 (duration=60s, expires=21:16:22)[0m
  [1m[[0mOK[1m][0m [32mGrace period started[0m
  [1m[[0mOK[1m][0m [32mTimer active: 59s remaining[0m
[33mStep [0m[1;33m2[0m[33m: Simulating [0m[1;33m61[0m[33m seconds passing[0m[33m...[0m
[32m2025-10-28 21:15:22.409[0m | [33m[1mWARNING [0m | [36mrisk_manager.rules.no_stop_loss_grace[0m:[36m_enforce_grace_period_violation[0m:[36m251[0m - [33m[1m\u26a0\ufe0f RULE-008 BREACH: No stop-loss placed within 60s for MNQ/CON.F.US.MNQ.U25[0m
[32m2025-10-28 21:15:22.409[0m | [33m[1mWARNING [0m | [36mrisk_manager.rules.no_stop_loss_grace[0m:[36m_enforce_grace_period_violation[0m:[36m263[0m - [33m[1m\U0001f6a8 ENFORCING RULE-008: Closing position MNQ/CON.F.US.MNQ.U25 (no stop-loss placed within grace period)[0m
[32m2025-10-28 21:15:22.409[0m | [32m[1mSUCCESS [0m | [36mrisk_manager.rules.no_stop_loss_grace[0m:[36m_enforce_grace_period_violation[0m:[36m272[0m - [32m[1m\u2705 RULE-008 ENFORCED: Position MNQ/CON.F.US.MNQ.U25 closed (grace period expired without stop-loss)[0m
[32m2025-10-28 21:15:22.409[0m | [34m[1mDEBUG   [0m | [36mrisk_manager.state.timer_manager[0m:[36m_execute_callback[0m:[36m246[0m - [34m[1mTimer callback executed: no_stop_loss_grace_CON.F.US.MNQ.U25[0m
[32m2025-10-28 21:15:22.410[0m | [1mINFO    [0m | [36mrisk_manager.state.timer_manager[0m:[36m_execute_callback[0m:[36m257[0m - [1mTimer expired and removed: no_stop_loss_grace_CON.F.US.MNQ.U25[0m
  [1m[[0mX[1m][0m [31mVIOLATION: Grace period expired without stop-loss[0m
[32m2025-10-28 21:15:22.410[0m | [1mINFO    [0m | [36mrisk_manager.state.timer_manager[0m:[36mstop[0m:[36m85[0m - [1mTimerManager stopped[0m

[1;32m[[0m[1;32mOK[0m[1;32m][0m[1;32m RULE-[0m[1;32m008[0m[1;32m PASSED[0m

[1;36mTesting RULE-[0m[1;36m009[0m[1;36m: Session Block Outside Hours[0m
[32m2025-10-28 21:15:22.414[0m | [1mINFO    [0m | [36mrisk_manager.rules.session_block_outside[0m:[36m__init__[0m:[36m130[0m - [1mSessionBlockOutsideRule initialized: session=08:30-15:00 America/Chicago, block_weekends=True[0m
[33mTest [0m[1;33m1[0m[33m: Position opened at [0m[1;33m08:00[0m[33m CT [0m[1;33m([0m[33mbefore hours[0m[1;33m)[0m
[32m2025-10-28 21:15:22.416[0m | [33m[1mWARNING [0m | [36mrisk_manager.rules.session_block_outside[0m:[36mevaluate[0m:[36m218[0m - [33m[1mTrading attempted outside session hours for account TEST-ACCOUNT-009: Current: 08:00 America/Chicago, before session start (08:30)[0m
  [1m[[0mX[1m][0m [31mVIOLATION: Trading outside session hours: [0m[1;31m08:00[0m[31m America/Chicago is before [0m
[31msession start [0m[1;31m([0m[1;31m08:30[0m[1;31m)[0m
  [31mCurrent time: [0m[1;31m08:00[0m
  [31mSession: [0m[1;31m08:30[0m[31m - [0m[1;31m15:00[0m
[33mTest [0m[1;33m2[0m[33m: Position opened at [0m[1;33m10:00[0m[33m CT [0m[1;33m([0m[33mduring hours[0m[1;33m)[0m
  [1m[[0mOK[1m][0m [32mNo violation [0m[1;32m([0m[32mduring hours[0m[1;32m)[0m
[33mTest [0m[1;33m3[0m[33m: Position opened at [0m[1;33m16:00[0m[33m CT [0m[1;33m([0m[33mafter hours[0m[1;33m)[0m
[32m2025-10-28 21:15:22.420[0m | [33m[1mWARNING [0m | [36mrisk_manager.rules.session_block_outside[0m:[36mevaluate[0m:[36m218[0m - [33m[1mTrading attempted outside session hours for account TEST-ACCOUNT-009: Current: 16:00 America/Chicago, after session end (15:00)[0m
[32m2025-10-28 21:15:22.420[0m | [34m[1mDEBUG   [0m | [36mrisk_manager.rules.session_block_outside[0m:[36m_calculate_next_session_start[0m:[36m337[0m - [34m[1mNext session start: 2025-10-30T08:30:00-05:00 (Thursday 08:30 America/Chicago)[0m
  [1m[[0mX[1m][0m [31mVIOLATION: Trading outside session hours: [0m[1;31m16:00[0m[31m America/Chicago is after [0m
[31msession end [0m[1;31m([0m[1;31m15:00[0m[1;31m)[0m
  [31mCurrent time: [0m[1;31m16:00[0m

[1;32m[[0m[1;32mOK[0m[1;32m][0m[1;32m RULE-[0m[1;32m009[0m[1;32m PASSED[0m

[1;36mTesting RULE-[0m[1;36m011[0m[1;36m: Symbol Blocks[0m
[33mTest [0m[1;33m1[0m[33m: Open MNQ position [0m[1;33m([0m[33mnot blocked[0m[1;33m)[0m
  [1m[[0mOK[1m][0m [32mMNQ is allowed[0m
[33mTest [0m[1;33m2[0m[33m: Open ES position [0m[1;33m([0m[33mblocked[0m[1;33m)[0m
  [1m[[0mX[1m][0m [31mVIOLATION: [0m[1;31m{[0m[31m'rule'[0m[31m: [0m[31m'SymbolBlocksRule'[0m[31m, [0m[31m'message'[0m[31m: [0m[31m'Symbol ES is blocked [0m
[31mand cannot be traded'[0m[31m, [0m[31m'symbol'[0m[31m: [0m[31m'ES'[0m[31m, [0m[31m'action'[0m[31m: [0m[31m'close'[0m[1;31m}[0m
  [31mEnforcement action: close[0m
[33mTest [0m[1;33m3[0m[33m: Open NQ position [0m[1;33m([0m[33mblocked[0m[1;33m)[0m
  [1m[[0mX[1m][0m [31mVIOLATION: [0m[1;31m{[0m[31m'rule'[0m[31m: [0m[31m'SymbolBlocksRule'[0m[31m, [0m[31m'message'[0m[31m: [0m[31m'Symbol NQ is blocked [0m
[31mand cannot be traded'[0m[31m, [0m[31m'symbol'[0m[31m: [0m[31m'NQ'[0m[31m, [0m[31m'action'[0m[31m: [0m[31m'close'[0m[1;31m}[0m
  [31mEnforcement action: close[0m

[1;32m[[0m[1;32mOK[0m[1;32m][0m[1;32m RULE-[0m[1;32m011[0m[1;32m PASSED[0m

[1;36mTesting RULE-[0m[1;36m012[0m[1;36m: Trade Management[0m
[33mPosition opened: [0m[1;33m2[0m[33m MNQ long @ $[0m[1;33m21[0m[33m,[0m[1;33m500[0m
  [1m[[0mOK[1m][0m [32mAction generated: place_bracket_order[0m
  [32mStop-loss: $[0m[1;32m21497.50[0m
  [32mTake-profit: $[0m[1;32m21505.00[0m
  [1m[[0mOK[1m][0m [32mStop-loss calculation correct: $[0m[1;32m21497.50[0m
  [1m[[0mOK[1m][0m [32mTake-profit calculation correct: $[0m[1;32m21505.00[0m

[1;32m[[0m[1;32mOK[0m[1;32m][0m[1;32m RULE-[0m[1;32m012[0m[1;32m PASSED[0m

[1;36mTesting RULE-[0m[1;36m013[0m[1;36m: Daily Realized Profit Target[0m
[32m2025-10-28 21:15:22.429[0m | [1mINFO    [0m | [36mrisk_manager.rules.daily_realized_profit[0m:[36m__init__[0m:[36m111[0m - [1mDailyRealizedProfitRule initialized: target=$1000.00, reset=17:00 America/New_York[0m
[33mTrade [0m[1;33m1[0m[33m: +$[0m[1;33m300[0m[33m profit[0m
[32m2025-10-28 21:15:22.429[0m | [34m[1mDEBUG   [0m | [36mrisk_manager.state.pnl_tracker[0m:[36madd_trade_pnl[0m:[36m108[0m - [34m[1mCreated P&L record for TEST-ACCOUNT-002 on 2025-10-28: +300.00[0m
  Current P&L: $[1;36m300.00[0m
  [1m[[0mOK[1m][0m [32mNo violation[0m
[33mTrade [0m[1;33m2[0m[33m: +$[0m[1;33m400[0m[33m profit[0m
[32m2025-10-28 21:15:22.430[0m | [34m[1mDEBUG   [0m | [36mrisk_manager.state.pnl_tracker[0m:[36madd_trade_pnl[0m:[36m91[0m - [34m[1mUpdated P&L for TEST-ACCOUNT-002 on 2025-10-28: 300.00 \u2192 700.00 (trade: +400.00)[0m
  Current P&L: $[1;36m700.00[0m
  [1m[[0mOK[1m][0m [32mNo violation[0m
[33mTrade [0m[1;33m3[0m[33m: +$[0m[1;33m400[0m[33m profit[0m
[32m2025-10-28 21:15:22.431[0m | [34m[1mDEBUG   [0m | [36mrisk_manager.state.pnl_tracker[0m:[36madd_trade_pnl[0m:[36m91[0m - [34m[1mUpdated P&L for TEST-ACCOUNT-002 on 2025-10-28: 700.00 \u2192 1100.00 (trade: +400.00)[0m
[32m2025-10-28 21:15:22.431[0m | [33m[1mWARNING [0m | [36mrisk_manager.rules.daily_realized_profit[0m:[36mevaluate[0m:[36m177[0m - [33m[1mDaily profit target reached for account TEST-ACCOUNT-002: P&L=$1100.00, Target=$1000.00 - Good job![0m
  Current P&L: $[1;36m1100.00[0m
  [1m[[0mX[1m][0m [31mVIOLATION: [0m[1;31m{[0m[31m'rule'[0m[31m: [0m[31m'DailyRealizedProfitRule'[0m[31m, [0m[31m'message'[0m[31m: [0m[31m'Daily profit [0m
[31mtarget reached: $1100.00 [0m[31m([0m[31mtarget: $1000.00[0m[31m)[0m[31m - Good job!'[0m[31m, [0m[31m'account_id'[0m[31m: [0m
[31m'TEST-ACCOUNT-002'[0m[31m, [0m[31m'current_profit'[0m[31m: [0m[1;31m1100.0[0m[31m, [0m[31m'target'[0m[31m: [0m[1;31m1000.0[0m[31m, [0m[31m'action'[0m[31m: [0m
[31m'flatten'[0m[31m, [0m[31m'lockout_required'[0m[31m: [0m[3;31mTrue[0m[31m, [0m[31m'reset_time'[0m[31m: [0m[31m'17:00'[0m[31m, [0m[31m'timezone'[0m[31m: [0m
[31m'America/New_York'[0m[1;31m}[0m
  [32mEnforcement action: flatten [0m[1;32m([0m[32mGood job![0m[1;32m)[0m

[1;32m[[0m[1;32mOK[0m[1;32m][0m[1;32m RULE-[0m[1;32m013[0m[1;32m PASSED[0m

[1;36m============================================================[0m
[1;36m                    SUMMARY[0m
[1;36m============================================================[0m

[3m                    Rule Test Results                    [0m
+-------------------------------------------------------+
|[1m [0m[1mRule    [0m[1m [0m|[1m [0m[1mStatus   [0m[1m [0m|[1m [0m[1mArithmetic[0m[1m [0m|[1m [0m[1mEnforcement      [0m[1m [0m|
|----------+-----------+------------+-------------------|
|[36m [0m[36mRULE-001[0m[36m [0m|[1m [0m[1m[OK] PASS[0m[1m [0m|[33m [0m[33m[OK]      [0m[33m [0m|[35m [0m[35mflatten          [0m[35m [0m|
|[36m [0m[36mRULE-002[0m[36m [0m|[1m [0m[1m[OK] PASS[0m[1m [0m|[33m [0m[33m[OK]      [0m[33m [0m|[35m [0m[35mreduce_to_limit  [0m[35m [0m|
|[36m [0m[36mRULE-003[0m[36m [0m|[1m [0m[1m[OK] PASS[0m[1m [0m|[33m [0m[33m[OK]      [0m[33m [0m|[35m [0m[35mflatten          [0m[35m [0m|
|[36m [0m[36mRULE-004[0m[36m [0m|[1m [0m[1m[OK] PASS[0m[1m [0m|[33m [0m[33m[OK]      [0m[33m [0m|[35m [0m[35mclose_position   [0m[35m [0m|
|[36m [0m[36mRULE-005[0m[36m [0m|[1m [0m[1m[OK] PASS[0m[1m [0m|[33m [0m[33m[OK]      [0m[33m [0m|[35m [0m[35mclose_position   [0m[35m [0m|
|[36m [0m[36mRULE-006[0m[36m [0m|[1m [0m[1m[OK] PASS[0m[1m [0m|[33m [0m[33m[OK]      [0m[33m [0m|[35m [0m[35mcooldown         [0m[35m [0m|
|[36m [0m[36mRULE-007[0m[36m [0m|[1m [0m[1m[OK] PASS[0m[1m [0m|[33m [0m[33m[OK]      [0m[33m [0m|[35m [0m[35mflatten          [0m[35m [0m|
|[36m [0m[36mRULE-008[0m[36m [0m|[1m [0m[1m[OK] PASS[0m[1m [0m|[33m [0m[33m[OK]      [0m[33m [0m|[35m [0m[35mclose_position   [0m[35m [0m|
|[36m [0m[36mRULE-009[0m[36m [0m|[1m [0m[1m[OK] PASS[0m[1m [0m|[33m [0m[33m[OK]      [0m[33m [0m|[35m [0m[35mflatten + lockout[0m[35m [0m|
|[36m [0m[36mRULE-011[0m[36m [0m|[1m [0m[1m[OK] PASS[0m[1m [0m|[33m [0m[33m[OK]      [0m[33m [0m|[35m [0m[35mclose            [0m[35m [0m|
|[36m [0m[36mRULE-012[0m[36m [0m|[1m [0m[1m[OK] PASS[0m[1m [0m|[33m [0m[33m[OK]      [0m[33m [0m|[35m [0m[35mN/A              [0m[35m [0m|
|[36m [0m[36mRULE-013[0m[36m [0m|[1m [0m[1m[OK] PASS[0m[1m [0m|[33m [0m[33m[OK]      [0m[33m [0m|[35m [0m[35mflatten          [0m[35m [0m|
+-------------------------------------------------------+

[1mPass Rate:[0m [1;36m12[0m/[1;36m12[0m [1m([0m[1;36m100.0[0m%[1m)[0m

[1;32m[[0m[1;32mSUCCESS[0m[1;32m][0m[1;32m ALL TESTS PASSED![0m

